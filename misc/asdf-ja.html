<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<!-- このマニュアルはASDF――Common Lispプログラムとライブラリのためのシス
テム定義ツール――について解説したものです。

このマニュアルの最新バージョン（訳注: 英語版）は以下にあります:
https://common-lisp.net/project/asdf/asdf.html 
[訳者補足]

この非公式の日本語訳は、ASDFの公式リポジトリのフォークとしてGitLab上で編集されています。（https://gitlab.common-lisp.net/hishimaru/asdf/tree/ja） 翻訳に関する訂正、意見などは常に歓迎します。その際はIssuesを使っていただけると確実です。

[訳者補足終わり]


ASDF Copyright (C) 2001-2018 Daniel Barlow and contributors.

This manual Copyright (C) 2001-2018 Daniel Barlow and contributors.

This manual revised (C) 2009-2018 Robert P. Goldman and Francois-Rene Rideau.

This manual translated into Japanese (C) 2018 Hugo Ishimaru.

Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
"Software"), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
 -->
<!-- Created by GNU Texinfo 6.5, http://www.gnu.org/software/texinfo/ -->
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<title>ASDF マニュアル</title>

<meta name="description" content="ASDF マニュアル">
<meta name="keywords" content="ASDF マニュアル">
<meta name="resource-type" content="document">
<meta name="distribution" content="global">
<meta name="Generator" content="makeinfo">
<link href="#Top" rel="start" title="Top">
<link href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09" rel="index" title="索引（用語）">
<link href="#SEC_Contents" rel="contents" title="Table of Contents">
<link href="dir.html#Top" rel="up" title="(dir)">
<style type="text/css">
<!--
/* -*- coding: utf-8 -*- */


a.summary-letter {text-decoration: none}
blockquote.indentedblock {margin-right: 0em}
blockquote.smallindentedblock {margin-right: 0em; font-size: smaller}
blockquote.smallquotation {font-size: smaller}
div.display {margin-left: 3.2em}
div.example {margin-left: 3.2em}
div.lisp {margin-left: 3.2em}
div.smalldisplay {margin-left: 3.2em}
div.smallexample {margin-left: 3.2em}
div.smalllisp {margin-left: 3.2em}
kbd {font-style: oblique}
pre.display {font-family: inherit}
pre.format {font-family: inherit}
pre.menu-comment {font-family: serif}
pre.menu-preformatted {font-family: serif}
pre.smalldisplay {font-family: inherit; font-size: smaller}
pre.smallexample {font-size: smaller}
pre.smallformat {font-family: inherit; font-size: smaller}
pre.smalllisp {font-size: smaller}
span.nolinebreak {white-space: nowrap}
span.roman {font-family: initial; font-weight: normal}
span.sansserif {font-family: sans-serif; font-weight: normal}
ul.no-bullet {list-style: none}
body {
    max-width: 980px;
    margin: auto;
    font-family: ã¡ã¤ãªãª, Meiryo, "ãã©ã®ãè§ã´ Pro W3", "Hiragino Kaku Gothic Pro", Osaka, "ï¼­ï¼³ ï¼°ã´ã·ãã¯", "MS PGothic", sans-serif;
}

h1 { font-size: 232% }
h1.top { font-family: "Times New Roman"; }
h2 {font-size: 147%; font-weight: bold; margin-top: 1em;}
/* h2.contents-heading { font-family: "Times New Roman"} */
h3 {font-size: 116%; margin-top: 1em}

/* div.header {float: left;} */

pre.example, .verbatim {
    font-family: "Courier New", Courier, Consolas, Monaco, monospace
}

div.lisp pre.lisp {
    padding: 16px;
    overflow: auto;
    font-size: 95%;
    line-height: 1.45;
    background-color: #f6f8fa;
    border-radius: 3px;
    word-break: normal;
    word-wrap: normal;
    margin-top: 0;
    margin-left: 0;
    margin-bottom: 0;
    box-sizing: border-box;
    font-family: "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
}

samp, code {
    font-family: "SFMono-Regular",Consolas,"Liberation Mono",Menlo,Courier,monospace;
}
code {
    padding: 0.2em 0.4em;
    margin: 0;
    font-size: 95%;
    background-color: #f3f4f4;
    border-radius: 3px;
}

hr { color: #eaecef }

em {
    font-style: normal;
    text-decoration: underline;
}

dt em {
    all: initial;
    font-style: italic;
}

a:link { color: #0076AD }
a:visited { color: #6D38A0 }

-->
</style>


</head>

<body lang="ja">
<h1 class="settitle" align="center">ASDF マニュアル</h1>






<a name="SEC_Contents"></a>
<h2 class="contents-heading">Table of Contents</h2>

<div class="contents">

<ul class="no-bullet">
  <li><a name="toc-hazimeni" href="#g_t_306f_3058_3081_306b">1 はじめに</a></li>
  <li><a name="toc-kuitukusutatogaido" href="#g_t_30af_30a4_30c3_30af_30b9_30bf_30fc_30c8_30ac_30a4_30c9">2 クイックスタートガイド</a></li>
  <li><a name="toc-ASDFworodosuru" href="#ASDF_3092_30ed_30fc_30c9_3059_308b">3 ASDFをロードする</a>
  <ul class="no-bullet">
    <li><a name="toc-insutoruJi-minoASDFworodosuru" href="#g_t_30a4_30f3_30b9_30c8_30fc_30eb_6e08_307f_306eASDF_3092_30ed_30fc_30c9_3059_308b">3.1 インストール済みのASDFをロードする</a></li>
    <li><a name="toc-ASDFgarodosareteirukaDiao-beru" href="#ASDF_304c_30ed_30fc_30c9_3055_308c_3066_3044_308b_304b_8abf_3079_308b">3.2 ASDFがロードされているか調べる</a></li>
    <li><a name="toc-ASDFwoatupuguredosuru" href="#ASDF_3092_30a2_30c3_30d7_30b0_30ec_30fc_30c9_3059_308b">3.3 ASDFをアップグレードする</a></li>
    <li><a name="toc-Chu-Li-Xi-Fu-Shu-noASDFwoZhi-kiHuan-eru" href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">3.4 処理系付属のASDFを置き換える</a></li>
    <li><a name="toc-ASDFwososukararodosuru" href="#ASDF_3092_30bd_30fc_30b9_304b_3089_30ed_30fc_30c9_3059_308b">3.5 ASDFをソースからロードする</a></li>
  </ul></li>
  <li><a name="toc-ASDFwoShe-Ding-suru" href="#ASDF_3092_8a2d_5b9a_3059_308b">4 ASDFを設定する</a>
  <ul class="no-bullet">
    <li><a name="toc-ASDFgasisutemuwoJian-tukerareruyouniShe-Ding-suru" href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b">4.1 ASDFがシステムを見つけられるように設定する</a></li>
    <li><a name="toc-ASDFgasisutemuwoJian-tukerareruyouniShe-Ding-suru_0028Gu-isutairu_0029" href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b_ff08_53e4_3044_30b9_30bf_30a4_30eb_ff09">4.2 ASDFがシステムを見つけられるように設定する（古いスタイル）</a></li>
    <li><a name="toc-ASDFgaobuziekutohuairuwoBao-Chi-suruChang-Suo-woShe-Ding-suru" href="#ASDF_304c_30aa_30d6_30b8_30a7_30af_30c8_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">4.3 ASDFがオブジェクトファイルを保持する場所を設定する</a></li>
    <li><a name="toc-ASDFnoShe-Ding-worisetutosuru" href="#ASDF_306e_8a2d_5b9a_3092_30ea_30bb_30c3_30c8_3059_308b">4.4 ASDFの設定をリセットする</a></li>
  </ul></li>
  <li><a name="toc-ASDFwoShi-u" href="#ASDF_3092_4f7f_3046">5 ASDFを使う</a>
  <ul class="no-bullet">
    <li><a name="toc-sisutemuworodosuru" href="#g_t_30b7_30b9_30c6_30e0_3092_30ed_30fc_30c9_3059_308b">5.1 システムをロードする</a></li>
    <li><a name="toc-Bian-Li-naGuan-Shu-" href="#g_t_4fbf_5229_306a_95a2_6570">5.2 便利な関数</a></li>
    <li><a name="toc-konoXian-heJin-mu" href="#g_t_3053_306e_5148_3078_9032_3080">5.3 この先へ進む</a></li>
  </ul></li>
  <li><a name="toc-defsystemdesisutemuwoDing-Yi-suru" href="#defsystem_3067_30b7_30b9_30c6_30e0_3092_5b9a_7fa9_3059_308b">6 defsystemでシステムを定義する</a>
  <ul class="no-bullet">
    <li><a name="toc-Dan-Chun-naLi" href="#g_t_5358_7d14_306a_4f8b">6.1 単純な例</a></li>
    <li><a name="toc-Fu-Za-naLi" href="#g_t_8907_96d1_306a_4f8b">6.2 複雑な例</a></li>
    <li><a name="toc-defsystemnoWenFa-" href="#defsystem_306e_6587_6cd5">6.3 defsystemの文法</a>
    <ul class="no-bullet">
      <li><a name="toc-sisutemuZhi-ShiZi-" href="#sisutemuZhi-ShiZi-">6.3.1 システム指示子</a></li>
      <li><a name="toc-Dan-Du-nokonponentoMing-_0028simple_002dcomponent_002dname_0029" href="#Dan-Du-nokonponentoMing-_0028simple_002dcomponent_002dname_0029">6.3.2 単独のコンポーネント名（<code>simple-component-name</code>）</a></li>
      <li><a name="toc-Fu-He-De-nakonponentoMing-" href="#Fu-He-De-nakonponentoMing-">6.3.3 複合的なコンポーネント名</a></li>
      <li><a name="toc-konponentoXing-" href="#konponentoXing-">6.3.4 コンポーネント型</a></li>
      <li><a name="toc-sisutemukurasuMing-" href="#sisutemukurasuMing-">6.3.5 システムクラス名</a></li>
      <li><a name="toc-defsystemnoYi-Cun-_0028_003adefsystem_002ddepends_002don_0029" href="#defsystemnoYi-Cun-_0028_003adefsystem_002ddepends_002don_0029">6.3.6 defsystemの依存（<code>:defsystem-depends-on</code>）</a></li>
      <li><a name="toc-birudooperesiyon_0028_003abuild_002doperation_0029" href="#birudooperesiyon_0028_003abuild_002doperation_0029">6.3.7 ビルドオペレーション（<code>:build-operation</code>）</a></li>
      <li><a name="toc-Ruo-iYi-Cun-Guan-Xi-_0028_003aweakly_002ddepends_002don_0029" href="#Ruo-iYi-Cun-Guan-Xi-_0028_003aweakly_002ddepends_002don_0029">6.3.8 弱い依存関係（<code>:weakly-depends-on</code>）</a></li>
      <li><a name="toc-pasuMing-Zhi-Ding-Zi-" href="#pasuMing-Zhi-Ding-Zi-">6.3.9 パス名指定子</a></li>
      <li><a name="toc-baziyonZhi-Ding-Zi-" href="#baziyonZhi-Ding-Zi-">6.3.10 バージョン指定子</a></li>
      <li><a name="toc-_003arequire-1" href="#g_t_003arequire-1">6.3.11 <code>:require</code></a></li>
      <li><a name="toc-huitiyaniYing-zitaYi-Cun-Guan-Xi-_0028_003afeature_0029" href="#huitiyaniYing-zitaYi-Cun-Guan-Xi-_0028_003afeature_0029">6.3.12 フィーチャーに応じた依存関係（<code>:feature</code>）</a></li>
      <li><a name="toc-Lun-Li-pasuMing-woShi-u" href="#Lun-Li-pasuMing-woShi-u">6.3.13 論理パス名を使う</a></li>
      <li><a name="toc-Lian-Sok-De-naYi-Cun-Guan-Xi-_0028_003aserial_0029" href="#Lian-Sok-De-naYi-Cun-Guan-Xi-_0028_003aserial_0029">6.3.14 連続的な依存関係（<code>:serial</code>）</a></li>
      <li><a name="toc-sosunoChang-Suo-_0028_003apathname_0029" href="#sosunoChang-Suo-_0028_003apathname_0029">6.3.15 ソースの場所（<code>:pathname</code>）</a></li>
      <li><a name="toc-huitiyaniYing-zitakonponento_0028_003aif_002dfeature_0029" href="#huitiyaniYing-zitakonponento_0028_003aif_002dfeature_0029">6.3.16 フィーチャーに応じたコンポーネント（<code>:if-feature</code>）</a></li>
      <li><a name="toc-entoripointo_0028_003aentry_002dpoint_0029" href="#entoripointo_0028_003aentry_002dpoint_0029">6.3.17 エントリーポイント（<code>:entry-point</code>）</a></li>
      <li><a name="toc-feature-requirement_0028Fei-Zhi-_0029" href="#feature-requirement_0028Fei-Zhi-_0029">6.3.18 feature requirement（廃止）</a></li>
    </ul></li>
    <li><a name="toc-_002easdhuairuZhongnoTa-nokodo" href="#g_t_002easd_30d5_30a1_30a4_30eb_4e2d_306e_4ed6_306e_30b3_30fc_30c9">6.4 .asdファイル中の他のコード</a></li>
    <li><a name="toc-package_002dinferred_002dsystemKuo-Zhang-" href="#package_002dinferred_002dsystem_62e1_5f35">6.5 package-inferred-system拡張</a></li>
  </ul></li>
  <li><a name="toc-ASDFnoobuziekutomoderu" href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">7 ASDFのオブジェクトモデル</a>
  <ul class="no-bullet">
    <li><a name="toc-operesiyon" href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">7.1 オペレーション</a>
    <ul class="no-bullet">
      <li><a name="toc-Zu-miIp-minooperesiyon" href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">7.1.1 組み込みのオペレーション</a></li>
      <li><a name="toc-Xin-siioperesiyonwoDing-Yi-suru" href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">7.1.2 新しいオペレーションを定義する</a></li>
    </ul></li>
    <li><a name="toc-konponento" href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">7.2 コンポーネント</a>
    <ul class="no-bullet">
      <li><a name="toc-konponentonoGong-Tong-noShu-Xing-" href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">7.2.1 コンポーネントの共通の属性</a>
      <ul class="no-bullet">
        <li><a name="toc-konponentoMing-" href="#konponentoMing-">7.2.1.1 コンポーネント名</a></li>
        <li><a name="toc-baziyonShi-Bie-Zi-_0028_003aversion_0029" href="#baziyonShi-Bie-Zi-_0028_003aversion_0029">7.2.1.2 バージョン識別子（<code>:version</code>）</a></li>
        <li><a name="toc-Bi-Yao-nahuitiya_0028_003aif_002dfeature_0029" href="#Bi-Yao-nahuitiya_0028_003aif_002dfeature_0029">7.2.1.3 必要なフィーチャー（<code>:if-feature</code>）</a></li>
        <li><a name="toc-akusiyonnoYi-Cun-Guan-Xi-_0028_003ain_002dorder_002dto_0029" href="#akusiyonnoYi-Cun-Guan-Xi-_0028_003ain_002dorder_002dto_0029">7.2.1.4 アクションの依存関係（<code>:in-order-to</code>）</a></li>
        <li><a name="toc-pasuMing-_0028_003apathname_0029" href="#pasuMing-_0028_003apathname_0029">7.2.1.5 パス名（<code>:pathname</code>）</a></li>
        <li><a name="toc-puropatei_0028_003aproperties_0029" href="#puropatei_0028_003aproperties_0029">7.2.1.6 プロパティ（<code>:properties</code>）</a></li>
      </ul></li>
      <li><a name="toc-konponentonoZu-miIp-minosabukurasu" href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">7.2.2 コンポーネントの組み込みのサブクラス</a></li>
      <li><a name="toc-Xin-siikonponentoXing-woDing-Yi-suru" href="#g_t_65b0_3057_3044_30b3_30f3_30dd_30fc_30cd_30f3_30c8_578b_3092_5b9a_7fa9_3059_308b">7.2.3 新しいコンポーネント型を定義する</a></li>
    </ul></li>
    <li><a name="toc-Yi-Cun-Guan-Xi-nituite" href="#g_t_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066">7.3 依存関係について</a></li>
    <li><a name="toc-Guan-Lian-suruGuan-Shu-" href="#g_t_95a2_9023_3059_308b_95a2_6570">7.4 関連する関数</a></li>
  </ul></li>
  <li><a name="toc-ASDFgasisutemuwoTan-suChang-Suo-woShe-Ding-suru" href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">8 ASDFがシステムを探す場所を設定する</a>
  <ul class="no-bullet">
    <li><a name="toc-sosurezisutorinoShe-Ding-" href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_8a2d_5b9a">8.1 ソースレジストリの設定</a></li>
    <li><a name="toc-Truenames-and-other-dangers-1" href="#Truenames-and-other-dangers">8.2 Truenames and other dangers</a></li>
    <li><a name="toc-XDGbesudeirekutori" href="#XDG_30d9_30fc_30b9_30c7_30a3_30ec_30af_30c8_30ea">8.3 XDGベースディレクトリ</a></li>
    <li><a name="toc-Hou-Fang-Hu-Huan-Xing-notamenoJi-Neng-" href="#g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">8.4 後方互換性のための機能</a></li>
    <li><a name="toc-sosurezisutoriwoShe-Ding-suruDSL" href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">8.5 ソースレジストリを設定するDSL</a></li>
    <li><a name="toc-She-Ding-deirekutori" href="#g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">8.6 設定ディレクトリ</a>
    <ul class="no-bullet">
      <li><a name="toc-_003aheredeirekuteibu" href="#g_t_003ahere_30c7_30a3_30ec_30af_30c6_30a3_30d6">8.6.1 <code>:here</code>ディレクティブ</a></li>
    </ul></li>
    <li><a name="toc-sieruXiang-kenoShe-Ding-noGou-Wen" href="#g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">8.7 シェル向けの設定の構文</a></li>
    <li><a name="toc-Tan-Suo-arugorizumu" href="#g_t_63a2_7d22_30a2_30eb_30b4_30ea_30ba_30e0">8.8 探索アルゴリズム</a></li>
    <li><a name="toc-sosurezisutorinokiyatusiyu" href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_30ad_30e3_30c3_30b7_30e5">8.9 ソースレジストリのキャッシュ</a></li>
    <li><a name="toc-sosurezisutorinoAPI" href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">8.10 ソースレジストリのAPI</a></li>
    <li><a name="toc-intorosupekusiyon" href="#g_t_30a4_30f3_30c8_30ed_30b9_307a_30af_30b7_30e7_30f3">8.11 イントロスぺクション</a>
    <ul class="no-bullet">
      <li><a name="toc-_002asource_002dregistry_002dparameter_002aBian-Shu-" href="#g_t_002asource_002dregistry_002dparameter_002a_5909_6570">8.11.1 <code>*source-registry-parameter*</code>変数</a></li>
      <li><a name="toc-sisutemunoYi-Cun-Guan-Xi-nituitenoQing-Bao-" href="#g_t_30b7_30b9_30c6_30e0_306e_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066_306e_60c5_5831">8.11.2 システムの依存関係についての情報</a></li>
    </ul></li>
    <li><a name="toc-Xian-Zhuang-" href="#g_t_73fe_72b6">8.12 現状</a></li>
    <li><a name="toc-Que-Xia-saretaaidea" href="#g_t_5374_4e0b_3055_308c_305f_30a2_30a4_30c7_30a2">8.13 却下されたアイデア</a></li>
    <li><a name="toc-TODO-1" href="#TODO">8.14 TODO</a></li>
    <li><a name="toc-sosurezisutoriniGuan-surukurezituto" href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306b_95a2_3059_308b_30af_30ec_30b8_30c3_30c8">8.15 ソースレジストリに関するクレジット</a></li>
  </ul></li>
  <li><a name="toc-ASDFgakonpairusaretahuairuwoBao-Chi-suruChang-Suo-woShe-Ding-suru" href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">9 ASDFがコンパイルされたファイルを保持する場所を設定する</a>
  <ul class="no-bullet">
    <li><a name="toc-autopututotoransuresiyonnoShe-Ding-" href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_8a2d_5b9a">9.1 アウトプットトランスレーションの設定</a></li>
    <li><a name="toc-Hou-Fang-Hu-Huan-Xing-notamenoJi-Neng--1" href="#g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">9.2 後方互換性のための機能</a></li>
    <li><a name="toc-autopututotoransuresiyonwoShe-Ding-suruDSL" href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">9.3 アウトプットトランスレーションを設定するDSL</a></li>
    <li><a name="toc-She-Ding-deirekutori-1" href="#g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">9.4 設定ディレクトリ</a></li>
    <li><a name="toc-sieruXiang-kenoShe-Ding-noGou-Wen-1" href="#g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">9.5 シェル向けの設定の構文</a></li>
    <li><a name="toc-autopututotoransuresiyonnosemanteikusu" href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_30bb_30de_30f3_30c6_30a3_30af_30b9">9.6 アウトプットトランスレーションのセマンティクス</a></li>
    <li><a name="toc-Caching-Results" href="#Output-Caching-Results">9.7 Caching Results</a></li>
    <li><a name="toc-Output-location-API-1" href="#Output-location-API">9.8 Output location API</a></li>
    <li><a name="toc-Credits-for-output-translations-1" href="#Credits-for-output-translations">9.9 Credits for output translations</a></li>
  </ul></li>
  <li><a name="toc-eraChu-Li-" href="#g_t_30a8_30e9_30fc_51e6_7406">10 エラー処理</a>
  <ul class="no-bullet">
    <li><a name="toc-ASDFnoera" href="#ASDFnoera">10.1 ASDFのエラー</a></li>
    <li><a name="toc-konpairuShi-noeraJing-Gao-noChu-Li-" href="#konpairuShi-noeraJing-Gao-noChu-Li-">10.2 コンパイル時のエラー・警告の処理</a></li>
  </ul></li>
  <li><a name="toc-Miscellaneous-additional-functionality-1" href="#Miscellaneous-additional-functionality">11 Miscellaneous additional functionality</a>
  <ul class="no-bullet">
    <li><a name="toc-Controlling-file-compilation-1" href="#Controlling-file-compilation">11.1 Controlling file compilation</a></li>
    <li><a name="toc-Controlling-source-file-character-encoding-1" href="#Controlling-source-file-character-encoding">11.2 Controlling source file character encoding</a></li>
    <li><a name="toc-Miscellaneous-Functions-1" href="#Miscellaneous-Functions">11.3 Miscellaneous Functions</a></li>
    <li><a name="toc-Some-Utility-Functions-1" href="#Some-Utility-Functions">11.4 Some Utility Functions</a></li>
  </ul></li>
  <li><a name="toc-Zui-Xin-Ban-woShou-niRu-reru" href="#g_t_6700_65b0_7248_3092_624b_306b_5165_308c_308b">12 最新版を手に入れる</a></li>
  <li><a name="toc-FAQ-1" href="#FAQ">13 FAQ</a>
  <ul class="no-bullet">
    <li><a name="toc-dokonibaguwoBao-Gao-surebayoidesuka" href="#g_t_3069_3053_306b_30d0_30b0_3092_5831_544a_3059_308c_3070_3088_3044_3067_3059_304b">13.1 どこにバグを報告すればよいですか</a></li>
    <li><a name="toc-meringurisuto" href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">13.2 メーリングリスト</a></li>
    <li><a name="toc-_0060_0060What-has-changed-between-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f_0027_0027" href="#What-has-changed-between-ASDF-1-ASDF-2-and-ASDF-3_003f">13.3 &ldquo;What has changed between ASDF 1, ASDF 2, and ASDF 3?&rdquo;</a>
    <ul class="no-bullet">
      <li><a name="toc-What-are-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f" href="#What-are-ASDF-1-2-3_003f">13.3.1 What are ASDF 1, ASDF 2, and ASDF 3?</a></li>
      <li><a name="toc-How-do-I-detect-the-ASDF-version_003f-1" href="#How-do-I-detect-the-ASDF-version_003f">13.3.2 How do I detect the ASDF version?</a></li>
      <li><a name="toc-ASDF-can-portably-name-files-in-subdirectories-1" href="#ASDF-can-portably-name-files-in-subdirectories">13.3.3 ASDF can portably name files in subdirectories</a></li>
      <li><a name="toc-Output-translations-1" href="#Output-translations">13.3.4 Output translations</a></li>
      <li><a name="toc-Source-Registry-Configuration-1" href="#Source-Registry-Configuration">13.3.5 Source Registry Configuration</a></li>
      <li><a name="toc-Usual-operations-are-made-easier-to-the-user-1" href="#Usual-operations-are-made-easier-to-the-user">13.3.6 Usual operations are made easier to the user</a></li>
      <li><a name="toc-Many-bugs-have-been-fixed-1" href="#Many-bugs-have-been-fixed">13.3.7 Many bugs have been fixed</a></li>
      <li><a name="toc-ASDF-itself-is-versioned-1" href="#ASDF-itself-is-versioned">13.3.8 ASDF itself is versioned</a></li>
      <li><a name="toc-ASDF-can-be-upgraded-1" href="#ASDF-can-be-upgraded">13.3.9 ASDF can be upgraded</a></li>
      <li><a name="toc-Decoupled-release-cycle-1" href="#Decoupled-release-cycle">13.3.10 Decoupled release cycle</a></li>
      <li><a name="toc-Pitfalls-of-the-transition-to-ASDF-2-1" href="#Pitfalls-of-the-transition-to-ASDF-2">13.3.11 Pitfalls of the transition to ASDF 2</a></li>
      <li><a name="toc-Pitfalls-of-the-upgrade-to-ASDF-3-1" href="#Pitfalls-of-the-upgrade-to-ASDF-3">13.3.12 Pitfalls of the upgrade to ASDF 3</a></li>
      <li><a name="toc-What-happened-to-the-bundle-operations_003f" href="#What-happened-to-the-bundle-operations">13.3.13 What happened to the bundle operations?</a></li>
    </ul></li>
    <li><a name="toc-Issues-with-installing-the-proper-version-of-ASDF-1" href="#Issues-with-installing-the-proper-version-of-ASDF">13.4 Issues with installing the proper version of ASDF</a>
    <ul class="no-bullet">
      <li><a name="toc-_0060_0060My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f_0027_0027" href="#My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f">13.4.1 &ldquo;My Common Lisp implementation comes with an outdated version of ASDF. What to do?&rdquo;</a></li>
      <li><a name="toc-_0060_0060I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f_0027_0027" href="#I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f">13.4.2 &ldquo;I&rsquo;m a Common Lisp implementation vendor. When and how should I upgrade ASDF?&rdquo;</a></li>
      <li><a name="toc-After-upgrading-ASDF_002c-ASDF-_0028and-Quicklisp_0029-can_0027t-find-my-systems" href="#After-upgrading-ASDF">13.4.3 After upgrading ASDF, ASDF (and Quicklisp) can&rsquo;t find my systems</a></li>
    </ul></li>
    <li><a name="toc-Issues-with-configuring-ASDF-1" href="#Issues-with-configuring-ASDF">13.5 Issues with configuring ASDF</a>
    <ul class="no-bullet">
      <li><a name="toc-_0060_0060How-can-I-customize-where-fasl-files-are-stored_003f_0027_0027" href="#How-can-I-customize-where-fasl-files-are-stored_003f">13.5.1 &ldquo;How can I customize where fasl files are stored?&rdquo;</a></li>
      <li><a name="toc-_0060_0060How-can-I-wholly-disable-the-compiler-output-cache_003f_0027_0027" href="#How-can-I-wholly-disable-the-compiler-output-cache_003f">13.5.2 &ldquo;How can I wholly disable the compiler output cache?&rdquo;</a></li>
    </ul></li>
    <li><a name="toc-Issues-with-using-and-extending-ASDF-to-define-systems-1" href="#Issues-with-using-and-extending-ASDF-to-define-systems">13.6 Issues with using and extending ASDF to define systems</a>
    <ul class="no-bullet">
      <li><a name="toc-_0060_0060How-can-I-cater-for-unit_002dtesting-in-my-system_003f_0027_0027" href="#How-can-I-cater-for-unit_002dtesting-in-my-system_003f">13.6.1 &ldquo;How can I cater for unit-testing in my system?&rdquo;</a></li>
      <li><a name="toc-_0060_0060How-can-I-cater-for-documentation-generation-in-my-system_003f_0027_0027" href="#How-can-I-cater-for-documentation-generation-in-my-system_003f">13.6.2 &ldquo;How can I cater for documentation generation in my system?&rdquo;</a></li>
      <li><a name="toc-_0060_0060How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f_0027_0027" href="#How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f">13.6.3 &ldquo;How can I maintain non-Lisp (e.g. C) source files?&rdquo;</a></li>
      <li><a name="toc-_0060_0060I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f_0027_0027" href="#I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f">13.6.4 &ldquo;I want to put my module&rsquo;s files at the top level.  How do I do this?&rdquo;</a></li>
      <li><a name="toc-How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f-1" href="#How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f">13.6.5 How do I create a system definition where all the source files have a .cl extension?</a></li>
      <li><a name="toc-How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f-1" href="#How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f">13.6.6 How do I mark a source file to be loaded only and not compiled?</a></li>
      <li><a name="toc-How-do-I-work-with-readtables_003f-1" href="#How-do-I-work-with-readtables_003f">13.6.7 How do I work with readtables?</a>
      <ul class="no-bullet">
        <li><a name="toc-How-should-my-system-use-a-readtable-exported-by-another-system_003f" href="#How-should-my-system-use-a-readtable-exported-by-another-system_003f">13.6.7.1 How should my system use a readtable exported by another system?</a></li>
        <li><a name="toc-How-should-my-library-make-a-readtable-available-to-other-systems_003f" href="#How-should-my-library-make-a-readtable-available-to-other-systems_003f">13.6.7.2 How should my library make a readtable available to other systems?</a></li>
      </ul></li>
      <li><a name="toc-How-can-I-capture-ASDF_0027s-output_003f-1" href="#How-can-I-capture-ASDF_0027s-output_003f">13.6.8 How can I capture ASDF&rsquo;s output?</a></li>
      <li><a name="toc-_002aLOAD_002dPATHNAME_002a-and-_002aLOAD_002dTRUENAME_002a-have-weird-values_002c-help_0021" href="#LOAD_002dPATHNAME-has-a-weird-value">13.6.9 *LOAD-PATHNAME* and *LOAD-TRUENAME* have weird values, help!</a></li>
    </ul></li>
    <li><a name="toc-ASDF-development-FAQs-1" href="#ASDF-development-FAQs">13.7 ASDF development FAQs</a>
    <ul class="no-bullet">
      <li><a name="toc-How-do-I-run-the-tests-interactively-in-a-REPL_003f-1" href="#How-do-I-run-the-tests-interactively-in-a-REPL_003f">13.7.1 How do I run the tests interactively in a REPL?</a></li>
    </ul></li>
  </ul></li>
  <li><a name="toc-ASDFpuroziekutodeJin-Xing-ZhongnoZuo-Ye-" href="#ASDF_30d7_30ed_30b8_30a7_30af_30c8_3067_9032_884c_4e2d_306e_4f5c_696d">ASDFプロジェクトで進行中の作業</a></li>
  <li><a name="toc-Can-Kao-WenXian-" href="#g_t_53c2_8003_6587_732e">参考文献</a></li>
  <li><a name="toc-Suo-Yin-_0028Yong-Yu-_0029" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09">索引（用語）</a></li>
  <li><a name="toc-Suo-Yin-_0028Guan-Shu-tomakuro_0029" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09">索引（関数とマクロ）</a></li>
  <li><a name="toc-Suo-Yin-_0028Bian-Shu-_0029" href="#g_t_7d22_5f15_ff08_5909_6570_ff09">索引（変数）</a></li>
  <li><a name="toc-Suo-Yin-_0028kurasutoXing-_0029" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09">索引（クラスと型）</a></li>
</ul>
</div>




<a name="Top"></a>
<a name="ASDF_003a-Another-System-Definition-Facility"></a>
<h1 class="top">ASDF: Another System Definition Facility</h1>
<p>バージョン3.3.2.13 (2018-12-17) マニュアル
</p>
<p>このマニュアルはASDF――Common Lispプログラムとライブラリのためのシス
テム定義ツール――について解説したものです。
</p>
<p>このマニュアルの最新バージョン（訳注: 英語版）は以下にあります:
<a href="https://common-lisp.net/project/asdf/asdf.html">https://common-lisp.net/project/asdf/asdf.html</a> </p>
<p>[訳者補足]
</p>
<p>この非公式の日本語訳は、ASDFの公式リポジトリのフォークとしてGitLab上で編集されています。（<a href="https://gitlab.common-lisp.net/hishimaru/asdf/tree/ja">https://gitlab.common-lisp.net/hishimaru/asdf/tree/ja</a>） 翻訳に関する訂正、意見などは常に歓迎します。その際は<a href="https://gitlab.common-lisp.net/hishimaru/asdf/issues">Issues</a>を使っていただけると確実です。
</p>
<p>[訳者補足終わり]
</p>

<p>ASDF Copyright &copy; 2001-2018 Daniel Barlow and contributors.
</p>
<p>This manual Copyright &copy; 2001-2018 Daniel Barlow and contributors.
</p>
<p>This manual revised &copy; 2009-2018 Robert P. Goldman and Francois-Rene Rideau.
</p>
<p>This manual translated into Japanese &copy; 2018 Hugo Ishimaru.
</p>
<p>Permission is hereby granted, free of charge, to any person obtaining
a copy of this software and associated documentation files (the
&ldquo;Software&rdquo;), to deal in the Software without restriction, including
without limitation the rights to use, copy, modify, merge, publish,
distribute, sublicense, and/or sell copies of the Software, and to
permit persons to whom the Software is furnished to do so, subject to
the following conditions:
</p>
<p>The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.
</p>
<p>THE SOFTWARE IS PROVIDED &ldquo;AS IS&rdquo;, WITHOUT WARRANTY OF ANY KIND,
EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF
MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION
OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION
WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</p>




<hr>
<a name="g_t_306f_3058_3081_306b"></a>
<a name="hazimeni"></a>
<h2 class="chapter">1 はじめに</h2>
<a name="index-ASDF_002drelated-features"></a>
<a name="index-_002afeatures_002a-1"></a>
<a name="index-Testing-for-ASDF"></a>
<a name="index-ASDF-versions"></a>
<a name="index-_003aasdf"></a>
<a name="index-_003aasdf2"></a>
<a name="index-_003aasdf3"></a>

<p>ASDF (Another System Definition Facility) は<em>ビルドシステム</em>です。ASDFは、システムがどのようなコンポーネント（＝サブシステムとファイル）を含んでいるか、それらにどの順序でどういう操作をすれば良いか記述するためのツールであり、Common Lispソフトウェアのコンパイル・ロード・テストなどを支援します。ASDFを使ったことがない方は、<a href="#g_t_30af_30a4_30c3_30af_30b9_30bf_30fc_30c8_30ac_30a4_30c9">クイックスタートガイド</a>を読むと良いでしょう。
</p>
<p>このマニュアルは３つのケースを想定して書かれています: １つ目は、ユーザーとして他人のコードを使いたい場合であり、２つ目は、開発者としてシステムをビルドする手順を記述したい場合です。そして３つ目は、（ASDFのような）Common Lisp拡張の実装者として、ビルドシステムそのものに関わりたい場合です。より具体的には、<a href="#ASDF_3092_4f7f_3046">ASDFを使う</a>にシステムをロードする方法が、<a href="#defsystem_3067_30b7_30b9_30c6_30e0_3092_5b9a_7fa9_3059_308b">defsystemでシステムを定義する</a>にシステムを定義する方法が、<a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a>にASDFの内部仕様と拡張方法が書かれています。
</p>
<p>ASDFはライブラリやシステムを<em>インストールするためのツールではありません</em>。ASDFの役割は言うなれば<code>make</code>や<code>ant</code>のようなものであり、パッケージマネージャとしての機能は持ちません。特に、QuicklispやASDF-InstallのようにASDFシステムを探してダウンロードするツールと、ASDFそのものとを混同しないようにしましょう。ASDF-Installは、その名に反してASDFの一部ではなく独立したソフトウェアであり、また、ずっと前からメンテナンスされておらず、使われてもいません。我々は代わりに<a href="http://www.quicklisp.org/">Quicklisp</a>を推奨します。Quicklispは優秀なパッケージマネージャであり、現在もメンテナンスが続いています。もしあなたが、自分でコードを修正できるように、tarアーカイブではなくバージョン管理システムのリポジトリからソフトウェアを手に入れたい場合は、<a href="http://common-lisp.net/project/clbuild/">clbuild</a>を使うと良いでしょう。
ソフトウェアをインストールする場所としては<samp>~/common-lisp/</samp>を推奨します。ASDF 3.1.2 (2014)からは、このディレクトリは<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ソースレジストリ</a>の既定のパスに含まれています。<a name="DOCF1" href="#FOOT1"><sup>1</sup></a>
</p>
<p>なお、このマニュアルは未完成です。基本事項はすべて網羅されていますが、多くの発展的な話題についてはわずかに触れているのみですし、例もあまり多くはありません。最終的な情報源はソースコードであり、使用例についてはQuicklispに登録されているフリーソフトウェアを参照するのがベストでしょう。また、助言を得る場所としては、<a href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">メーリングリスト</a>が良いでしょう。
</p>

<hr>
<a name="g_t_30af_30a4_30c3_30af_30b9_30bf_30fc_30c8_30ac_30a4_30c9"></a>
<a name="kuitukusutatogaido"></a>
<h2 class="chapter">2 クイックスタートガイド</h2>

<ul>
<li> ASDFシステムをロードする:

<ul>
<li> まず、<code>(require &quot;asdf&quot;)</code>でASDFそのものをLispイメージにロードします。ASDFのバージョンは<code>(asdf:asdf-version)</code>で確認できます。これらがうまく動かない場合など、ロードの詳細については<a href="#ASDF_3092_30ed_30fc_30c9_3059_308b">ASDFをロードする</a>を参照してください。


</li><li> ASDFの探すパスにソフトウェアが置かれていることを確認してください。もっとも簡単なのはすべてのLispコードを<samp>~/common-lisp/</samp>（ASDF 3.1.2以降）か<samp>~/.local/share/common-lisp/source/</samp>（ASDF 2以降、もしくは隠しディレクトリを使いたい場合）のサブディレクトリに置くことです。詳しくは<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b">ASDFがシステムを見つけられるように設定する</a>を参照してください。

</li><li> <code>(asdf:load-system &quot;<var>my-system</var>&quot;)</code>でお望みのシステムをロードします。（→ <a href="#ASDF_3092_4f7f_3046">ASDFを使う</a>）

</li></ul>

</li><li> ASDFシステムを作る:

<ul>
<li> 上と同様に、まずはASDFそのものをロード、設定します。

</li><li> ASDFの探すパスに新しいディレクトリ<samp><var>my-system</var>/</samp>を作ります。<samp>~/common-lisp/<var>my-system</var>/</samp>を使うのがもっとも簡単でしょう。（→ <a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b">ASDFがシステムを見つけられるように設定する</a>）


</li><li> <samp><var>my-system</var>.asd</samp>ファイルに、システムとそのコンポーネントの依存関係（とさらにそれらの相互依存関係）を、システム定義として記述します。このファイル名はすべて小文字で、かつシステムの名前と一致していなければなりません。（→ <a href="#defsystem_3067_30b7_30b9_30c6_30e0_3092_5b9a_7fa9_3059_308b">defsystemでシステムを定義する</a>）

</li><li> <code>(asdf:load-system &quot;<var>my-system</var>&quot;)</code>を実行して、すべてがうまくいっていることを確認しましょう。（→ <a href="#ASDF_3092_4f7f_3046">ASDFを使う</a>）

</li></ul>
</li></ul>





<hr>
<a name="ASDF_3092_30ed_30fc_30c9_3059_308b"></a>
<a name="ASDFworodosuru"></a>
<h2 class="chapter">3 ASDFをロードする</h2>


<hr>
<a name="g_t_30a4_30f3_30b9_30c8_30fc_30eb_6e08_307f_306eASDF_3092_30ed_30fc_30c9_3059_308b"></a>
<a name="insutoruJi-minoASDFworodosuru"></a>
<h3 class="section">3.1 インストール済みのASDFをロードする</h3>

<p>ASDFをロードする際は、次のフォームを実行するとよいでしょう:
</p><div class="lisp">
<pre class="lisp">(require &quot;asdf&quot;)
</pre></div>

<p>現在メンテナンスされているすべてのLisp処理系にはASDF 3が含まれており、<code>require</code>関数でロードすることができます。<a name="DOCF2" href="#FOOT2"><sup>2</sup></a>
</p>
<p>お使いの処理系に最近のASDF 3が含まれていない場合、処理系をアップグレードすると良いでしょう。何らかの理由でアップグレードできない場合は、ASDFを置き換えることを勧めます。（→ <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>）それもできない場合は<a href="#ASDF_3092_30bd_30fc_30b9_304b_3089_30ed_30fc_30c9_3059_308b">ASDFをソースからロードする</a>を参照してください。
</p>
<p>もしあなたがアクティブにメンテナンスされているLisp処理系を使っていて、ASDFの最新安定版が付属していない場合は、ベンダーにバグレポートを送ってこの点を訴えるのも良いでしょうし、あるいは、フリーソフトウェアの場合は自分で直すのも良いでしょう。
</p>
<p>このマニュアルの執筆時点では、次の処理系がASDF 3を提供しています:
ABCL、Allegro CL、CLASP、Clozure CL、CMUCL、ECL、GNU CLISP、LispWorks、MKCL、SBCL。
次の処理系はASDF 2です:
MOCL、XCL。
次の処理系はASDFを提供していません:
Corman CL、GCL、Genera、MCL、SCL。
後半に挙げた処理系は現在メンテナンスされていません（おそらくGCLを除く）。それらが再びリリースされることがあれば、ASDF 3を含むことでしょう。
</p>
<p>利便性のために、Lisp処理系が起動するときにASDFが自動でロードされるようにしたい方もいるかもしれません。これを実現するには例えば、起動スクリプトにロードの処理を加えたり、ASDFが含まれるカスタムコアをダンプしたりといった方法がありますが、詳細はお使いの処理系のマニュアルに求めるべきでしょう。また、SLIMEの<code>slime-asdf</code>拡張はASDFを扱いやすくする機能として、特筆に値します。
</p>

<hr>
<a name="ASDF_304c_30ed_30fc_30c9_3055_308c_3066_3044_308b_304b_8abf_3079_308b"></a>
<a name="ASDFgarodosareteirukaDiao-beru"></a>
<h3 class="section">3.2 ASDFがロードされているか調べる</h3>

<p>次のフォームを実行すると、ASDFが正しくロードされたか調べることができます:
</p>
<div class="lisp">
<pre class="lisp">(asdf:asdf-version)
</pre></div>

<p>文字列が返った場合、それは現在インストールされているASDFのバージョンを表します。表示されているバージョンが十分に新しければ（例えば3.1.2以降ならば）次の章に進んでかまいません。（→ <a href="#ASDF_3092_8a2d_5b9a_3059_308b">ASDFを設定する</a>）
</p>
<p>エラーになる場合は、ASDFがロードされていないか、あるいは、はるか昔のバージョンを使っているのでASDF 3に更新する必要があるか、でしょう。
</p>
<p>バージョンを判定するための詳細は、<a href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a>を参照するとよいでしょう。
</p>
<p>ASDFに関するトラブルに直面したときは、我々のところにイシューを立てる前に、まず下に示す方法で最新のリリースにアップグレードしてみてください。
</p>
<hr>
<a name="ASDF_3092_30a2_30c3_30d7_30b0_30ec_30fc_30c9_3059_308b"></a>
<a name="ASDFwoatupuguredosuru"></a>
<h3 class="section">3.3 ASDFをアップグレードする</h3>

<p>お使いの処理系にすでにASDF 3以降が付属している場合（そのはずです）、さらに新しいバージョンを使いたければ、ほかのシステムと同様に、設定で決まっているパスにただ新しいASDFをインストールすれば良いです。
具体的には、公式のtarボールかgitリポジトリを<samp>~/common-lisp/asdf/</samp>に展開することを勧めます。<a name="DOCF3" href="#FOOT3"><sup>3</sup></a>（→ <a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b">ASDFがシステムを見つけられるように設定する</a>）
</p>
<p>ASDFのソースコードがいったん正しい場所に置かれれば、これまで通り<code>(require &quot;asdf&quot;)</code>を実行するだけで新しいASDFがロードされます。ASDF 3は、他のシステムのコンパイルを行う前に、自身の新しいバージョンが所定のパスに存在するかどうかを自動的に判断し、存在する場合には新しいバージョンを使います。
</p>
<p>お使いの処理系にASDF 3以降が付属していない場合は、<a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>を参照してください。
</p>

<hr>
<a name="g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b"></a>
<a name="Chu-Li-Xi-Fu-Shu-noASDFwoZhi-kiHuan-eru"></a>
<h3 class="section">3.4 処理系付属のASDFを置き換える</h3>

<p>現在もメンテナンスされている処理系であれば最新版にはASDF 3が付属しているので、お使いのものに含まれていない場合は最新版にアップグレードすることを勧めます。
</p>
<p>ASDFが付属していない、あるいは古いバージョンが付属している処理系を使い続けたい場合は、下記の通りに最近のASDFをインストールすることを勧めます。その際、書き込みのアクセス権を変えたり、管理者権限で実行したりといったことが必要になるかもしれません。
</p>
<p>ASDFのソースリポジトリには、処理系のASDFをアップグレードするためのスクリプトファイルが含まれており、シェルから<code>tools/asdf-tools install-asdf lispworks</code>（<code>lispworks</code>は適切な処理系の名前に変えてください）で呼び出したり、REPLから<code>(load &quot;tools/install-asdf.lisp&quot;)</code>で実行したりできます。
</p>
<p>このスクリプトが動作する処理系はAllegro CL、Clozure CL、CMU CL、ECL、GCL、GNU CLISP、LispWorks、MKCL、SBCL、SCL、XCLです。ABCL、Corman CL、Genera、MCL、MOCLでは動きません。幸いなことに、ABCLにはたいてい最新のASDFが付属しているので、このスクリプトは必要ないでしょう。GCLで動かすには最近のバージョンが必要であり、また、十分なテストがなされていません。Corman CL、Genera、MCLはもはや使われていない処理系であり、MOCLは未完成です。
</p>

<hr>
<a name="ASDF_3092_30bd_30fc_30b9_304b_3089_30ed_30fc_30c9_3059_308b"></a>
<a name="ASDFwososukararodosuru"></a>
<h3 class="section">3.5 ASDFをソースからロードする</h3>

<p>もしもあなたがポータブルなビルドスクリプトを書きたいのであれば――つまり最新のASDFを備えているとは限らないような古いマシンと処理系でも動くスクリプトを書きたい場合には――<samp>asdf.lisp</samp>をどこかに置いた上で、
</p>
<div class="lisp">
<pre class="lisp">(load &quot;/path/to/your/installed/asdf.lisp&quot;)
</pre></div>

<p>でロードしなければならないかもしれません。
</p>

<p>通常、ASDFを使うために必要なのは<samp>asdf.lisp</samp>だけです。このファイルを<a href="https://common-lisp.net/project/asdf/">ASDF ウェブサイト</a>上の最新リリースのtarボールから得ると良いでしょう。
</p>
<p>バグを報告する場合には、gitリポジトリから最新版を得ることができます。<a href="#g_t_6700_65b0_7248_3092_624b_306b_5165_308c_308b">最新版を手に入れる</a>を参照してください。
</p>
<p>スクリプトの冒頭に<code>require</code>を置いてASDFを使おうとしたが、それがうまくいかないので難しいやり方でロードを試みる、というような場合には、ソースリポジトリにある<samp>tools/load-asdf.lisp</samp>を参考にするか、<a href="https://cliki.net/cl-launch">cl-launch</a>のコードを見るとよいでしょう。
</p>

<hr>
<a name="ASDF_3092_8a2d_5b9a_3059_308b"></a>
<a name="ASDFwoShe-Ding-suru"></a>
<h2 class="chapter">4 ASDFを設定する</h2>

<p>標準的な使い方をする限り、ASDFを使うのに追加設定は必要ないでしょう。以下のセクションはざっと流し読みして、自分のシステムにパスを通す方法を知り、自分に適した（Lispソフトウェアの）インストール方法を選びましょう。そして、そのまま<a href="#ASDF_3092_4f7f_3046">ASDFを使う</a>に進めば十分です。ASDFがオブジェクトファイルをどのように保持しているか意識しなければならないことはめったにないでしょうし、ASDFの設定をリセットする必要にせまられるのもたいていはコーナーケースにおいてのみ起こることです。
</p>

<hr>
<a name="ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b"></a>
<a name="ASDFgasisutemuwoJian-tukerareruyouniShe-Ding-suru"></a>
<h3 class="section">4.1 ASDFがシステムを見つけられるように設定する</h3>


<p>システムをコンパイル、ロードするためには、システム定義の書かれた<samp>.asd</samp>ファイルをASDFが見つけられるように設定しなければなりません。これには簡単なものから複雑なものまで、多数のやり方があります:
</p>
<ul>
<li> 標準のディレクトリを使い、すべてのシステムをそのサブディレクトリに置きます。標準のディレクトリとは、
<ul>
<li> <samp>~/common-lisp/</samp> または
</li><li> <samp>~/.local/share/common-lisp/source/</samp>
</li></ul>
<p>のことです。これらの場所にソフトウェアをインストールするなら特に追加設定は必要ないので、<a name="DOCF4" href="#FOOT4"><sup>4</sup></a>
次のセクションに進んでかまいません。（→ <a href="#g_t_30b7_30b9_30c6_30e0_3092_30ed_30fc_30c9_3059_308b">システムをロードする</a>）
</p>
</li><li> Quicklispのようなパッケージインストーラを使っている場合、既にそれらがASDFの設定を済ませているでしょう。

</li><li> より具体的にソフトウェアをインストールする場所を指定したいのであれば、<code>source-registry</code>機能を使って、ASDFがシステムを探すパスを設定するのがもっともよい方法です。この機能は１つの章を充てて（<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがシステムを探す場所を設定する</a>）網羅的に解説しますので、ここでは簡単な使い方を説明するにとどめます。


<p>まず初めに<samp>~/.config/common-lisp/source-registry.conf.d/</samp>ディレクトリ
<a name="DOCF5" href="#FOOT5"><sup>5</sup></a>
を作り、このディレクトリに拡張子が<samp>.conf</samp>
<a name="DOCF6" href="#FOOT6"><sup>6</sup></a>
のファイルを作ります。例えば<samp>50-luser-lisp.conf</samp>という名前のファイルを作ったとしましょう。このファイルに
<code>(:tree &quot;/home/luser/lisp/&quot;)</code>
という記述を加えると、ASDFは<samp>/home/luser/lisp/</samp>以下のディレクトリを再帰的にスキャンして、すべての<samp>.asd</samp>ファイルを見つけるようになります。
</p>
<p>これで完了です。<samp>/home/luser/lisp/</samp>はソースコードをインストールしたい場所に自由に置き換えてください。ASDF 3.1.2以降で<samp>~/common-lisp/</samp>を使う限り、このような設定は必要ありませんが、それ以前のASDF 3を使っている場合、最近のASDFを<samp>~/common-lisp/asdf/</samp>に置いた上で、ブートストラップのために<samp>.conf</samp>ファイルに<code>(:tree (:home &quot;common-lisp/&quot;))</code>を加える、というようなテクニックが必要かもしれません、
</p>
<p>別のやり方として、１つのディレクトリに<samp>.asd</samp>ファイルへのリンクを集める方式もあります。この方式は上記の再帰的なスキャンに比べると速いですが、管理は大変になります。リンクを集めるディレクトリを<samp>/home/luser/.asd-link-farm/</samp>としましょう。この場合は、ソースレジストリディレクトリに例えば<samp>42-asd-link-farm.conf</samp>ファイルを作り、<code>(:directory &quot;/home/luser/.asd-link-farm/&quot;)</code>という行を加えれば有効になります。
</p>


<p>ASDFは初めてシステムを探すときに自動的に<samp>.conf</samp>ファイルを読み込みますが、必要であれば、
</p>
<div class="lisp">
<pre class="lisp">(asdf:clear-source-registry)
</pre></div>

<p>でソースレジストリの設定をリセットすることができます。（→ <a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a>）
</p>
</li><li> ASDFの古いバージョンでは、システムのソースレジストリはグローバル変数<code>asdf:*central-registry*</code>を使って設定されていました。詳細については次のセクション（<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b_ff08_53e4_3044_30b9_30bf_30a4_30eb_ff09">ASDFがシステムを見つけられるように設定する（古いスタイル）</a>）を参照してください。これについて知る必要がなければ、飛ばして<a href="#ASDF_304c_30aa_30d6_30b8_30a7_30af_30c8_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがオブジェクトファイルを保持する場所を設定する</a>に進みましょう。

</li></ul>

<p>なお、あなたのOSディストリビューションやシステム管理者が、既にシステム全体のライブラリ管理を設定しているというケースもあることに注意してください。
</p>


<hr>
<a name="ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b_ff08_53e4_3044_30b9_30bf_30a4_30eb_ff09"></a>
<a name="ASDFgasisutemuwoJian-tukerareruyouniShe-Ding-suru_0028Gu-isutairu_0029"></a>
<h3 class="section">4.2 ASDFがシステムを見つけられるように設定する（古いスタイル）</h3>


<p>初心者はこのセクションを飛ばしてかまいません。初心者は<code>asdf:*central-registry*</code>を<em>使わないでください</em>。また、初心者に<code>asdf:*central-registry*</code>を使うよう<em>教えないでください</em>。
</p>

<p>古いASDFでは、システムを探す場所を設定するのに、<code>asdf:*central-registry*</code>にディレクトリのパス名を<code>push</code>する、という方法が使われていました。
</p>
<p>この変数を設定するのは、ASDF 3以降をロードした<em>後</em>、ASDFの機能を使う<em>前</em>でなければなりません。このロードと設定は、初期設定スクリプトの一部として実行されなければなりません。典型的には、自分のプロジェクトをビルドするスクリプトか、処理系の初期設定スクリプト（例: SBCLの<samp>~/.sbclrc</samp>）がこれにあたります。
</p>
<p>また、あなたがASDF 2以前を使っていて、ASDF 3以降を後からロードするという場合は、ASDF 1または2がロードされた後にASDF 3の場所を<code>asdf:*central-registry*</code>で設定し、その上でASDF 3を<code>(asdf:operate 'asdf:load-op &quot;asdf&quot;)</code>などでロードし、ロード後に再び<code>asdf:*central-registry*</code>を設定する、という流れになります。というのも、ASDF 2からASDF 3へアップグレードする時に<code>asdf:*central-registry*</code>は保持されないからです。もっとも、前セクションの方法で設定されたソースレジストリはアップグレードの影響を受けないので、おそらくそちらを使ったほうが良いでしょう。（ただし、ASDF 2で<code>asdf:initialize-source-registry</code>を引数付きで実行した場合は別で、この場合はASDF 3で再び実行する必要があります。）しかし我々は、あなたがASDF 2以前を使っている場合は、処理系をアップグレードするなり、ASDFを最近のバージョンに置き換えるなりすることを<em>強く</em>推奨します。（→ <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>）
</p>
<p><code>asdf:*central-registry*</code>は、ASDF 2または3ではデフォルトで空であり、ASDF 1との互換性のために残されています。この変数を使った設定は、上記のソースレジストリの設定に優先します。<a name="DOCF7" href="#FOOT7"><sup>7</sup></a>
</p>
<p>例として、<samp>/home/me/src/foo/foo.asd</samp>がASDFに見つかるようにしてみます。お使いの処理系の初期設定ファイルに、次のようなフォームを加えてください:
</p>
<div class="lisp">
<pre class="lisp">(require &quot;asdf&quot;)
(push &quot;/home/me/src/foo/&quot; asdf:*central-registry*)
</pre></div>


<p>末尾のスラッシュが必要なことに注意してください。システムを探すとき、ASDFは<code>asdf:*central-registry*</code>のそれぞれの要素をパス名に変換します。正確に言うと、それぞれの要素は<code>eval</code>されます。つまり、S式を<code>asdf:*central-registry*</code>に<code>push</code>することも可能です。文字列やパス名は自己評価オブジェクトなので<code>eval</code>は何もしませんが、S式を使うと、シェル変数やユーザーに応じた値を返すなど、コンテキストに依存した設定をすることができます。なお、<code>nil</code>に評価された場合、その要素はスキップされます。
</p>

<p>このように、<code>asdf:*central-registry*</code>は「システムディレクトリ指示子」のリストであると言えます。<em>システムディレクトリ指示子(system directory desinator)</em>はシステムを探すときに実行されるフォームであり、ディレクトリ（あるいは<code>nil</code>）を返さなくてはなりません。ここでいう「ディレクトリ」とは「空でないディレクトリコンポーネントを持つパス名の指示子」<a name="DOCF8" href="#FOOT8"><sup>8</sup></a>のことです。
</p>
<p>パス名の末尾のスラッシュは、ファイルではなくディレクトリを指していることを示すのに必要です。このスラッシュがないと、（古い）ASDFは<code>/home/me/src/foo/</code>ではなく<code>/home/me/src/</code>を探してしまうおそれがあります。現在のバージョンでは、単にエラーを通知し、<code>asdf:*central-registry*</code>からこのエントリを取り除くリスタートが起動するでしょう。
</p>

<p>多くの場合、<samp>.asd</samp>ファイルは大量にありますから、それらの存在するディレクトリを１つ１つ<code>asdf:*central-registry*</code>に<code>push</code>するよりは、各<samp>.asd</samp>ファイルの<em>シンボリックリンク</em>を１つの共通ディレクトリに置き、そのディレクトリだけを<code>push</code>するという方法が使われていました。ASDFはシステムへの<em>シンボリックリンク</em>を適切に解釈することができます。<a name="DOCF9" href="#FOOT9"><sup>9</sup></a>
</p>
<p>例えば<code>#p&quot;/home/me/cl/systems/&quot;</code>が<code>*central-registry*</code>に含まれているとき、次のようにセットアップすれば<var>foo</var>システムを使えるようになります。
</p>
<div class="example">
<pre class="example">$ cd /home/me/cl/systems/
$ ln -s ~/src/foo/foo.asd .
</pre></div>

<p>なお、このセクションの設定方法は古いやり方であり、新しいユーザーには推奨されません。古くからのユーザーや、ASDFのパスをプログラムによって簡単にコントロールしたいユーザーのために残されています。
</p>

<hr>
<a name="ASDF_304c_30aa_30d6_30b8_30a7_30af_30c8_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b"></a>
<a name="ASDFgaobuziekutohuairuwoBao-Chi-suruChang-Suo-woShe-Ding-suru"></a>
<h3 class="section">4.3 ASDFがオブジェクトファイルを保持する場所を設定する</h3>
<a name="index-clear_002doutput_002dtranslations"></a>

<p>ASDFがオブジェクトファイルを保存する場所は、あなた自身が設定することもできますが、デフォルトの設定は適切に考えられたものになっているので、通常のケースではこの領域を気にするべきではありません。
</p>
<p>デフォルトの仕組みによって、複数のLisp処理系の複数のバージョン間で同じソースコードリポジトリを共有することができますし、さらには複数のユーザー（ソースディレクトリへの書き込み権限のないユーザーを含む）、複数のコンパイルオプションなども区別可能です。また、ソースコードのディレクトリがオブジェクトファイル（faslファイル）で散らかることもありません。
</p>
<p>ASDF 2以降には<code>asdf-output-translations</code>機能が備わっていて、オブジェクトファイルが保存される場所をコントロールすることができます。この機能については<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a>で網羅的に解説します。
</p>











<p>ASDF 2以前では、同様の機能はASDF-Binary-Locations、cl-launch、common-lisp-controllerなどといった、それぞれ微妙に異なる非互換な方式で提供されていました。ASDF-Binary-Locationsはもはや不要な拡張なので使うべきではありませんし、cl-launch 3.000とcommon-lisp-controller 7.2はオブジェクトファイルの配置をASDFに委ねています。
</p>
<hr>
<a name="ASDF_306e_8a2d_5b9a_3092_30ea_30bb_30c3_30c8_3059_308b"></a>
<a name="ASDFnoShe-Ding-worisetutosuru"></a>
<h3 class="section">4.4 ASDFの設定をリセットする</h3>



<p>Lispのコアイメージをダンプしてから復元するときや、設定を変更するときなどは、いったんASDFの設定をリセットしたいことがあるでしょう。このために次の関数があります。
</p>
<dl>
<dt><a name="index-clear_002dconfiguration"></a>関数: <strong>clear-configuration</strong></dt>
<dd><p>ASDFの設定をデフォルトに戻します。具体的には、<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ソースレジストリ</a>と<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>の設定が消去されます。<a name="DOCF10" href="#FOOT10"><sup>10</sup></a>
</p></dd></dl>

<a name="index-_002aimage_002ddump_002dhook_002a"></a>
<p>この関数はデフォルトで<code>uiop:*image-dump-hook*</code>にプッシュされているので、<code>uiop:dump-image</code>や<code>asdf:image-op</code>、<code>asdf:program-op</code>などを使ってイメージを保存するときには、自動的に呼ばれて設定をクリアします。しかし、UIOPではなく処理系依存の機能を使ってイメージをダンプする場合には、この関数は呼ばれないので、手動で実行するか、あるいは<code>uiop:*image-dump-hook*</code>と同等の処理系依存のフックを使うことになります: SBCLでは<code>sb-ext:*save-hooks*</code>が、CMUCLとSCLでは<code>ext:*before-save-initializations*</code>がこれに相当します。
</p>
<hr>
<a name="ASDF_3092_4f7f_3046"></a>
<a name="ASDFwoShi-u"></a>
<h2 class="chapter">5 ASDFを使う</h2>


<hr>
<a name="g_t_30b7_30b9_30c6_30e0_3092_30ed_30fc_30c9_3059_308b"></a>
<a name="sisutemuworodosuru"></a>
<h3 class="section">5.1 システムをロードする</h3>

<p><var>foo</var>という名のシステムは、次のフォームを実行することでロード（必要ならコンパイルも）されます。
</p>
<div class="lisp">
<pre class="lisp">(asdf:load-system :<var>foo</var>)
</pre></div>

<p>処理系によっては、<code>cl:require</code>にASDFがフックされているので、単に
</p>
<div class="lisp">
<pre class="lisp">(require :<var>foo</var>)
</pre></div>

<p>でロードできます。（→ <a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a>）
</p>

<p>標準のシステム名は文字列であり、すべて<em>小文字</em>です。システム名を指定する時にはシンボル（キーワード含む）も使えます。シンボルは<code>symbol-name</code>で文字列に変換され、さらに小文字に変換されます。また、システム名の文字列は<code>make-pathname</code>の<code>:name</code>引数として（システムがスキャンされるファイルシステム上で）有効でなければなりません。
</p>

<p>小文字を標準とする仕様はCLの慣習と違っていますが、検討の末このような仕様になりました。我々がサポートするシステムには、小文字を使うのが通例のもの（Unix、Mac、Windows）と、小文字を暗黙に大文字に変換するもの（ANSI CLの論理パス名）があるからです。
</p>


<hr>
<a name="g_t_4fbf_5229_306a_95a2_6570"></a>
<a name="Bian-Li-naGuan-Shu-"></a>
<h3 class="section">5.2 便利な関数</h3>


<p>システムに対するもっとも基本的な<em>オペレーション</em>については、次の３つのコマンドが用意されています: <code>load-system</code>、<code>compile-system</code>、<code>test-system</code>
</p>
<p><code>load-system</code>の変種として<code>require-system</code>があり、後者はシステムが既にロードされている場合はロードを行いません。これは例えば、処理系のコアイメージに最初から含まれているライブラリの再ロードを避けるためなどに使えます。
</p>
<p>これらに加えて<code>make</code>という関数もあり、これを呼んだときのオペレーションはシステム開発者が選択することができます。何も指定されていない場合は<code>load-system</code>と同じオペレーション（<code>load-op</code>）を実行しますが、例えば、ドキュメントを出力するためのシステムを作った場合、<code>make</code>で（ロードではなく）ドキュメントを出力するようにできます。
</p>


<a name="index-operate"></a>
<a name="index-oos"></a>

<p>ASDFは拡張可能なシステムであり、<em>コンポーネント</em>に対する新しい<em>オペレーション</em>を定義することもできます。オペレーション一般を呼び出す総称関数として<code>operate</code>があり、デフォルトのものだけでなく任意のオペレーションを扱うことができます。（<code>operate</code>のエイリアスとして<code>oos</code>が定義されているので、REPL上ではこちらがよく使われます。<code>oos</code>はoperate-on-systemの略で<code>mk-defsystem</code><a name="DOCF11" href="#FOOT11"><sup>11</sup></a>から受け継いだ名前です。） コンパイル・ロード・テスト以外のオペレーションを行いたい場合には<code>operate</code>を使うと良いでしょう。
</p>


<a name="index-already_002dloaded_002dsystems"></a>

<dl>
<dt><a name="index-load_002dsystem"></a>関数: <strong>load-system</strong> <em>system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</em></dt>
<dd><p><code>load-op</code>、<var>system</var>、キーワード引数に<code>operate</code>を適用します。システムを現在のイメージにロードしたい場合は、<code>load-system</code>を呼び出すのがもっとも標準的で推奨されるやり方です。
</p></dd></dl>

<dl>
<dt><a name="index-compile_002dsystem"></a>関数: <strong>compile-system</strong> <em>system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</em></dt>
<dd><p><code>compile-op</code>、<var>system</var>、キーワード引数に<code>operate</code>を適用します。この関数はシステムのすべてのファイルをコンパイルしますが、必ずしもそれらを現在のイメージにロードするとは限りません（が、しないとも限りません）。実際のところ、ほとんどのシステムでは、すべてのオブジェクトファイルがロードされるということはないでしょう。この関数は<code>load-system</code>との対称性のために存在しますが、挙動をちゃんと理解した上でビルドスクリプトを書く、という場合以外は使わないほうがよいです。もっとも、そのようなケースでは<code>compile-op</code>よりも<code>program-op</code>のほうが適切なこともあるでしょう。
</p></dd></dl>

<dl>
<dt><a name="index-test_002dsystem"></a>関数: <strong>test-system</strong> <em>system &amp;rest keys &amp;key force force-not verbose version &amp;allow-other-keys</em></dt>
<dd><p><code>test-op</code>、<var>system</var>、キーワード引数に<code>operate</code>を適用します。<a href="#test_002dop">test-op</a>の解説を参照してください。
</p></dd></dl>

<dl>
<dt><a name="index-make"></a>関数: <strong>make</strong> <em>system &amp;rest keys &amp;key &amp;allow-other-keys</em></dt>
<dd><p>ASDF 3.1から加わった関数であり、システムに対して何らかのオペレーションを実行します。デフォルトの動作は<code>load-system</code>と同じですが、システム開発者はシステム定義の中で実行すべきオペレーションを指定することができます。具体的には、<code>defsystem</code>フォームの<code>:build-operation</code>にオペレーションを指定し、<code>:build-pathname</code>に出力先のパス名を指定します。（→ <a href="#g_t_30d3_30eb_30c9_30aa_30da_30ec_30fc_30b7_30e7_30f3">ビルドオペレーション</a>）
</p>

<p>この関数は実験的であり、テストが十分ではありませんので、自己責任で使ってください。
</p></dd></dl>

<a name="index-build_002doperation"></a>

<dl>
<dt><a name="index-require_002dsystem"></a>関数: <strong>require-system</strong> <em>system &amp;rest keys &amp;key &amp;allow-other-keys</em></dt>
<dd><p><code>require-system</code>は<code>cl:require</code>と類似の動作をします。つまり、既にロードされているシステムを（例えシステムが更新されていても）ロードしません。同じ動作は<code>load-system</code>にロード済みシステムを除外するようにキーワード引数を指定しても可能です。<a name="DOCF12" href="#FOOT12"><sup>12</sup></a> 現在メンテナンスされているフリーの処理系（ABCL、Clozure CL、CMUCL、ECL、GNU CLISP、MKCL、SBCLの最近のバージョン）では、いったんASDFがロードされると、<code>cl:require</code>でもASDFシステムをロードできるようになりますが、その動作は、<code>cl:require</code>が処理系の知らないモジュール名を受け取ったときは<code>require-system</code>に渡す、という仕組みになります。（逆に<code>require-system</code>が<code>cl:require</code>を呼び出すことはありません。潜在的に無限ループを生んでしまう可能性があるからです。）
</p>
<p><code>cl:require</code>や<code>require-system</code>は、現在のセッションでは修正されていないコードをロードするのに向いています。この２つの違いを説明すると、<code>cl:require</code>は処理系の提供する拡張モジュールをロードするのに使われますが、<code>require-system</code>は普通はその用途では使えません。（ただし、SBCLやMKCLのように、処理系の拡張モジュールがそもそもシステムとして定義されている場合は<code>require-system</code>でもロードできます。）また、あなたが開発もデバッグもしていないシステムで、インストール済みのバージョンを使えば問題ないと考えられる場合にも<code>require-system</code>（あるいは、上に挙げた処理系では<code>cl:require</code>）でロードするとよいかもしれません。
</p>
<p>しかし、あなたが開発、デバッグしていたり、あるいは何にせよ変更を行ったシステムに対しては<code>load-system</code>を使うべきです。<code>load-system</code>は変更されたファイルとその依存関係に基づいて適切に再ビルドを行います。（指定されたシステムとそれが依存しているシステムです、それ以外のビルドは行いません。）<a name="DOCF13" href="#FOOT13"><sup>13</sup></a>
</p></dd></dl>


<hr>
<a name="g_t_3053_306e_5148_3078_9032_3080"></a>
<a name="konoXian-heJin-mu"></a>
<h3 class="section">5.3 この先へ進む</h3>

<p>ここまでの解説で、他人が作ったシステムをロードするのに必要な情報は網羅されています。以降は、あなた自身が作ったLispソフトウェアにシステム定義を書くための知識を扱います。また、新しいオペレーションやコンポーネントを定義してASDFを拡張するための情報も含みます。
</p>

<hr>
<a name="defsystem_3067_30b7_30b9_30c6_30e0_3092_5b9a_7fa9_3059_308b"></a>
<a name="defsystemdesisutemuwoDing-Yi-suru"></a>
<h2 class="chapter">6 defsystemでシステムを定義する</h2>

<p>この章では、ASDFを使ってシステムを定義し、ソフトウェア開発を行う方法を解説します。
</p>


<hr>
<a name="g_t_5358_7d14_306a_4f8b"></a>
<a name="Dan-Chun-naLi"></a>
<h3 class="section">6.1 単純な例</h3>
<a name="index-defsystem"></a>
<a name="index-asdf_002duser"></a>
<a name="index-load_002dasd"></a>

<p>まずシステム定義の例を挙げ、後のセクションで<code>defsystem</code>の完全な文法を解説します。
</p>
<p>それでは単純なシステムを定義してみましょう。次の例は<samp>hello-lisp.asd</samp>というファイルに保存されます。（ASDFが<code>&quot;hello-lisp&quot;</code>という名のシステムを処理するように指示されたときに、この定義を見つけられるようにするためです。）
</p>
<div class="lisp">
<pre class="lisp">;; Lispのコメントを書くことができます

(defsystem &quot;hello-lisp&quot;
  :description &quot;hello-lisp: a sample Lisp system.&quot;
  :version &quot;0.0.1&quot;
  :author &quot;Joe User &lt;joe@example.com&gt;&quot;
  :licence &quot;Public Domain&quot;
  :depends-on (&quot;optima.ppcre&quot; &quot;command-line-arguments&quot;)
  :components ((:file &quot;packages&quot;)
               (:file &quot;macros&quot; :depends-on (&quot;packages&quot;))
               (:file &quot;hello&quot; :depends-on (&quot;macros&quot;))))
</pre></div>

<p>それでは例を説明していきます。
</p>
<ul>
<li> この<code>defsystem</code>フォームは<code>hello-lisp</code>という名前のシステムを定義します。このシステムは<samp>packages.lisp</samp>、<samp>macros.lisp</samp>、<samp>hello.lisp</samp>という３つのソースファイルを含んでいます。

</li><li> Lispのソースファイルについては、拡張子<samp>.lisp</samp>が暗黙に使われます。これらのソースファイルは、システム定義の書かれた<code>.asd</code>ファイルと同じディレクトリにあります。


</li><li> <samp>macros</samp>は<samp>packages</samp>に依存していて（おそらく<samp>macros</samp>で使われているパッケージが<samp>packages</samp>で定義されているからでしょう）、<samp>hello</samp>は<samp>macros</samp>に（そして依存関係をたどると<samp>packages</samp>にも）依存しています。この定義に基づいて、ASDFは<samp>packages</samp>をコンパイル、ロードし、続いて<samp>macros</samp>、<samp>hello</samp>を同様に処理するでしょう。

</li><li> このシステムは２つの他のシステムに依存しています: <code>optima.ppcre</code>（正規表現のマッチングを行うための便利なインターフェースを提供するライブラリ）と<code>command-line-arguments</code>（シェルコマンドから与えられた引数をパースするライブラリ）です。つまり、<code>hello-lisp</code>を使うためには、ASDFがこの２つのシステムのある場所を見つけられるように設定されていなければなりません。ASDFは<code>hello-lisp</code>をコンパイル、ロードする前にこの２つのシステムをロードするでしょう。

</li><li> このシステムはたくさんのメタデータを定義しています。例に挙げたフィールド以外にも、<code>:bug-tracker</code>, <code>:mailto</code>、<code>:long-name</code>、<code>:long-description</code>、<code>:source-control</code>などが使えます。これらの使用は任意ですが、少なくとも<code>:description</code>、<code>:version</code>、<code>:author</code>、<code>:licence</code>は定義しておくことを強く推奨します。（特にQuicklispにソフトウェアを登録するつもりであれば。）

</li><li> <code>:version</code>の文字列はASDFにパースされるので、なんでもよいわけではありません。今のところは、ピリオド<code>.</code>で区切られた非負整数のみが許容されています。（→ <a href="#g_t_30d0_30fc_30b8_30e7_30f3_6307_5b9a_5b50">バージョン指定子</a>）

</li><li> 上のファイルはただ１つの<code>defsystem</code>フォームだけを含んでいて、<code>in-package</code>もなければ、パッケージの接頭辞<code>asdf:</code>も付いていません。これが我々の推奨する書き方です。より複雑なシステム定義ファイルを書きたければ任意のLispコードが使えますが、可能ならばシンプルな定義に保っておくことを勧めます。そのほうが堅牢で、将来においても有効なシステム定義になるでしょうから。

<a name="index-_003aversion"></a>

</li></ul>

<p>以上のことを知っていれば、単純なシステムを定義するには十分です。次のセクションの例はずっと込み入っているので、複雑なことをしたいときの助けになるかもしれません。しかし、究極的には任意のLispコードが書けるのですから、完全な解説をすることはできませんが。
</p>


<hr>
<a name="g_t_8907_96d1_306a_4f8b"></a>
<a name="Fu-Za-naLi"></a>
<h3 class="section">6.2 複雑な例</h3>
<a name="index-defsystem-1"></a>

<p><code>defsystem</code>のより複雑な使い方を説明するために、いくぶん込み入った例を挙げてみましょう。
</p>
<div class="lisp">
<pre class="lisp">(in-package :asdf-user)

(defsystem &quot;foo&quot;
  :version (:read-file-form &quot;variables&quot; :at (3 2))
  :components
  ((:file &quot;package&quot;)
   (:file &quot;variables&quot; :depends-on (&quot;package&quot;))
   (:module &quot;mod&quot;
     :depends-on (&quot;package&quot;)
     :serial t
     :components ((:file &quot;utils&quot;)
                  (:file &quot;reader&quot;)
                  (:file &quot;cooker&quot;)
                  (:static-file &quot;data.raw&quot;))
     :output-files (compile-op (o c) (list &quot;data.cooked&quot;))
     :perform (compile-op :after (o c)
        (cook-data
         :in (component-pathname (find-component c &quot;data.raw&quot;))
         :out (first (output-files o c)))))
   (:file &quot;foo&quot; :depends-on (&quot;mod&quot;))))

(defmethod action-description
    ((o compile-op) (c (eql (find-component &quot;foo&quot; &quot;mod&quot;))))
  &quot;cooking data&quot;)
</pre></div>

<p>それでは例を説明していきます。
</p>
<ul>
<li> このファイル（<samp>foo.asd</samp>）は主としてシステム<code>foo</code>を定義しますが、それ以外のフォームも含んでいます。この点については以下で説明します。

</li><li> このシステムは、Lispのソースファイルのほかに<code>&quot;mod&quot;</code>という名の<code>:module</code>コンポーネントを含んでいます。<code>&quot;mod&quot;</code>は３つのソースファイル（<samp>utils.lisp</samp>、<samp>reader.lisp</samp>、<samp>cooker.lisp</samp>）と<samp>data.raw</samp>の集まりです。

</li><li> <code>:static-file</code>には、Lispのソースファイルと違って暗黙の拡張子がないことに注意してください。

</li><li> <code>&quot;mod&quot;</code>コンポーネントに含まれる４つのファイルは、システムのディレクトリ直下の<samp>mod/</samp>というサブディレクトリにあるでしょう。（このディレクトリの場所は<code>:pathname</code>オプションで任意に上書きすることができます。<a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>内の解説を参照してください。）

</li><li> <code>:serial t</code>は<code>mod</code>のそれぞれの子コンポーネントがその前のコンポーネントに依存していることを示しています。つまり、<samp>cooker.lisp</samp>は<samp>reader.lisp</samp>に依存し、<samp>reader.lisp</samp>は<samp>utils.lisp</samp>に依存します。最後に<samp>data.raw</samp>がこれらすべてに依存していることになりますが、静的なファイルですから特に動作への影響はもたらしません。しかし、<code>(:static-file &quot;data.raw&quot;)</code>が最初に置かれていた場合は、このデータファイルが変更されるとほかのすべてのソースファイルが再コンパイルされることになります。それはおそらくこの例では不都合でしょう。

</li><li> <code>:output-files</code>、<code>:perform</code>以下のメソッド形式の表現は、特定のコンポーネントについてメソッドを定義するための省略表現です。つまり、以下の部分

<div class="lisp">
<pre class="lisp">     :output-files (compile-op (o c) (list &quot;data.cooked&quot;))
     :perform (compile-op :after (o c)
        (cook-data
         :in (component-pathname (find-component c &quot;data.raw&quot;))
         :out (first (output-files o c))))
</pre></div>

<p>は次のようにメソッドを定義しているのと同じことになります。
</p>
<div class="lisp">
<pre class="lisp">(defmethod output-files ((o compile-op) (c (eql ...)))
  (list &quot;data.cooked&quot;))
(defmethod perform :after ((o compile-op) (c (eql ...)))
  (cook-data
   :in (component-pathname (find-component c &quot;data.raw&quot;))
   :out (first (output-files o c))))
</pre></div>

<p>ただし、<code>...</code>の部分は当該のコンポーネントに対応します。上の例では、次のような式に相当するでしょう。
</p>
<div class="lisp">
<pre class="lisp">(find-component &quot;foo&quot; &quot;mod&quot;)
</pre></div>

<p>文法の詳細は<a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>で、これらのメソッドが何をしているかは<a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a>以下の<a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a>で解説されています。
</p>
</li><li> 
末尾の<code>defmethod</code>も似たような定義をしていますが、<code>action-description</code>メソッドは（ASDF 3.1.5では）<code>defsystem</code>内で定義することができないため、外に分離されています。<code>action-description</code>メソッドは廃止予定の<code>explain</code>インターフェースの代わりにサポートされた機能であり、オペレーションとコンポーネントを引数に取って、オペレーションの説明を返すメソッドです。この例では、コンポーネント<code>&quot;mod&quot;</code>の<code>compile-op</code>がデータクックをするオペレーションであることを説明しています。


</li><li> この例で重要なポイントは、データ処理に関わる入力・出力ファイルがASDFに登録されていることであり、<code>cook-data</code>はそれらのパス名にASDFを通じてアクセスしています。



</li><li> この<samp>.asd</samp>ファイルは<code>(in-package :asdf-user)</code>から始まっていますが、これは冗長な記述であり、不要ですし推奨もされません。しかし、より複雑なことをしたい場合には（やはり推奨はされませんが）<code>in-package</code>でパッケージを移動するのが役に立つかもしれません。

</li><li> ASDFは<samp>.asd</samp>ファイルを<code>cl:load</code>でロードするわけではないし、あなた自身もそのように使うべきではありません。システムを操作したいときにはASDFを通してアクセスするべきです。しかし、どうしても<samp>.asd</samp>ファイルを直接ロードしなければならない事情があるならば、<code>asdf:load-asd</code>が使えます。<code>asdf:load-asd</code>は<code>*package*</code>に<code>asdf-user</code>を束縛してからロードを行います。最近のバージョンのSLIME（2013-02以降）は、<code>slime-asdf</code>拡張をロードすれば<code>load-asd</code>に対応します。<samp>.asd</samp>ファイルに対して<kbd>C-c C-k</kbd>で<code>slime-compile-and-load-file</code>を実行したときに、適切な処理を行うでしょう。

</li><li> システム定義を簡潔にしたいのであれば<code>in-package</code>を使うべきではありません。<code>in-package</code>（とその前の<code>defpackage</code>）を使うのは、新しいクラス・関数・変数・マクロなどを<code>.asd</code>ファイル中で定義する際に、名前の衝突を避けるためだけにしましょう。古いバージョンのASDFのマニュアルでは<samp>.asd</samp>ファイル中で<code>in-package</code>を使うような記法が推奨されていましたが、ASDF 3ではもはや推奨されていません。代わりに、ASDFの拡張を定義した上で<code>:defsystem-depends-on</code>を使ってそれをロードすることを勧めます。（→ <a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>）

</li><li> より一般的な話をすれば、<code>.asd</code>ファイルの中では<code>asdf</code>、<code>common-lisp</code>、<code>uiop</code>パッケージのシンボルを常に使うことができます。中でもいちばん重要なのは<code>defsystem</code>ですが、パッケージの接頭辞を使って<code>asdf:defsystem</code>と書くのは冗長で悪いやり方です。単に<code>(defsystem ...)</code>と書きましょう。パッケージの接頭辞を付けるのは、（<code>asdf</code>パッケージを<code>use</code>していないパッケージから）動的にシステム定義を生成するような場合のみにしてください。

</li><li> <code>asdf-user</code>は実はASDF 3から使えるようになったパッケージです。ASDF 1と2には<samp>.asd</samp>内のパッケージに関しておかしな仕様がありましたが<a name="DOCF14" href="#FOOT14"><sup>14</sup></a>、ASDF 3では廃止されました。そして、今やすべての処理系がASDF 3を備えていますから、ASDF 2との互換性について気にするべきではありません。我々はもはやASDF 2をサポートしていないし、あなたも無視することを勧めます。

</li><li> <code>asdf-user</code>が<code>uiop</code>を<code>use</code>しているのはASDF 3.1からであり、それ以前のASDF 3では<code>uiop/package</code>のみが使えました。したがって、UIOPの関数を使う場合には、いちいち<code>uiop:</code>という接頭辞を付けるか、システムの依存関係を<code>(defsystem foo :depends-on ((:version &quot;asdf&quot; &quot;3.1.2&quot;))</code>で明示するか、あるいは<code>#-asdf3.1 (error &quot;MY-SYSTEM requires ASDF 3.1.2&quot;)</code>という行を加えるかすることを勧めます。

</li><li> 最後に、この例ではメタデータをほぼ省略していますが、別のソースファイル中で定義されているバージョンを抽出する方法を示しています。<code>(:read-file-form &quot;variables&quot; :at (3 2))</code>は、<samp>variables.lisp</samp>の４番目のフォーム中の３番目のフォーム（Lispコードでは０番目から数えるので３番目のフォーム中の２番目のフォームという指定になっています）からバージョンを抽出するように指定しています。おそらく、<samp>variables.lisp</samp>の４番目のフォームは<code>(defparameter *foo-version* &quot;5.6.7&quot;)</code>などとなっていて、<code>&quot;5.6.7&quot;</code>がバージョンの文字列として使われるのでしょう。
</li></ul>


<hr>
<a name="defsystem_306e_6587_6cd5"></a>
<a name="defsystemnoWenFa-"></a>
<h3 class="section">6.3 defsystemの文法</h3>
<a name="index-defsystem-2"></a>
<a name="index-DEFSYSTEM-grammar"></a>
























<div class="example">
<pre class="example">system-definition := ( defsystem system-designator system-option* )
                     # → <a href="#g_t_30b7_30b9_30c6_30e0_6307_793a_5b50">システム指示子</a>

system-designator := simple-component-name | complex-component-name

simple-component-name := lower-case string  | symbol
# アンダースコアは許容されていません。→ <a href="#g_t_5358_72ec_306e_30b3_30f3_30dd_30fc_30cd_30f3_30c8_540d">単独のコンポーネント名</a>

complex-component-name := string | symbol # → <a href="#g_t_8907_5408_7684_306a_30b3_30f3_30dd_30fc_30cd_30f3_30c8_540d">複合的なコンポーネント名</a>

system-option := :defsystem-depends-on dependency-def
                 | :weakly-depends-on system-list
                 | :class class-name # → <a href="#g_t_30b7_30b9_30c6_30e0_30af_30e9_30b9_540d">システムクラス名</a>
                 | :build-operation operation-name
                 | system-option
                 | module-option
                 | option

# このオプションはASDF 3以降（正確には、そのアルファリリースである2.27以降）でのみ使えます。
system-option := :homepage string
                 | :bug-tracker string
                 | :mailto string
                 | :long-name string
                 | :author string
                 | :maintainer string
                 | :license string
                 | :description string
                 | :long-description string
                 | :source-control source-control
                 | :version version-specifier # → <a href="#g_t_30d0_30fc_30b8_30e7_30f3_6307_5b9a_5b50">バージョン指定子</a>
                 | :entry-point object # → <a href="#g_t_30a8_30f3_30c8_30ea_30fc_30dd_30a4_30f3_30c8">エントリーポイント</a>

source-control := (keyword string)

module-option := :components component-list
                 | :serial [ t | nil ]
                 | :default-component-class class-name

option :=
        | :pathname pathname-specifier # → <a href="#g_t_30d1_30b9_540d_6307_5b9a_5b50">パス名指定子</a>
        | :perform method-form
        | :explain method-form
        | :output-files method-form
        | :operation-done-p method-form
        | :if-feature feature-expression
        | :depends-on ( dependency-def* )
        | :in-order-to ( dependency+ )
        | :around-compile function # → <a href="#Controlling-file-compilation">Controlling file compilation</a>


system-list := ( simple-component-name* )

component-list := ( component-def* )

component-def  := ( component-type simple-component-name option* )
# component-typeが:moduleであればmodule-optionも使えます。

component-type := :module | :file | :static-file | other-component-type

other-component-type := symbol-by-name # → <a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_578b">コンポーネント型</a>

# dependency-defは:depends-onの中で使われます。
dependency-def := simple-component-name
               | ( :feature feature-expression dependency-def )
                 # → <a href="#g_t_30d5_30a3_30fc_30c1_30e3_30fc_306b_5fdc_3058_305f_4f9d_5b58_95a2_4fc2">フィーチャーに応じた依存関係</a>
               | ( :version simple-component-name version-specifier )
               | ( :require module-name )

# dependencyは:in-order-toの中で使われます。
dependency := (dependent-op requirement+)
requirement := (required-op required-component+)
dependent-op := operation-name
required-op := operation-name
# [訳注] 現状では required-component := dependency-def と考えて良さそうです。

# パス名はすべて小文字であるべきです。アンダースコアを含むべきではありませんが、
# ハイフンは許容されます。
pathname-specifier := pathname | string | symbol

version-specifier := string
                     | (:read-file-form pathname-specifier form-specifier?)
                     | (:read-file-line pathname-specifier line-specifier?)
line-specifier := :at integer # 0オリジン
form-specifier := :at [ integer | ( integer+ )]

method-form := (operation-name qual lambda-list &amp;rest body)
qual := method-qualifier?
method-qualifier := :before | :after | :around

feature-expression := keyword
                      | (:and feature-expression*)
                      | (:or feature-expression*)
                      | (:not feature-expression)     
</pre></div>

<a name="sisutemuZhi-ShiZi-"></a>
<h4 class="subsection">6.3.1 システム指示子</h4>
<a name="g_t_30b7_30b9_30c6_30e0_6307_793a_5b50"></a>

<p>システム指示子は単独のコンポーネント名（例: <code>&quot;foo&quot;</code>）か、またはスラッシュで区切られた複合的なコンポーネント名（例: <code>&quot;foo/bar/baz&quot;</code>）です。
</p>
<a name="Dan-Du-nokonponentoMing-_0028simple_002dcomponent_002dname_0029"></a>
<h4 class="subsection">6.3.2 単独のコンポーネント名（<code>simple-component-name</code>）</h4>
<a name="g_t_5358_72ec_306e_30b3_30f3_30dd_30fc_30cd_30f3_30c8_540d"></a>

<p>単独のコンポーネント名は文字列またはシンボルで指定することができます。
</p>

<p>文字列を使う場合は、小文字のみを使ってください。
</p>

<p>シンボルは<code>symbol-name</code>で文字列に変換され、さらに小文字に変換されます。言い換えれば、シンボルは<em>指示子</em>として有効ですが、コンポーネント名そのものは文字列だということです。
</p>



<p>文字列であれシンボルであれ、コンポーネント名にアンダースコアを含めてはいけません。
</p>
<p>また、単独のコンポーネント名にスラッシュ<code>/</code>を使ってはいけません。スラッシュは複合的なコンポーネント名を表すのに使われます。この点については次のサブセクションを参照してください。スラッシュが不適切に使われている場合、ASDFは警告を発するでしょう。
</p>
<p>これらの制限を犯した場合、つまり、大文字と小文字を混ぜたり、アンダースコアを使ったりした場合、ASDFがシステムやコンポーネントを見つけるのが不可能になる可能性があります。というのも、コンポーネント名はファイル名として解釈されるからです。特に、論理パス名を使うようにASDFを設定したユーザーは、<em>確実に</em>このような問題に直面するでしょう。
</p>
<a name="Fu-He-De-nakonponentoMing-"></a>
<h4 class="subsection">6.3.3 複合的なコンポーネント名</h4>
<a name="g_t_8907_5408_7684_306a_30b3_30f3_30dd_30fc_30cd_30f3_30c8_540d"></a>

<p>複合的なコンポーネント名は、いくつかの名前を階層に従ってスラッシュ区切りで並べたものです。この仕組みは、１つの<samp>.asd</samp>ファイルに複数のシステム定義を置いた場合に、ASDFがそれらを見つけられるようにするためにあります。
</p>


<p>この際、最上位の名前(master name)は<samp>.asd</samp>ファイルの名前と一致していなければなりません。例えば、<samp>foo.asd</samp>ファイルにはシステム<code>foo</code>が定義されているでしょうが、それに加えて<code>foo/test</code>や<code>foo/docs</code>などのシステムも定義することが可能です。ASDFは、システム<code>foo/test</code>をロードするように要求されたとき、<samp>foo.asd</samp>ファイルを探せばよいことを知っているというわけです。
</p>
<a name="konponentoXing-"></a>
<h4 class="subsection">6.3.4 コンポーネント型</h4>
<a name="g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_578b"></a>
<p>コンポーネント型の名前は、（仮にキーワードで指定されたとしても）まずカレントパッケージのシンボルから検索されます。カレントパッケージに見つからなければ<code>asdf</code>パッケージから検索されます。つまり、カレントパッケージ<code>my-system-asd</code>に属するコンポーネント型<code>my-component-type</code>は、<code>:my-component-type</code>または<code>my-component-type</code>で指定することができます。
</p>
<p><code>system</code>とそのサブクラスは、システムの子コンポーネントのコンポーネント型として使うことはできません。
</p>
<a name="sisutemukurasuMing-"></a>
<h4 class="subsection">6.3.5 システムクラス名</h4>
<a name="g_t_30b7_30b9_30c6_30e0_30af_30e9_30b9_540d"></a>


<p>システムクラス名はコンポーネント型と同じように検索されますが、ここでは<code>system</code>とそのサブクラスのみを使うことができます。典型的な用途としては、何らかのASDF拡張で定義された標準外のシステムクラスを使う場合に、下述の<code>:defsystem-depends-on</code>でその拡張モジュールをロードしつつ、<code>:class</code>にクラス名を指定します。ASDFパッケージの中でこのクラス名を指定するときは、シンボル名の衝突を防ぐために
</p>
<div class="lisp">
<pre class="lisp">:class :MY-NEW-SYSTEM-SUBCLASS
</pre></div>

<p>のようにキーワードを使うことを推奨します。キーワードではなく<code>MY-NEW-SYSTEM-SUBCLASS</code>で指定した場合、この名前のシンボルがカレントパッケージに読み込まれたあと、（ASDF拡張が<code>:defsystem-depends-on</code>によってロードされて、そのパッケージから）同名のシンボルがエクスポートされる、という順序で処理が行われるため、名前の衝突が起きてしまいます。<a name="DOCF15" href="#FOOT15"><sup>15</sup></a>
</p>
<a name="defsystemnoYi-Cun-_0028_003adefsystem_002ddepends_002don_0029"></a>
<h4 class="subsection">6.3.6 defsystemの依存（<code>:defsystem-depends-on</code>）</h4>
<a name="index-_003adefsystem_002ddepends_002don"></a>

<p><code>:defsystem-depends-on</code>オプションを使うと、システム定義が処理される<em>前</em>に、ASDFで定義された別のシステム（またはシステムのまとまり）をロードすることができます。このオプションは典型的には、システム定義の中でASDFの拡張をロードするために使われます。
</p>
<a name="birudooperesiyon_0028_003abuild_002doperation_0029"></a>
<h4 class="subsection">6.3.7 ビルドオペレーション（<code>:build-operation</code>）</h4>
<a name="index-_003abuild_002doperation"></a>
<a name="g_t_30d3_30eb_30c9_30aa_30da_30ec_30fc_30b7_30e7_30f3"></a>
<p><code>:build-operation</code>オプションには、システムに対して<code>make</code>（→ <a href="#g_t_4fbf_5229_306a_95a2_6570">make</a>）を実行したときに、どのオペレーションを適用するか指定することができます。デフォルトでは<code>load-op</code>が使われます。このオプションの値はオペレーションの名前でなければなりません。（例えば<code>:build-operation doc-op</code>など）
</p>
<p>この機能は実験的でテストが不十分です。自己責任で使ってください。
</p>
<a name="Ruo-iYi-Cun-Guan-Xi-_0028_003aweakly_002ddepends_002don_0029"></a>
<h4 class="subsection">6.3.8 弱い依存関係（<code>:weakly-depends-on</code>）</h4>
<a name="g_t_5f31_3044_4f9d_5b58_95a2_4fc2"></a><a name="index-_003aweakly_002ddepends_002don"></a>

<p>この機能を使うことは<em>推奨しません</em>。システム<code>bar</code>に弱依存しているシステム<code>foo</code>を作りたい場合は、パラメトリックに<code>foo</code>を定義して、スペシャル変数やフックで動作を変えられるようにすると良いでしょう。そして、システム<code>foo+bar</code>を定義してまとめてフックできるようにしましょう。
</p>
<p>（廃止予定の）<code>:weakly-depends-on</code>オプションで指定されたシステム（あるいはそのまとまり）については、ASDFはそれらのロードを<em>試み</em>ますが、ロードの成功が必須であるとはみなしません。このオプションは典型的には、システムの基本的な機能には必要ないが付加的な機能をもたらす、という依存関係を指定するのに使われます。
</p>
<p>上の文法定義では、このオプションは<code>defsystem</code>にのみ指定されるものとなっていますが、今のところはどのコンポーネントにも指定可能です。しかし、<code>defsystem</code>直下以外に指定するのはおそらく無意味でしょうし、この（例外的な）挙動は将来、警告なしに変わる可能性があるので、プログラマの方には<code>defsystem</code>直下以外に指定しないように念を押しておきます。
</p>


<a name="pasuMing-Zhi-Ding-Zi-"></a>
<h4 class="subsection">6.3.9 パス名指定子</h4>
<a name="index-pathname-specifiers"></a>
<a name="index-pasumeisiteisi_0028pasuMing-Zhi-Ding-Zi-_0029"></a>
<a name="g_t_30d1_30b9_540d_6307_5b9a_5b50"></a>
<p>パス名指定子(pathname specifier)はパス名、文字列、シンボルのいずれかですが、多くの場合、コンポーネントは<code>:pathname</code>オプション無しで記述されるでしょう。省略された場合にはコンポーネント名そのものが使われます。
</p>

<p>普通は文字列を与えますが、文字列はUnixスタイルのパス名として解釈され、文字<code>/</code>はディレクトリのセパレータとみなされます。たいていは相対パスが使われ、その場合は親コンポーネントのパスを基点にした相対パスとみなされます。文字列はコンポーネント型に応じてファイルともディレクトリとも解釈されますが、ファイルの場合、コンポーネント型によっては自動的に拡張子が付加されることがあります。
</p>
<p>例えば、コンポーネント型の１つである<code>:module</code>は、ディレクトリを対象とするので、文字列<code>&quot;foo/bar&quot;</code>はパス名<samp>#p&quot;foo/bar/&quot;</samp>と解釈されます。
また、コンポーネント型の１つである<code>:file</code>は、ファイル形式が<samp>lisp</samp>のファイルを対象とするので、文字列<code>&quot;foo/bar&quot;</code>はパス名<samp>#p&quot;foo/bar.lisp&quot;</samp>と解釈され、<code>&quot;foo/bar.quux&quot;</code>は<samp>#p&quot;foo/bar.quux.lisp&quot;</samp>と解釈されます。<a name="DOCF16" href="#FOOT16"><sup>16</sup></a>
最後に、コンポーネント型の１つである<code>:static-file</code>は、特定のファイル形式を前提とせずにファイルを対象にとるので、文字列<code>&quot;foo/bar&quot;</code>はパス名<samp>#p&quot;foo/bar&quot;</samp>と解釈され、<code>&quot;foo/bar.quux&quot;</code>は<samp>#p&quot;foo/bar.quux&quot;</samp>と解釈されます。
</p>
<p><code>&quot;..&quot;</code>はパス名のディレクトリコンポーネント中の<code>:back</code>と解釈されます。<a name="DOCF17" href="#FOOT17"><sup>17</sup></a>
つまり、文字列中の<code>&quot;..&quot;</code>は１つ上の階層のディレクトリを意味します。
</p>
<p>シンボルが与えられた場合、小文字の文字列に変換されます。小文字に変換するのは慣習と異なっていますが、検討の末このような仕様になりました。我々がサポートするファイルシステムには、小文字を使うのが通例のもの（Unix、Mac、Windows）と、小文字を暗黙に大文字に変換するもの（ANSI CLの論理パス名）があるので、単に<code>make-pathname</code>を<code>:case :common</code>として使う方式（うまく動かない処理系もある）よりも適切と思われます。
</p>
<p>システム名やコンポーネント（モジュール、ファイル）名にアンダースコアを使うのは避けてください。論理パス名がアンダースコアに対応していないためです。（→ <a href="#g_t_8ad6_7406_30d1_30b9_540d_3092_4f7f_3046">論理パス名を使う</a>）
</p>

<p>パス名オブジェクトを与える場合、一般的には<code>#p</code>や<code>#.(make-pathname ...)</code>のようなリーダーマクロが使われるでしょう。しかし、<code>#p...</code>は<code>#.(parse-namestring '...)</code>と同等であり、<code>parse-namestring</code>は論理パス名を使わない限りまったくポータブルではないし、論理パス名もまた別のポータブルでない挙動を含んでいるという問題があります。（→ <a href="#g_t_8ad6_7406_30d1_30b9_540d_3092_4f7f_3046">論理パス名を使う</a>） また、たいていは、パス名を<code>#.(make-pathname ...)</code>で作るより、上述の文字列を使う方式のほうが簡単です。本当にパス名オブジェクトを使う必要があるのは、コンポーネントのデフォルトのファイル形式（拡張子）を上書きする必要がある場合のみです。従って、パス名オブジェクトはめったに使われないでしょう。残念ながらASDF 1には、コンポーネント名そのものをディレクトリを指す文字列としてパースして適切に扱う仕組みが無かったので、<code>#.(make-pathname ...)</code>という面倒な書き方をしなければなりませんでした。リード時評価<code>#.</code>の代わりに<code>(eval `(defsystem ... ,pathname ...))</code>で代用することも可能です。
</p>
<p>文字列が与えられた場合にコンポーネント型が考慮されてパス名が解釈されるのと異なり、パス名オブジェクトが与えられた場合はそのまま使われるということに注意してください。つまり、パス名オブジェクトを使うなら、コンポーネント型の制約を満たすように（例えばディレクトリや特定のファイル形式が指定されるように）あなた自身が気を配って書かなければなりません。他方では、ファイル形式の制約をあえて無視するために使うこともできます。
</p>
<a name="baziyonZhi-Ding-Zi-"></a>
<h4 class="subsection">6.3.10 バージョン指定子</h4>
<a name="index-version-specifiers"></a>
<a name="index-baziyonsiteisi_0028baziyonZhi-Ding-Zi-_0029"></a>
<a name="index-_003aversion-1"></a>
<a name="g_t_30d0_30fc_30b8_30e7_30f3_6307_5b9a_5b50"></a>
<p>バージョン指定子(version specifier)は文字列であり、ピリオド<code>#\.</code>で区切られた整数としてパースされます。例えば、<code>&quot;0.2.1&quot;</code>は大ざっぱに言えば<code>(0 2 1)</code>というバージョンと解釈されます。留意点として、<code>&quot;0.0002.1&quot;</code>は<code>&quot;0.2.1&quot;</code>と同じバージョンと判断されますが、前者は正規の書き方ではないので、警告が通知されるでしょう。また、バージョンは小数として扱われるわけではないので、<code>&quot;1.3&quot;</code>や<code>&quot;1.4&quot;</code>は<code>&quot;1.30&quot;</code>と比較してバージョンが小さい（<code>(uiop:version&lt; &quot;1.3&quot; &quot;1.30&quot;)</code>が真を返す）ことにも注意してください。
</p>
<p><code>:version</code>引数には、バージョンを文字列リテラルで直接指定する代わりに、他の場所からバージョン文字列を抽出するための表現を与えることも可能で、次のようなDSLが用意されています: <code>(:read-file-form &lt;パス名または文字列&gt; [:at &lt;access-at-specifier&gt;])</code>あるいは<code>(:read-file-line &lt;パス名または文字列&gt; [:at &lt;access-at-specifier&gt;])</code>。名前が示すように、前者は与えられたパス（相対パス名や<code>unix-namestring</code>で与えられた場合はシステムのパスをベースに解釈される<a name="DOCF18" href="#FOOT18"><sup>18</sup></a>）から１つのフォームを読み、後者は１つの行を読みます。<code>:at</code>引数には<code>uiop:access-at</code>と同様の指定をすることができますが、デフォルトでは<code>0</code>、つまり最初のフォーム/行を読み込むことになります。（訳注: 記述の例は<a href="#g_t_8907_96d1_306a_4f8b">複雑な例</a>にあります。） また、<code>:read-file-form</code>にはサブフォーム、つまりフォーム中のフォームを指定することもできます。例えば<code>(1 2 2)</code>は「２番目のフォーム中の３番目のフォーム中の３番目のフォーム」を指定しています。この指定は０番目から数えることに気をつけましょう。
</p>
<p>システムを定義する際には、<var>x</var>.<var>y</var>.<var>z</var>という形式でバージョンを指定し、それぞれメジャーバージョン、マイナーバージョン、パッチレベルに対応させることを推奨します。APIの重要な非互換が発生する場合は、メジャーバージョンを上げてそのことを示しましょう。
</p>
<p>→ <a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a>
</p>
<a name="g_t_003arequire-1"></a>
<h4 class="subsection">6.3.11 <code>:require</code></h4>
<a name="index-_003arequire-dependencies"></a>
<a name="g_t_003arequire"></a>
<p>依存モジュールをロードするのに（ASDFの<code>load-op</code>ではなく）処理系の<code>require</code>関数を使う場合には、<code>(:require <var>モジュール名</var>)</code>という指定をします。
</p>
<p>特定の処理系でのみ、その提供モジュールに依存しているという場合には、単に<code>#+<var>処理系名</var> (:require <var>モジュール名</var>)</code>と書くよりは、<code>(:feature <var>処理系名</var> (:require <var>モジュール名</var>))</code>を使うほうが良いスタイルと言えます。（→ <a href="#g_t_30d5_30a3_30fc_30c1_30e3_30fc_306b_5fdc_3058_305f_4f9d_5b58_95a2_4fc2">フィーチャーに応じた依存関係</a>）
</p>

<a name="huitiyaniYing-zitaYi-Cun-Guan-Xi-_0028_003afeature_0029"></a>
<h4 class="subsection">6.3.12 フィーチャーに応じた依存関係（<code>:feature</code>）</h4>
<a name="g_t_30d5_30a3_30fc_30c1_30e3_30fc_306b_5fdc_3058_305f_4f9d_5b58_95a2_4fc2"></a><a name="index-_003afeature-dependencies"></a>

<p>フィーチャーに応じた依存関係は<code>(:feature <var>feature-expression</var> <var>dependency</var>)</code>というフォームで指定します。システム定義がパースされる時に<var>feature-expression</var>が満たされれば（訳注: 例えば、<code>*features*</code>に<var>feature-expression</var>が含まれれば）依存関係が使われ、満たされない場合は無視されます。
</p>
<p>ただし、<code>:feature</code>は今定義しているシステムが特定のフィーチャーに依存していることを示すために使うことは<strong>できない</strong>という点に注意しましょう。すなわち、システム定義をロードするのに必要なフィーチャーを指定することはできません。例えば、システムをSBCLでしか使えないようにしようとして<code>(:feature :sbcl)</code>と書いても無意味です。
</p>
<p>なお、フィーチャーに応じた依存関係を、<code>if-feature</code>や廃れた機能である<a href="#feature-requirement_ff08_5ec3_6b62_ff09">feature requirement（廃止）</a>と混同しないようにしましょう。
</p>
<a name="Lun-Li-pasuMing-woShi-u"></a>
<h4 class="subsection">6.3.13 論理パス名を使う</h4>
<a name="g_t_8ad6_7406_30d1_30b9_540d_3092_4f7f_3046"></a><a name="index-logical-pathnames"></a>
<a name="index-ronripasumei_0028Lun-Li-pasuMing-_0029"></a>

<p>我々は一般に、論理パス名を使うことを推奨しません。（最近Common Lispを使い始めた人にはなおのことです。） しかし、論理パス名を好む古参の方のためにサポートはしています。
</p>
<p>論理パス名を使うなら、コンポーネントの定義中の<code>:pathname</code>に対して<code>#p&quot;LOGICAL-HOST:absolute;path;to;component.lisp&quot;</code>などといった文法でパス名オブジェクトを与える必要があるでしょう。
</p>
<p>論理パス名はシステムや親コンポーネントに指定すれば十分です。それらに属する子コンポーネントには特にパスを指定しなくても、名前を相対パスとして親コンポーネントのパスと適切にマージされます。なお、<code>:pathname</code>に文字列を与える場合は、論理パス名のホストの指定をすることは<em>できません</em>。
</p>
<p><code>asdf-output-translations</code>レイヤー（→ <a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a>）は論理パス名の解決・解釈をすることを避けます。この仕様の良いところは、論理パス名をどのように解釈するかあなた自身で決められることですが、解釈を定義しなかった場合に、論理パス名を含むシステムが異なる環境の<code>asdf-output-translations</code>で異なる振る舞いをするという欠点もあります。
</p>

<p>したがって、論理パス名を使いたい時は、使われる前にその解釈（<code>logical-pathname-translations</code>）を設定する必要があるでしょう。ASDFには今のところ、論理パス名の解釈を決めるための機能がありません。
</p>
<p>我々が論理パス名の使用を推奨しない理由としては、(1) 論理パス名が使われる<em>前</em>にその解釈を設定するポータブルな方法がないことと、(2) 論理パス名には１つのレターケース（大文字か小文字のどちらか）、数字、ハイフンしか使えないことがあります。１つ目の問題はあなた自身で解決することもできるでしょうが、15の処理系についてそれぞれどのように対処するかは、我々がドキュメントとして書ける範囲を超えています。また、２つ目の制約はSBCLが要求しているので、ポータビリティのためには無視することができません。したがって、この制約を侵す物理パス名を参照したい時は、あなた自身が何らかのエンコーディングを定義して独立したマッピングを追加しなくてはなりません。とりわけ、大規模プロジェクトの一部としてLispファイルが含まれる場合、この仕様は悩みの種になるかもしれません。典型的な例としては、プロジェクトのファイル、ディレクトリ名にバージョン番号が含まれる場合や、あるいは他のプログラミング言語で書かれたソフトウェアが共存していて、ファイル名にアンダースコアやドット、キャメルケースが使われる場合などがあります。
</p>

<a name="Lian-Sok-De-naYi-Cun-Guan-Xi-_0028_003aserial_0029"></a>
<h4 class="subsection">6.3.14 連続的な依存関係（<code>:serial</code>）</h4>
<a name="index-serial-dependencies"></a>

<p>モジュールの定義で<code>:serial t</code>オプションを指定すると、そのモジュールの子コンポーネントは常に前の子コンポーネントに依存しているとみなされます。これは<code>:depends-on</code>でいちいち依存関係を指定するのと同じことになります。つまり、
</p>
<div class="lisp">
<pre class="lisp">:serial t
:components ((:file &quot;a&quot;) (:file &quot;b&quot;) (:file &quot;c&quot;))
</pre></div>

<p>は次の定義と同等です。
</p>
<div class="lisp">
<pre class="lisp">:components ((:file &quot;a&quot;)
             (:file &quot;b&quot; :depends-on (&quot;a&quot;))
             (:file &quot;c&quot; :depends-on (&quot;a&quot; &quot;b&quot;)))
</pre></div>


<a name="sosunoChang-Suo-_0028_003apathname_0029"></a>
<h4 class="subsection">6.3.15 ソースの場所（<code>:pathname</code>）</h4>

<p><code>defsystem</code>でシステムを定義する際、<code>:pathname</code>オプションを任意で指定できますが、通常は必要ありません。単純なプロジェクトでは、ソースファイルはシステムと同じディレクトリにあるでしょうし、モジュールを使う場合はモジュールと同じ名前のサブディレクトリにあるでしょうから。
</p>

<p>より詳細に説明すると、ASDFは次の挙動を実現するために、複雑なルールに従っています。
</p>
<ol>
<li> <code>find-system</code>
はシステムをディスクからロードして、そのデフォルトのパス名<a name="DOCF19" href="#FOOT19"><sup>19</sup></a>を正しく設定します。

</li><li> ユーザーが<samp>.asd</samp>ファイルをエディタに読み込んでフォームを１つ１つ評価したような場合でも、このパス名の情報は<code>*default-pathname-defaults*</code>（この場合、まったく別の場所を指しているかもしれません）によって書き換えられることはありません。
</li></ol>

<p>システムが初めて定義される場合、そのトップレベルのパス名は次のように決まるでしょう:
</p>
<ul>
<li> <code>*load-truename*</code>にパス名が束縛されている場合、そのホスト、デバイス、ディレクトリが使われます。
</li><li> <code>*load-truename*</code>にパス名が束縛されていない場合は、<code>*default-pathname-defaults*</code>が代わりに使われます。

</li></ul>

<p>システムが再定義される場合、トップレベルのパス名は次のように決まります:
</p>
<ul>
<li> <code>*load-truename*</code>にパス名が束縛されている場合は、新しいソースの場所を反映するように更新されます。


</li><li> 以前に<code>*default-pathname-defaults*</code>によってセットされていた場合は、更新されます。

</li><li> 以前に<code>*load-truename*</code>によってセットされていて、現在は<code>*load-truename*</code>が<code>nil</code>である場合は、更新されません。この仕様によって、開発者は<code>defsystem</code>フォームを（ソースの場所に影響を与えずに）エディタ内で評価することができます。
</li></ul>

<a name="huitiyaniYing-zitakonponento_0028_003aif_002dfeature_0029"></a>
<h4 class="subsection">6.3.16 フィーチャーに応じたコンポーネント（<code>:if-feature</code>）</h4>
<a name="index-_003aif_002dfeature-component-option"></a>
<a name="if_002dfeature_30aa_30d7_30b7_30e7_30f3"></a>
<p>このオプションは、特定のコンポーネントをビルドに含めるかどうかを（<code>#+</code>のように）フィーチャーに応じた条件で指定することができます。フィーチャーが満たされない場合、そのコンポーネントは無視され、また、他のコンポーネントがそのコンポーネントに依存するという記述も無視されます。リード時に評価される<code>#+</code>と異なり、このオプションを使うと、コンポーネントの階層にオブジェクトを追加し、そのオブジェクトをプロジェクトをビルドする際に利用したり、システム構造について推論したい外部のコードからアクセスしたりといったことができます。
</p>

<p>プログラマは<strong>いつ</strong><code>:if-feature</code>が評価されるか知っておくべきです。ASDFは最初にビルド全体の計画を建て、次にその計画を実行するという順で動作しますが、フィーチャーが満たされるかどうかは<strong>計画時</strong>にチェックされます。従って、ビルド中に<code>*features*</code>を変更して<code>:if-feature</code>に影響を与えるということはできません。<code>:if-feature</code>はビルドオペレーションが実行される直前の<code>*features*</code>の状態だけをチェックするのです。
</p>
<p>このオプションはASDF 3で追加されました。詳細な情報については、<a href="#g_t_5fc5_8981_306a_30d5_30a3_30fc_30c1_30e3_30fc">必要なフィーチャー</a>を参照してください。
</p>
<a name="entoripointo_0028_003aentry_002dpoint_0029"></a>
<h4 class="subsection">6.3.17 エントリーポイント（<code>:entry-point</code>）</h4>
<a name="index-_003aentry_002dpoint"></a>
<a name="index-entoripointo"></a>
<a name="g_t_30a8_30f3_30c8_30ea_30fc_30dd_30a4_30f3_30c8"></a><p><code>:entry-point</code>オプションには、<code>program-op</code>で実行可能ファイルを作る際のエントリーポイントを指定することが出来ます。
</p>
<p><code>program-op</code>が呼ばれた時、このオプションに与えられたフォームは<code>uiop:ensure-function</code>で関数に変換され、<code>uiop:*image-entry-point*</code>に束縛されます。<code>uiop:ensure-function</code>は任意のオブジェクトを引数に取れますが、このオプションでは一般に<code>&quot;foo:main&quot;</code>のような文字列が使われ、その場合、実行可能ファイルは<code>foo:main</code>関数から開始することになります。なお、シンボル<code>foo:main</code>を使うとうまく動かない可能性があることに注意してください。なぜなら、ASDFが<code>defsystem</code>フォームをリードする時に<code>foo</code>パッケージが既に存在しているとは限らないからです。<code>program-op</code>に関する詳細は<a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a>を参照してください。
</p>
<a name="feature-requirement_0028Fei-Zhi-_0029"></a>
<h4 class="subsection">6.3.18 feature requirement（廃止）</h4>
<a name="feature-requirement_ff08_5ec3_6b62_ff09"></a><p>この機能はASDF 3.1で廃止されたので、使わないでください。ほとんどの場合は<code>:if-feature</code>(→ <a href="#if_002dfeature_30aa_30d7_30b7_30e7_30f3">if-featureオプション</a>)で代替できるでしょう。
</p>
<p>この機能は、特定のフィーチャーが欠けているときに、コンポーネントの依存関係の連鎖が断たれるようにするためのものでした。<code>:if-component-dep-fails</code>と併せて使うと、条件つきのコンパイルを（遠回りではありますが）記述することができたのです。
</p>

<hr>
<a name="g_t_002easd_30d5_30a1_30a4_30eb_4e2d_306e_4ed6_306e_30b3_30fc_30c9"></a>
<a name="g_t_002easdhuairuZhongnoTa-nokodo"></a>
<h3 class="section">6.4 .asdファイル中の他のコード</h3>

<p><samp>.asd</samp>ファイルは、<code>load</code>で実行可能な通常のLispのソースファイルであり<a name="DOCF20" href="#FOOT20"><sup>20</sup></a>、任意のLispコードを含むことができます。しかし、追加のフォームは最小限にとどめ、複雑な処理が必要な場合は<code>defsystem</code>の拡張を別に定義して<code>:defsystem-depends-on</code>で読み込むことを推奨します。
</p>
<p>とは言っても、<samp>.asd</samp>ファイルにコードを含めなければならない場合もあるでしょう。例えば、コンパイル時の環境を調べて設定するために<code>*features*</code>にフィーチャーを加える、などといったケースが考えられます。その場合は、ユーザーが<samp>.asd</samp>ファイル中の処理の詳細をコントロールできるように、次の慣習に従うことを推奨します:
</p>
<ul>
<li> 何かしらの情報を表示する場合は、CLの標準のストリームである<code>*standard-output*</code>に出力するべきです。（ただし、警告とエラーを除きます。それらはコンディションシステムが対処する領域です。）ASDFのオペレーション由来の出力を、ユーザーが容易に扱えるようにするためです。
</li></ul>


<hr>
<a name="package_002dinferred_002dsystem_62e1_5f35"></a>
<a name="package_002dinferred_002dsystemKuo-Zhang-"></a>
<h3 class="section">6.5 package-inferred-system拡張</h3>
<a name="index-Package-inferred-systems"></a>
<a name="index-Packages_002c-inferring-dependencies-from"></a>
<a name="index-package_002dinferred_002dsystem"></a>
<a name="index-One-package-per-file-systems"></a>

<p>バージョン3.1.2から、ASDFは１ファイル１パッケージのスタイルをサポートしています。このスタイルは、１つのソースファイルに１つのシステムが対応し、システム同士の依存関係は（訳注: おそらく各ファイルの冒頭に書かれるであろう）<code>defpackage</code>または<code>uiop:define-package</code>から推測されるという仕組みです。
</p>
<p>このスタイルでは、まずパッケージは同じ名前（ただし小文字化される）のシステムに対応します。そして、<code>:class package-inferred-system</code>を指定されたシステムが存在する時、そのシステム名から始まるシステム（セパレータは<code>/</code>）は元のシステムの場所からシステム名に基づいて辿ったパスにあるファイルに対応します。後者は例を挙げたほうがわかりやすいでしょう。システム<code>my-lib</code>が<code>:class package-inferred-system</code>オプションつきで<samp>/foo/bar/my-lib/my-lib.asd</samp>に定義されているとします。この時、システム<code>my-lib/src/utility</code>はファイル<samp>/foo/bar/my-lib/src/utility.lisp</samp>に対応するというわけです。
</p>
<p>１ファイル１パッケージのスタイルは、以前に<code>faslpath</code>や<code>quick-build</code>といったツールで一般的になった方法であり、パッケージの規則を厳格化することと引き換えにメンテナンスしやすいコードを書くことができます。ASDF 3からは、このスタイルはASDF自身に採用されていますし、<code>lisp-interface-library</code>やいくつかの他のライブラリでも使われています。
</p>
<p>ではこのスタイルによるシステム定義の例を見てみましょう。トップレベルのシステム名を<code>my-lib</code>とします。まずは<samp>my-lib.asd</samp>ファイルを作り、<code>defsystem</code>フォームに<code>:class :package-inferred-system</code>オプションを指定します。例えば次のような定義になるでしょう:
</p><div class="lisp">
<pre class="lisp">;; この例はLISP-INTERFACE-LIBRARYのlil.asdに基づいています。

#-asdf3.1 (error &quot;MY-LIBにはASDF 3.1以降が必要です。&quot;)
(defsystem &quot;my-lib&quot;
  :class :package-inferred-system
  :depends-on (&quot;my-lib/interface/all&quot;
               &quot;my-lib/src/all&quot;
               &quot;my-lib/extras/all&quot;)
  :in-order-to ((test-op (load-op &quot;my-lib/test/all&quot;)))
  :perform (test-op (o c) (symbol-call :my-lib/test/all :test-suite)))

(defsystem &quot;my-lib/test&quot; :depends-on (&quot;my-lib/test/all&quot;))

(register-system-packages &quot;my-lib/interface/all&quot; '(:my-lib-interface))
(register-system-packages &quot;my-lib/src/all&quot; '(:my-lib-implementation))
(register-system-packages &quot;my-lib/test/all&quot; '(:my-lib-test))

(register-system-packages
 &quot;closer-mop&quot;
 '(:c2mop
   :closer-common-lisp
   :c2cl
   :closer-common-lisp-user
   :c2cl-user))
</pre></div>

<p><code>package-inferred-system</code>を扱えるのはASDF 3.1以降なので、最初のフォームはそのチェックをしています。もっとも、主要なLisp処理系でこれ以前のバージョンを含んでいるものはありませんから、おそらくもはや必要のない記述でしょう。
</p>
<a name="index-register_002dsystem_002dpackages"></a>
<p>このスタイルでは、システムやコンポーネントによって<code>use</code>される、あるいは提供されるパッケージは、パッケージ名（の小文字化）とシステム名が一致していない場合は<code>register-system-packages</code>で登録されなければなりません。
</p>
<a name="index-define_002dpackage"></a>
<a name="index-uiop_003adefine_002dpackage"></a>
<p>次に、<code>my-lib</code>を構成する各ソースファイルは、<code>defpackage</code>か<code>uiop:define-package</code>によるパッケージ定義から始まるでしょう。それらの間の依存関係は<code>:use</code>や<code>:mix</code>などのオプションから推論されます。例えば、<samp>interface/order.lisp</samp>というファイルが次のパッケージ定義で始まるとします:
</p>
<div class="lisp">
<pre class="lisp">(uiop:define-package :my-lib/interface/order
  (:use :closer-common-lisp
        :my-lib/interface/definition
        :my-lib/interface/base)
  (:mix :fare-utils :uiop :alexandria)
  (:export ...))
</pre></div>

<p>ASDFはこのファイルがシステム<code>closer-mop</code>に依存していることを知り（<code>use</code>しているのは<code>closer-common-lisp</code>パッケージですが、このパッケージがシステム<code>closer-mop</code>に対応していることは上で登録されています）、また、２つのシステム<code>my-lib/interface/definition</code>、<code>my-lib/interface/base</code>にも依存していると判断します。
</p>
<p>しかし、ASDFはどのようにして、トップレベルのシステム<code>my-lib</code>から<samp>interface/order.lisp</samp>にたどり着くのでしょうか？ 上の例では、<samp>interface/all.lisp</samp>（と他の<samp>all.lisp</samp>）が、それ以下の階層にあるパッケージの（エクスポートされている）シンボルをまとめて再エクスポートしているでしょう。このようなファイルは<code>uiop:define-package</code>で簡単に書けます:
</p>
<div class="lisp">
<pre class="lisp">(uiop:define-package :my-lib/interface/all
  (:nicknames :my-lib-interface)
  (:use :closer-common-lisp)
  (:mix :fare-utils :uiop :alexandria)
  (:use-reexport
   :my-lib/interface/definition
   :my-lib/interface/base
   :my-lib/interface/order
   :my-lib/interface/monad/continuation))
</pre></div>

<p>こうすれば、<samp>my-lib.asd</samp>の依存関係に各<code>my-lib/.../all</code>システムを指定するだけで、ASDFが<samp>interface/order.lisp</samp>や他のすべての依存関係を<code>:use-reexport</code>から発見してくれます。このように、<code>:use-reexport</code>はエクスポートされたシンボルを「継承」するオプションであり、他にも<code>uiop:define-package</code>にはこの用途で便利なオプションがたくさんあります。
</p>

<p>また、ASDFは<code>:import-from</code>オプションからも依存関係を発見できます、パッケージからシンボルをインポートすると、ASDFはそのパッケージに対応するシステムを依存関係に含めるでしょう。次の例を見てください。最初の<code>:import-from</code>節では<code>foo/baz</code>パッケージから<code>sym1</code>、<code>sym2</code>がインポートされていますが、この記述でASDFは、カレントシステムがシステム<code>foo/baz</code>に依存していることを推論します。いっぽう、特にシンボルをインポートせず、<code>foo/quux:bletch</code>のようにパッケージの接頭辞付きで使いたいケースもあるでしょう。この場合は、２番目の<code>:import-from</code>節のように、単に依存関係を宣言するための空インポートをします。
</p>
<div class="lisp">
<pre class="lisp">(defpackage :foo/bar
  (:use :cl)
  (:import-from :foo/baz #:sym1 #:sym2)
  (:import-from :foo/quux)
  (:export ...))
</pre></div>

<p>ASDF 3.1.5.6から、ASDFはソースファイルの場所を（<code>:pathname</code>オプションで指定できる）<code>component-pathname</code>を基点に探すようになりました。それ以前のバージョンでは<code>system-source-directory</code>を使っていたので、明示的に<code>:pathname</code>を指定していても、<samp>.asd</samp>ファイルのあるディレクトリを基点にしていました。<a name="DOCF21" href="#FOOT21"><sup>21</sup></a>
</p>


<hr>
<a name="ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb"></a>
<a name="ASDFnoobuziekutomoderu"></a>
<h2 class="chapter">7 ASDFのオブジェクトモデル</h2>
<a name="index-component-1"></a>
<a name="index-operation-1"></a>

<p>ASDFは、全体がオブジェクト指向でデザインされています。システムの構造も、システムに対するオペレーションも、拡張可能なプロトコルに従っているので、プログラマはASDFに新しい機能を加えることができます。例えば、<code>cffi</code>は<code>cffi-grovel</code>というASDF拡張によって、Cライブラリへのインターフェースの記述ファイルや、LispにCコードを埋め込むラッパーファイルを扱うコンポーネント型（それぞれ<code>cffi-grovel-file</code>と<code>cffi-wrapper-file</code>）を追加し、ABCL提供の<code>asdf-jar</code>はJavaのJARアーカイブを作る機能をもたらし、<code>poiu</code>はバックグラウンドプロセスを使って並列ビルドを可能にします。
</p>
<p>ASDFの最も基本的なクラスは<code>component</code>と<code>operation</code>です。<code>component</code>が表すのは、１つのソースファイルか、複数のソースファイルのまとまりか、あるいはそれらから生み出されるもの（faslファイルなど）です。<code>operation</code>はコンポーネントに対して行われる何らかの変換であり、コンポーネントを中間結果や最終的な生成物に変えます。コンポーネント同士は<em>依存関係</em>によって関係づけられていて、それはシステム定義の中で指定されます。
</p>
<a name="index-action"></a>
<a name="index-akusiyon"></a>
<p><code>operate</code>によってコンポーネント（たいていはシステム）に対するオペレーションを指示したとき、ASDFはまず<code>make-plan</code>関数を使って、依存関係を調べ、処理全体の<em>計画(plan)</em>を建てます。<a name="DOCF22" href="#FOOT22"><sup>22</sup></a>
<code>make-plan</code>の返す<code>plan</code>オブジェクトは実行すべき<em>アクション(action)</em>の順序付きリストを含んでいます。アクションとは<code>operation</code>と<code>component</code>のペアであり、ビルドの１ステップとして<code>perform</code>されるものです。また、このアクションのリストは、どのアクションも必要な依存関係が満たされるまでは実行されないことを保証します。<a name="DOCF23" href="#FOOT23"><sup>23</sup></a>
</p>
<p>この章では我々は、ASDFのオブジェクト指向プロトコル――プロトコルを構成するクラスと、それに対する総称関数――について解説します。これらの総称関数は多くの場合、コンポーネントとオペレーションの両方を引数に取ります。CLOSの多重ディスパッチを利用することで、ASDFは強力な機能を持ち、設定が柔軟に変更できるようになっています。我々は、まず組み込みのコンポーネントとオペレーションについて解説し、さらに新しいクラスやメソッドを定義してASDFプロトコルを拡張する方法を説明します。また、ASDFの<em>関数</em>の挙動をカスタマイズするためのさまざまな<em>フック</em>についても解説します。
</p>

<hr>
<a name="g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3"></a>
<a name="operesiyon"></a>
<h3 class="section">7.1 オペレーション</h3>
<a name="index-operation"></a>
<a name="index-operesiyon"></a>

<p>ユーザーがシステムに対して何らかの処理を要求したときは、必ず適切な<em>オペレーション</em>オブジェクトが生成されます。例えば次のような処理が考えられるでしょう:
</p>
<ul>
<li> システムのすべてのファイルをコンパイルする
</li><li> コンパイルされたファイルを起動中のLisp環境にロードする
</li><li> ソースファイルを別の場所にコピーする
</li></ul>

<p>オペレーションは単に直接呼び出すこともできますし、実行せずにその結果がどうなるか確認することもできます。そこで実際の細々とした仕事をするのは、オペレーションとコンポーネント型によって特定化されたメソッド（のまとまり）です。オペレーションは、システムとともに引数として<code>operate</code>に与えることで、呼び出すことができます。（→ <a href="#operate">operate</a>）
</p>
<p>頻出の作業については<code>operation</code>の組み込みサブクラスがありますし、あまり使われない作業についても既にあることが多いでしょう。これに加えてASDFは、プログラマがASDF拡張を定義するためのビルドブロックとして使える「抽象的な」<code>operation</code>クラスも備えています。これについては以下に順を追って解説します。
</p>


<p>オペレーションは、<code>operate</code>によってシステムに対して呼び出されます。
</p>
<a name="operate"></a><dl>
<dt><a name="index-operate-1"></a>総称関数: <strong>operate</strong> <em>operation component &amp;rest initargs &amp;key force force-not verbose &amp;allow-other-keys</em></dt>
<dt><a name="index-oos-1"></a>総称関数: <strong>oos</strong> <em>operation component &amp;rest initargs &amp;key &amp;allow-other-keys</em></dt>
<dd><p><code>operate</code>は<var>component</var>に対して<var>operation</var>を呼び出します。<code>oos</code>（operate-on-systemの略）は<code>operate</code>のエイリアスです。
</p>
<p><var>operation</var>はオペレーション指示子(operation designator)です。オペレーション指示子は<code>operation</code>オブジェクトそのものでもよいですが、通常はシンボルが使われるでしょう。シンボルは<code>make-operation</code>に渡され、（そこで<code>make-instance</code>が呼ばれて）<code>operation</code>オブジェクトが作られます。
<var>component</var>はコンポーネント指示子(component designator)です。コンポーネント指示子は同様に、<code>component</code>オブジェクトそのものや、コンポーネント（たいていはシステム）の名前を表す文字列・シンボル（<code>string-downcase</code>で小文字化される）ですが、システムの子コンポーネントを指したい場合は文字列・シンボルの<em>リスト</em> <a name="DOCF24" href="#FOOT24"><sup>24</sup></a>も使えます。
</p>
<p><var>initargs</var>が<code>make-operation</code>に渡される仕様は廃止予定であり、削除されるでしょう。詳しくは<a href="#make_002doperation">make-operation</a>を参照してください。依存関係によって、オペレーションがシステムやその子コンポーネントに対して他のオペレーションを呼び出すことがありますが、この際、元の<var>initargs</var>が渡されるかどうかは（今のところ）不確定です。
</p>
<p><var>force</var>が<code>:all</code>の場合、（依存関係に含まれる）すべてのシステムが、前回のコンパイルから未変更でも再コンパイルされます。<var>force</var>が<code>t</code>の場合、ロードされるシステムに限り、前回のコンパイルから未変更でも再コンパイルされます。<var>force</var>が（システム指示子の）リストの場合、リストに含まれるシステムは前回のコンパイルから未変更でも再コンパイルされます。<var>force-not</var>が<code>:all</code>の場合、（依存関係に含まれる）すべてのシステムは、前回のコンパイルから変更されていても再コンパイルされません。<var>force-not</var>が<code>t</code>の場合、ロードされるシステム<em>以外</em>のシステムは、前回のコンパイルから変更されていても再コンパイルされません。（この仕様はASDF 3.1.2で変更されました。）<var>force</var>が（システム指示子の）リストの場合、リストに含まれるシステムは前回のコンパイルから変更されていてもコンパイルされません。
</p>
<a name="index-register_002dimmutable_002dsystem"></a>
<a name="index-immutable-systems"></a>
<p><var>force</var>と<var>force-not</var>に影響されるのは、依存関係に含まれていて、既にコンパイルされているシステムです。<var>force-not</var>は当然<var>force</var>に優先する（べきな）のですが、この挙動は残念ながらASDF 3.1.2以降で初めて保証されました。また、関数<code>register-immutable-system</code>（ASDF 3.1.5以降）によってイミュータブルと登録されたシステムは、（たとえ<samp>.asd</samp>ファイルがファイルシステムによって更新されていなくても）常に<var>force-not</var>であるとみなされます。（→ <a href="#Miscellaneous-Functions">Miscellaneous Functions</a>）
</p>
<a name="index-traverse"></a>
<p>次のフォームを実行すると、<code>operate</code>が実際に何をどのような順序で実行するのか確かめることができます。<a name="DOCF25" href="#FOOT25"><sup>25</sup></a>
</p><div class="lisp">
<pre class="lisp">(asdf:traverse operation-class system-name)
</pre></div>
</dd></dl>

<dl>
<dt><a name="index-make_002doperation"></a>関数: <strong>make-operation</strong> <em>operation-class &amp;rest initargs</em></dt>
<dd><a name="make_002doperation"></a>
<p><var>initargs</var>は、オペレーションオブジェクトを作る際に<code>make-instance</code>に渡されます。
</p>
<p><strong>注意:</strong> <code>operation</code>の<var>initargs</var>は廃止予定であり、近い将来ASDFから削除されるでしょう。
</p>
<p><strong>注意:</strong> <code>operation</code>のインスタンスは、直接<code>make-instance</code>で<strong>作ってはいけません</strong>。必ず<code>make-operation</code>を使ってください。<code>operation</code>インスタンスを直接作ろうとすると、ランタイムエラーを起こすでしょう。
</p></dd></dl>


<hr>
<a name="g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3"></a>
<a name="Zu-miIp-minooperesiyon"></a>
<h4 class="subsection">7.1.1 組み込みのオペレーション</h4>

<p>このセクションで解説するオペレーションはすべて<code>asdf</code>パッケージにあり、総称関数<code>operate</code>で呼び出すことができます。
</p>
<div class="lisp">
<pre class="lisp">(asdf:operate 'asdf:<var>オペレーション名</var> :<var>システム名</var> {<var>オペレーションのオプション ...</var>})
</pre></div>

<dl>
<dt><a name="index-compile_002dop"></a>オペレーション: <strong>compile-op</strong></dt>
<dd>
<p>このオペレーションは、指定されたコンポーネントをコンパイルします。つまり、<code>cl-source-file</code>は<code>compile-file</code>でコンパイルされ、依存する、あるいは子コンポーネントであるシステム、モジュールには再帰的に<code>compile-op</code>が適用されます。
</p>
<p><code>compile-op</code>は<code>prepare-op</code>に依存していて、<code>prepare-op</code>は依存するすべてのコンポーネントに対する<code>load-op</code>に依存しています。したがって、<code>operate</code>で<code>compile-op</code>を呼び出すと、それらのコンポーネント群は単にコンパイルされるだけでなくロードもされるでしょう、しかし、<code>compile-op</code>では、指定されたシステムそのもの（の一部）は、それに依存するシステムがないのでロードされずに残ることになります。システムをロードしたい場合には<code>load-op</code>を使ってください。
</p></dd></dl>

<dl>
<dt><a name="index-load_002dop"></a>オペレーション: <strong>load-op</strong></dt>
<dd>

<p>このオペレーションは、指定されたコンポーネントのコンパイル済みコードをロードします。つまり、<code>cl-source-file</code>についてはそのfaslファイルがロードされ、依存する、あるいは子コンポーネントであるシステム、モジュールには再帰的に<code>load-op</code>が適用されます。なお<code>load-op</code>は<code>compile-op</code>に依存していて、faslファイルは<code>compile-op</code>の出力として得られます。
</p>
<p><code>load-op</code>は<code>prepare-op</code>にも依存していて、<code>prepare-op</code>は依存するすべてのコンポーネントに対する<code>load-op</code>に依存しています。
</p></dd></dl>

<dl>
<dt><a name="index-prepare_002dop"></a>オペレーション: <strong>prepare-op</strong></dt>
<dd>
<p>このオペレーションは、指定されたコンポーネントが依存する（再帰的な意味で）すべてのコンポーネントが（<code>load-op</code>で）ロードされることを保証します。<code>compile-op</code>や<code>load-op</code>が実行される前に、必要な前提を満たすためのオペレーションです。
</p></dd></dl>

<dl>
<dt><a name="index-load_002dsource_002dop"></a>オペレーション: <strong>load-source-op</strong></dt>
<dt><a name="index-prepare_002dsource_002dop"></a>オペレーション: <strong>prepare-source-op</strong></dt>
<dd>
<p><code>load-source-op</code>は<code>load-op</code>と似ていますが、モジュールに属する<code>cl-source-file</code>をfaslからではなくソースからロードします。<code>load-source-op</code>は（<code>prepare-op</code>に代えて）<code>prepare-source-op</code>に依存しています。<code>prepare-source-op</code>は<code>prepare-op</code>に類似のオペレーションで、依存関係が<code>load-source-op</code>でロードされることを保証します。
</p>
</dd></dl>

<a name="test_002dop"></a><dl>
<dt><a name="index-test_002dop"></a>オペレーション: <strong>test-op</strong></dt>
<dd>
<p>このオペレーションはモジュールのテストを行うためにありますが、デフォルトのメソッドは何もしません。また、デフォルトではモジュールに対して先に<code>load-op</code>が実行されることを要求します。なお、デフォルトの<code>operation-done-p</code>メソッドは（訳注: たとえ、<code>test-op</code>が正常に実行された後であっても）常に<code>nil</code>を返すので、このオペレーションは<em>決して</em>完了したことにはなりません。（→ <a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a>） つまり、あなたが<code>test-op</code>を呼ぶと、既にそのシステムをテストしたことがあっても、もう一度テストしたいのだとみなされるわけです。
</p>
<p>ASDFはこのオペレーションの結果について何も定義していません。というのも、テスト結果をユーザーに伝える方法を、Lispコミュニティで使われる様々なテストのテクニックやライブラリすべてに対して互換性を持つように、統一的に定義するのは困難だとわかっているからです。さらに、ASDFのオペレーションは成功・失敗を返り値とするわけではないという点も、この問題を難しくしています。テスト結果を返すようにしたいのであれば、何らかのコンディションを定義し、<code>test-op</code>が失敗した時にそのコンディションを通知することを勧めます。どのテストが失敗したか、という情報はコンディションに保持させると良いでしょう。
</p>
<p>一般的に、テストコードはテスト用の別の<em>システム</em>に記述されることが多いです。テスト用のシステムを分離すれば、メインのシステムの依存関係には不要なテストフレームワークを指定しなくてすみます。それでは、テストフレームワーク<a href="https://common-lisp.net/project/fiveam/">fiveam</a>を使った例を見てみましょう:
</p><div class="lisp">
<pre class="lisp">(defsystem &quot;foo&quot;
  :in-order-to ((test-op (test-op &quot;foo/test&quot;)))
 ...)

(defsystem &quot;foo/test&quot;
  :depends-on (&quot;foo&quot; &quot;fiveam&quot;)
  ...)
</pre></div>

<p>さらに、<code>test-op</code>の<code>perform</code>メソッドを次のように定義します:
</p><div class="lisp">
<pre class="lisp">(defsystem &quot;foo/test&quot;
  :depends-on (&quot;foo&quot; &quot;fiveam&quot;)
  :perform (test-op (o s)
                    (uiop:symbol-call :fiveam '#:run!
                       (uiop:find-symbol* '#:foo-test-suite
                                            :foo-tests)))
  :components ((:file &quot;test&quot;)) ; （訳者追加）
  ...)
</pre></div>

<p>[訳者補足]
</p>
<p>上のように定義すると、<code>(asdf:test-system :foo)</code>を実行してシステム<code>foo</code>に対する<code>test-op</code>を呼び出した際、<code>:in-order-to</code>オプションによって、まずはシステム<code>foo/test</code>に対する<code>test-op</code>が呼び出されます。（<code>foo</code>の<code>test-op</code>は何もしないので、アクションを「委託」しているのと同じことになります。）呼び出されたときの動作は<code>foo/test</code>の<code>:perform</code>オプションで定義されており、この例では、端的に言えば<code>(fiveam:run! 'foo-tests:foo-test-suite)</code>が実行されてテストが走ることになります。<samp>test.lisp</samp>には例えば次のようなテストコードが書かれているでしょう。
</p>
<div class="lisp">
<pre class="lisp">(defpackage :foo-tests
  (:use :cl :fiveam))
(in-package :foo-tests)

;; スイート（テストのまとまり）を定義する
(def-suite foo-test-suite)
(in-suite foo-test-suite)

;; テストを定義する
(test basic-test
  (is (= 1 (foo:baz 10)))              ; (foo:baz 10)の返り値が1であることをテストする
  (signals type-error (foo:baz &quot;10&quot;))) ; (foo:baz &quot;10&quot;)がtype-errorになることをテストする
</pre></div>
<p><code>fiveam</code>は<code>foo-test-suite</code>に属する一連のテスト（この場合は<code>basic-test</code>のみ）を実行し、その結果を標準出力に表示するでしょう。ただし、システム定義<code>(defsystem &quot;foo/test&quot; ...)</code>のリード時に<code>fiveam</code>パッケージが存在するとは限りませんから、<code>(fiveam:run! ...)</code>とそのまま書くとエラーになる可能性があります。<code>uiop:symbol-call</code>は「<code>fiveam</code>パッケージに属する<code>run!</code>関数を呼び出す」フォームを安全に書く――シンボルの解決を実行時に遅らせる――ための関数であり、この用途でよく使われます。<code>uiop:find-symbol*</code>も同様の目的で使われています。<a href="https://privet-kitty.github.io/etc/uiop.html#UIOP_002fPACKAGE">UIOPのマニュアル</a>も参照すると良いでしょう。
</p>
<p>[訳者補足終わり]
</p>
</dd></dl>



<dl>
<dt><a name="index-compile_002dbundle_002dop"></a>オペレーション: <strong>compile-bundle-op</strong></dt>
<dt><a name="index-monolithic_002dcompile_002dbundle_002dop"></a>オペレーション: <strong>monolithic-compile-bundle-op</strong></dt>
<dt><a name="index-load_002dbundle_002dop"></a>オペレーション: <strong>load-bundle-op</strong></dt>
<dt><a name="index-monolithic_002dload_002dbundle_002dop"></a>オペレーション: <strong>monolithic-load-bundle-op</strong></dt>
<dt><a name="index-deliver_002dasd_002dop"></a>オペレーション: <strong>deliver-asd-op</strong></dt>
<dt><a name="index-monolithic_002ddeliver_002dasd_002dop"></a>オペレーション: <strong>monolithic-deliver-asd-op</strong></dt>
<dt><a name="index-lib_002dop"></a>オペレーション: <strong>lib-op</strong></dt>
<dt><a name="index-monolithic_002dlib_002dop"></a>オペレーション: <strong>monolithic-lib-op</strong></dt>
<dt><a name="index-dll_002dop"></a>オペレーション: <strong>dll-op</strong></dt>
<dt><a name="index-monolithic_002ddll_002dop"></a>オペレーション: <strong>monolithic-dll-op</strong></dt>
<dt><a name="index-image_002dop"></a>オペレーション: <strong>image-op</strong></dt>
<dt><a name="index-program_002dop"></a>オペレーション: <strong>program-op</strong></dt>
<dd>
<p>これらは「バンドル(bundle)」に関わるオペレーションです。バンドルは、アプリケーション全体（もしくはアプリケーション中の各システム）を単一のファイルに束ねたものです。
</p>
<p><code>compile-bundle-op</code>はターゲットとなるシステムとそれが依存する各システムについて、それぞれ単一のfaslファイルを作ります。<code>monolithic-compile-bundle-op</code>はターゲットとなるシステムとそれが依存するシステムをすべて束ねて、単一のfaslファイルを作ります。つまり、アプリケーション全体を１つのfaslファイルにすることができます。<code>load-bundle-op</code>は<code>compile-bundle-op</code>の出力をロードします。ただし、<code>compile-bundle-op</code>は（出力が最新でない場合）コンパイルの副作用として、中間生成物である各faslファイルをロードすることもあるという点に注意してください。バンドルに関するオペレーションは特にECLにおいて重要です。というのもECLでは、ダイナミックリンクの際に、数十もの独立したfaslファイルをロードするのは１つのファイルをロードするのに比べてずっと重いからです。
</p>
<p>注意: <code>compile-bundle-op</code>、<code>monolithic-compile-bundle-op</code>、<code>load-bundle-op</code>、<code>monolithic-load-bundle-op</code>、<code>deliver-asd-op</code>、<code>monolithic-deliver-asd-op</code>は、ASDF 3.1以前はそれぞれ<code>fasl-op</code>、<code>monolithic-fasl-op</code>、<code>load-fasl-op</code>、<code>monolithic-load-fasl-op</code>、<code>binary-op</code>、<code>monolithic-binary-op</code>と呼ばれていました。後方互換性のために古い名称も残されていますが、それらは実際の機能を表していない不適切な名前ではあります。
</p>
<p><code>compile-bundle-op</code>で作った単一のfaslファイルを配布する時は、<code>precompiled-system</code>クラスを使うことで、ユーザーはソースで配布されたものと互換性を持ったシステムとして使えるようになります。単一のfaslとともに配布される<samp>.asd</samp>ファイルは次のようになるでしょう:
</p><div class="lisp">
<pre class="lisp">(defsystem :mysystem
  :class :precompiled-system
  :fasl (faslのパス名に評価されるフォーム))
</pre></div>
<p>あるいは、<code>deliver-asd-op</code>や<code>monolithic-deliver-asd-op</code>を使えば、ASDFは<code>compile-bundle-op</code>の出力に加えてシステム定義も作ります。これによって、あなたのシステムやアプリケーションのコードを単一のファイルとして提供することができます。当然ながら、これらの結果をカレントイメージでテストしたい時は、新しくできた<samp>.asd</samp>ファイルを使おうとする<em>前</em>に<code>(asdf:clear-configuration)</code>（あるいは少なくとも<code>(asdf:clear-source-registry)</code>）を実行することを忘れないでください。ファイルシステムからソースレジストリを再設定するためです。
</p>
<p><code>program-op</code>は指定されたシステムとその依存関係から、実行可能ファイルを作り出します。その際、コアイメージをダンプ・復元する時のフックや、コマンドライン引数の処理が必要になるかもしれませんが、UIOPにはこの用途で便利なユーティリティがあります。実行時のエントリーポイントは<code>defsystem</code>の<code>:entry-point</code>オプションで指定できます。例えばエントリーポイントを<code>my-app:main</code>関数にする場合は、<code>:entry-point &quot;my-app:main&quot;</code>とします。処理系によっては、<code>(asdf:operate 'asdf:program-op :my-app)</code>を実行すると、オペレーションの完了時に現在のLispイメージが終了するかもしれません。<code>program-op</code>の使用例は<samp>test/hello-world-example.asd</samp>、<samp>test/hello.lisp</samp>を参照してください。ビルド、テストは<samp>test/test-program.script</samp>、<samp>test/make-hello-world.lisp</samp>に書かれています。
</p>
<p><code>image-op</code>はイメージをダンプしますが、スタンドアローンとは限らないし、システムのエントリーポイントが使われたりすることもありません。お使いのLisp処理系のコアイメージの扱いに従い、システムがプリロードされたイメージを出力することになるでしょう。これは中間的なビルド結果として使われたり、ラッパーとなるスクリプトとともに使われたりします。
</p>
<p><code>lib-op</code>はターゲットとなるシステムとそれが依存する各システムについて、リンク可能なオブジェクト（FFIファイル、あるいはECLであればLispファイルも）から<samp>.a</samp>ファイル（Windowsでは<samp>.lib</samp>）をそれぞれビルドするためのオペレーションであり、<code>monolithic-lib-op</code>はアプリケーション全体に対して１つの<samp>.a</samp>ファイルを作ります。<code>dll-op</code>、<code>monolithic-dll-op</code>も類似のオペレーションですが、ダイナミックリンクのための<samp>.so</samp>ファイル（Windowsでは<samp>.dll</samp>、MacOS Xでは<samp>.dynlib</samp>）を作ります。
</p>
<p>これらの「バンドル」オペレーションは、ASDF 3以降で、アクティブにメンテナンスされているLisp処理系であれば常に利用可能ですが、メンテナンスされていない古い処理系では使えない可能性があります。この機能は、以前は特定の処理系のために<code>asdf-bundle</code>というシステムに分離されて実装されていて、さらに遡ればECL限定の機能であった<code>asdf-ecl</code>が元になっています。
</p>
<p>「バンドル」オペレーションの出力先のパスは、他のオブジェクトファイルと同様に<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>の設定に従いますが、<code>defsystem</code>の<code>:build-operation</code>オプションに設定されたオペレーションに限っては異なります。<a name="DOCF26" href="#FOOT26"><sup>26</sup></a> この仕様は満足のいくものとは言いがたいので、将来的には変わる可能性があります。より良い仕様についてあなたの提案はありますか？
</p></dd></dl>

<dl>
<dt><a name="index-concatenate_002dsource_002dop"></a>オペレーション: <strong>concatenate-source-op</strong></dt>
<dt><a name="index-monolithic_002dconcatenate_002dsource_002dop"></a>オペレーション: <strong>monolithic-concatenate-source-op</strong></dt>
<dt><a name="index-load_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>load-concatenated-source-op</strong></dt>
<dt><a name="index-compile_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>compile-concatenated-source-op</strong></dt>
<dt><a name="index-load_002dcompiled_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>load-compiled-concatenated-source-op</strong></dt>
<dt><a name="index-monolithic_002dload_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>monolithic-load-concatenated-source-op</strong></dt>
<dt><a name="index-monolithic_002dcompile_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>monolithic-compile-concatenated-source-op</strong></dt>
<dt><a name="index-monolithic_002dload_002dcompiled_002dconcatenated_002dsource_002dop"></a>オペレーション: <strong>monolithic-load-compiled-concatenated-source-op</strong></dt>
<dd>
<p><code>concatenate-source-op</code>は、ターゲットとなるシステムとそれが依存する各システムについて、すべての<code>cl-source-file</code>を依存関係に沿った順序でそれぞれ１つのソースファイルに連結します。<code>monolithic-concatenate-source-op</code>は、ターゲットとなるシステムとそれが依存するシステムをすべて束ねて、単一のソースファイルを出力します。上のリストには、さらに連結した出力ファイルをロードしたり、コンパイルしてからロードしたりといったオペレーションが含まれています。
</p>
<p>これらのオペレーションは、システムやアプリケーションを単一のソースファイルとして配布するのに役立ちます。その際に、ロードやコンパイル後のロードが適切に行われるかテストするのにも使われるでしょう。
</p>
<p>ASDF自身も、<code>monolithic-concatenate-source-op</code>を使って単一のソースファイル<samp>asdf.lisp</samp>として配布されており、<code>asdf/defsystem</code>システムそのものの前に前処理と<code>uiop</code>ライブラリが挿入されています。
</p></dd></dl>


<hr>
<a name="g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b"></a>
<a name="Xin-siioperesiyonwoDing-Yi-suru"></a>
<h4 class="subsection">7.1.2 新しいオペレーションを定義する</h4>

<p>ASDFは、オブジェクト指向の手法で拡張可能なようにデザインされています。プログラマは<code>operation</code>のサブクラスを作って必要な挙動を実装することで、ASDFに新しい機能を追加することができます。
</p>
<p>ASDFの組み込みのオペレーションは、ユーザー定義のオペレーションに対して「特権的」な地位にあるわけではありませんが、開発者の方には、独自のオペレーションを追加するときに決して<code>asdf</code>パッケージを使わないようにお願いします。というのも、名前の衝突は避けるべきですし、かといって我々は「ASDFのオペレーション名を管理するグローバルなレジストリ」をいちいち作りたくもないからです。
</p>
<p>[訳者補足]
</p>
<p>また、ASDFにはオペレーション・アクション間の依存関係を指定するためのサブクラスとして、<code>downward-operation</code>、<code>upward-operation</code>、<code>sideway-operation</code>、<code>selfward-operation</code>、<code>non-propagating-operation</code>の５つが備わっており、すべてのオペレーションはこの内の少なくとも１つを<em>継承するべき</em>です。オペレーションの依存関係を指定する必要がないときも、<code>non-propagating-operation</code>を継承するようにしてください。<code>operation</code>のみを継承すると、そのオペレーションを呼んだ時に警告が通知されるでしょう。
例として、組み込みの<code>load-op</code>を簡略化した<code>my-load-op</code>を定義してみましょう:
</p>
<div class="lisp">
<pre class="lisp">(defclass my-load-op (downward-operation selfward-operation)
  ((selfward-operation :initform '(prepare-op compile-op) :allocation :class)
   ;; (downward-operation :initform nil :allocation :class)
   ))
</pre></div>

<p><code>non-propagating-operation</code>を除く４つのクラスはすべて、同名のスロットをクラス変数として備えています。<code>selfward-operation</code>は「同一コンポーネントに対する別のオペレーション」に依存するオペレーションです。上の例では、コンポーネント<code>foo</code>に対して<code>my-load-op</code>が呼ばれた時、先だって<code>foo</code>に<code>prepare-op</code>と<code>compile-op</code>が適用されます。次に、<code>downward-operation</code>は「子コンポーネントに対するオペレーション」に依存するオペレーションです。上の例では<code>downward-operation</code>スロットを省略していますが、デフォルトの<code>nil</code>は同じオペレーション<code>my-load-op</code>を意味します。つまり、コンポーネント<code>foo</code>に対して<code>my-load-op</code>が呼ばれた時、先だって<code>foo</code>のすべての子コンポーネントに対して<code>my-load-op</code>が適用されます。
</p>
<dl>
<dt><a name="index-downward_002doperation"></a>オペレーション: <strong>downward-operation</strong> <em><var>(downward-operation :type operation-designator :allocation :class)</var></em></dt>
<dt><a name="index-upward_002doperation"></a>オペレーション: <strong>upward-operation</strong> <em><var>(upward-operation :type operation-designator :allocation :class)</var></em></dt>
<dt><a name="index-sideway_002doperation"></a>オペレーション: <strong>sideway-operation</strong> <em><var>(sideway-operation :type operation-designator :allocation :class)</var></em></dt>
<dt><a name="index-selfward_002doperation"></a>オペレーション: <strong>selfward-operation</strong> <em><var>(selfward-operation :type (or operation-designator list) :allocation :class)</var></em></dt>
<dt><a name="index-non_002dpropagating_002doperation"></a>オペレーション: <strong>non-propagating-operation</strong></dt>
<dd>
<p><code>asdf::operation-designator</code>型は、オペレーションオブジェクト・シンボル・クラスのいずれかです。多くの場合、シンボルが使われるでしょう。その際、<code>nil</code>は「同じオペレーション」を意味します。
</p>
<p><code>downward-operation</code>は子コンポーネントについての依存関係を持つオペレーションです。<code>baz-op</code>が<code>foo-op</code>の<code>downward-operation</code>スロットに指定されているとき、ASDFはコンポーネント<code>parent</code>に対するアクション<code>(foo-op . parent)</code>を実行する前に、まずは<code>parent</code>のすべての子コンポーネント<code>child</code>についてアクション<code>(baz-op . child)</code>を実行します。
</p>
<p><code>upward-operation</code>は親コンポーネントについての依存関係を持つオペレーションです。<code>baz-op</code>が<code>foo-op</code>の<code>upward-operation</code>スロットに指定されているとき、ASDFはコンポーネント<code>child</code>に対するアクション<code>(foo-op . child)</code>を実行する前に、まずは<code>child</code>の親コンポーネントである<code>parent</code>についてアクション<code>(baz-op . parent)</code>を実行します。
</p>
<p><code>sideway-operation</code>は依存コンポーネントについての依存関係を持つオペレーションです。<code>baz-op</code>が<code>foo-op</code>の<code>sideway-operation</code>スロットに指定されているとき、ASDFはコンポーネント<code>c</code>に対するアクション<code>(foo-op . c)</code>を実行する前に、まずは<code>c</code>が依存している（<code>:depends-on</code>）すべてのコンポーネント<code>d</code>についてアクション<code>(baz-op . d)</code>を実行します。
</p>
<p><code>selfward-operation</code>は同一コンポーネントについての依存関係を持つオペレーションです。<code>baz-op</code>が<code>foo-op</code>の<code>selfward-operation</code>スロットに指定されているとき、ASDFはコンポーネント<code>c</code>に対するアクション<code>(foo-op . c)</code>を実行する前に、まずはアクション<code>(baz-op . c)</code>を実行します。<code>selfward-operation</code>スロットには、複数のオペレーションをリストとして指定することができます。
</p>
<p><code>non-propagating-operation</code>は依存関係を持たない、単独で実行されるオペレーションです。
</p>
<p>上で例示したように、これらのオペレーションは多重継承することができます。（もっとも、<code>non-propagating-operation</code>は単一継承するべきでしょう。）また、依存関係が循環しないようにするのはプログラマの責任に委ねられています。
</p></dd></dl>


<p>[訳者補足終わり]
</p>


<p>新しく作られたオペレーションには、多くの場合、次の総称関数の内の少なくとも１つについてメソッドを<em>定義しなければならない</em>でしょう。
</p>

<dl>
<dt><a name="index-perform"></a>総称関数: <strong>perform</strong> <em>operation component</em></dt>
<dd><p><code>perform</code>は何らかの入力ファイルから出力ファイルを作り出すための総称関数です。<code>prepare-op</code>のように依存関係の伝搬だけするようなオペレーションは別にしても、たいていのオペレーションについては<code>perform</code>メソッドが最も重要でしょう。<code>perform</code>が呼ばれると、（すべての依存関係について<code>perform</code>が実行されたあと）ターゲットのコンポーネントに対して処理が実行されます。
</p>
<p><code>perform</code>メソッドは、その入力と出力のパスを決めるのに<code>input-files</code>と<code>output-files</code>（下述）を呼ばなければなりません。ユーザーが、このメソッドを上書きしたり、<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>を変更したりできるようにするためです。<code>output-files</code>は多値を返しますが、<code>perform</code>は最初の値――出力パス名のリスト――のみを使うべきです。出力ファイルがただ１つと決まっている場合は、代わりに関数<code>output-file</code>が使えます。<code>output-file</code>は出力パス名が１つだけであることを保証し、そのパス名を返します。
</p></dd></dl>

<dl>
<dt><a name="index-output_002dfiles"></a>総称関数: <strong>output-files</strong> <em>operation component</em></dt>
<dd><p><code>perform</code>メソッドが何らかの出力ファイルを伴うならば、その出力先をASDFが定められるようにこのメソッドも定義しなくてはなりません。
</p>
<p><code>output-files</code>は２つの値を返します。１つ目はパス名のリストであり、２つ目はブーリアンです。ブーリアンが<code>nil</code>の場合（返り値が１つしかなく、２つ目が暗黙に<code>nil</code>となる場合も含む）、<code>:around</code>メソッドが<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>に従ってパス名を変換します。例えば、コンパイルされたオブジェクトファイルが処理系依存のキャッシュとして保存される場合などは、アウトプットトランスレーションが使われています。ブーリアンが<code>t</code>の場合は<code>:around</code>メソッドで変換されることはありません。
</p></dd></dl>

<dl>
<dt><a name="index-component_002ddepends_002don"></a>総称関数: <strong>component-depends-on</strong> <em>operation component</em></dt>
<dd>
<p>この総称関数は、アクションを引数に取り、依存するアクションをまとめたリストを返します。リストのフォーマットについては下で説明します。
</p>
<p>[訳者補足]
</p>
<p>上述の５つのサブクラスを継承してオペレーション間の依存関係を指定すれば、<code>component-depends-on</code>メソッドは適切に構成されるので、通常は明示的にこのメソッドを定義する必要はありません。また、特定のコンポーネント、システムに対して依存関係を記述したい場合も、<code>:in-order-to</code>オプションを使えば事足りるでしょう。（→ <a href="#g_t_30a2_30af_30b7_30e7_30f3_306e_4f9d_5b58_95a2_4fc2">アクションの依存関係</a>） しかし、それらを超えるような複雑な依存関係を指定したい場合――例えば特定の<em>コンポーネント型</em>に対するオペレーションに限って依存関係を追加したい場合など――は、メソッド定義が必要になるかもしれません。
</p>
<p>なお、名前の印象に反して、コンポーネント間の依存関係を返す関数ではないことに気を付けましょう。システムの<code>:depends-on</code>オプションに与えた依存コンポーネントを調べたい場合は、代わりに<code>system-depends-on</code>という総称関数があります。
</p>

<p>[訳者補足終わり]
</p>

<p>自分でこのメソッドを定義する場合は、メソッドで追加したい内容と<code>(call-next-method)</code>で返るリストを常に<code>append</code>して返すことを<em>強く</em>推奨します。あなたがASDFの内部を熟知しているのでない限り、そうしないと「興味深い」エラーが起こる可能性が高いです。これは概念的には、メソッドコンビネーションの<code>append</code>を手動でやっているのと同じことになります。（残念ながら、標準のメソッドコンビネーションを互換的に導入するのは、手遅れでした。）
</p>
<p>それでは、返り値について説明します。<code>component-depends-on</code>が返すリストの各エントリもまたリストです。
</p>
<p>各エントリの最初の要素（<code>car</code>）はオペレーション指示子、つまりオペレーションオブジェクトそのものかオペレーションクラスのシンボル（例えば<code>load-op</code>、<code>compile-op</code>、<code>prepare-op</code>など）であり、後者は<code>make-operation</code>でインスタンス化されるでしょう。
</p>
<a name="index-coerce_002dname"></a>
<a name="index-find_002dcomponent"></a>
<p>各エントリの２番目以降（<code>cdr</code>）はコンポーネント指示子のリストです。コンポーネント指示子はコンポーネントオブジェクトそのものか、<code>find-component</code>でコンポーネントオブジェクトに変換される識別子(identifier)です。<code>find-component</code>は現在の親コンポーネントを第１引数に、識別子を第２引数にして呼び出されるでしょう。識別子は一般的には、文字列か、シンボル（<code>coerce-name</code>で小文字の文字列になる）か、あるいは文字列・シンボルのリストです。特に<code>nil</code>は親コンポーネントそのものを指します。
</p></dd></dl>


<p>新しく作られたオペレーションには、次の総称関数についてメソッドを<em>定義することができます</em>。
</p>

<dl>
<dt><a name="index-input_002dfiles"></a>総称関数: <strong>input-files</strong> <em>operation component</em></dt>
<dd><p><code>input-files</code>は、<code>perform</code>に対する入力ファイルのパス名のリストを返します。
</p>
<p>デフォルトの<code>input-files</code>のメカニズムは賢くできているので、あなたが自らメソッドを定義する必要はないことのほうが多いでしょう。メソッド定義が必要なのは、最終的な入力ファイル（のまとまり）が複数通り考えられるケースのみです。ほとんどのオペレーションは<code>selfward-operation</code>を継承していて、<code>selfward-operation</code>はソースファイルを含むように入力ファイルを適切に設定します。
</p>

</dd></dl>

<dl>
<dt><a name="index-operation_002ddone_002dp"></a>総称関数: <strong>operation-done-p</strong> <em>operation component</em></dt>
<dd><p>この総称関数は、アクション（オペレーションとコンポーネントの対）がもう一度<code>perform</code>されなければならない場合に<code>nil</code>を返します。デフォルトは常に<code>t</code>です。
</p>
<p><code>operation-done-p</code>にメソッドを定義する必要があるのは、ファイルシステム上のタイムスタンプが変わっていなくても前回のオペレーションの実行を無効にしてやりなおすべき状況がある、という場合に限ります。そしてその場合、このメソッドは<code>nil</code>を返すべきでしょう。
</p>

<p>例えば、このメソッドは<code>test-op</code>については常に<code>nil</code>を返します。テストというのは決して完了する性質のオペレーションではないからです。もちろん、単にテストのリポートファイルから結果を読み出すだけのオペレーションとして<code>test-report-op</code>のようなものを定義し、システム定義の<code>:in-order-to</code>オプションで<code>test-op</code>をこのオペレーションに委ねて、何度繰り返しても同じになるようにすることは可能です。その場合はこのメソッドが<code>t</code>を返すようにしても良いでしょう。
</p></dd></dl>


<p>何らかのメッセージを表示するオペレーションは、Lispのコンパイラやローダと同様に、出力先を標準の<code>*standard-output*</code>ストリームにするべきです。
</p>
<hr>
<a name="g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8"></a>
<a name="konponento"></a>
<h3 class="section">7.2 コンポーネント</h3>
<a name="index-component"></a>
<a name="index-konponento"></a>
<a name="index-system"></a>
<a name="index-sisutemu"></a>
<a name="index-system-designator"></a>
<a name="index-sisutemusizisi_0028sisutemuZhi-ShiZi-_0029"></a>
<a name="index-component-designator"></a>
<a name="index-konponentosizisi_0028konponentoZhi-ShiZi-_0029"></a>
<a name="index-_002asystem_002ddefinition_002dsearch_002dfunctions_002a"></a>

<p><code>component</code>オブジェクトが表すのは、１つのソースファイルか、複数のソースファイルのまとまりか、あるいはそれらから変換されるもの（faslなど）です。
</p>
<p><code>component</code>の組み込みのサブクラスとして重要なのは<code>system</code>、<code>source-file</code>、<code>module</code>です。<code>system</code>はコンポーネント階層のトップレベルにある特別なコンポーネントであり、<code>find-system</code>によって発見することができます。<code>source-file</code>は１つのソースファイルに対応します。<code>module</code>は中間的なコンポーネントであり、他のコンポーネント（<code>source-file</code>やさらなる<code>module</code>であっても良い）のまとまりを表します。（→ <a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a>）
</p>

<p><em>システム指示子(system designator)</em>はシステムそのものか、システムを表す文字列、シンボルです。（コンポーネント名の仕様と同じく、シンボルは小文字に変換されます。）
</p>
<p><em>コンポーネント指示子(component designator)</em>は基点となるコンポーネントに対する相対的な指示子であり、コンポーネントそのものか、文字列、シンボルか、あるいはコンポーネント指示子のリストです。
</p>
<dl>
<dt><a name="index-find_002dsystem"></a>関数: <strong>find-system</strong> <em>system-designator &amp;optional (error-p t)</em></dt>
<dd>
<p><code>find-system</code>はシステム指示子を引数に取り、システムを返します。システムが見つからなかった場合、デフォルトではエラー<code>missing-component</code>を通知しますが、<var>error-p</var>が<code>nil</code>の場合は単に<code>nil</code>を返します。
</p>
<p>システム定義ファイルを見つけてメモリ上のシステムをアップデートするために、<code>find-system</code>はリスト<code>*system-definition-search-functions*</code>に含まれる関数をそれぞれ<code>funcall</code>します。それらの関数はシステム名を引数に取り、（システム定義ファイルの）パス名かシステムオブジェクト（<code>system-source-directory</code>でパス名に変換される）を返すべきであり、返ったパス名はメモリ上に登録されるでしょう。こうして見つかったシステム定義ファイルがロードされるのは、次の条件のいずれかを満たす場合です:
</p>
<ul>
<li> メモリ上に同名のシステムがない場合
</li><li> 前回ロードされたパス名と異なっている場合
</li><li> ファイルのタイムスタンプが、メモリ上にあるシステムのタイムスタンプより新しい場合
</li></ul>

<a name="index-ASDF_002dUSER-package"></a>
<p><samp>.asd</samp>ファイルからシステム定義がロードされる際の暗黙のカレントパッケージは<code>asdf-user</code>であり、<code>asdf-user</code>は<code>asdf</code>、<code>uiop</code>、<code>uiop/common-lisp</code>を<code>use</code>しています。<a name="DOCF27" href="#FOOT27"><sup>27</sup></a>
<samp>.asd</samp>ファイル内で新しい変数・関数・クラスを定義するなど、単純なシステム定義にとどまらないことをする場合は、<code>defpackage</code>と<code>in-package</code>で別のパッケージを作り、<code>asdf-user</code>とは干渉しないようにするべきです。ただ、フォームを追加する目的が、（開発・デバッグのために）<code>cl:load</code>で手動で<samp>.asd</samp>ファイルをロードできるようにすることなのであれば<a name="DOCF28" href="#FOOT28"><sup>28</sup></a>、そうするよりも<code>asdf:load-asd</code>を使うことを推奨します。なお、SLIMEを使っている場合は、<code>slime-asdf</code>拡張をロードすれば、<samp>.asd</samp>ファイルの編集時に<code>asdf:load-asd</code>が適切に適用されるようになります。
</p>
<p>デフォルトでは<code>*system-definition-search-functions*</code>は３つの関数からなるリストです。最初の関数は、<code>*central-registry*</code>の要素を評価して得られた各ディレクトリから、ファイル名がシステム名であり、拡張子が<samp>.asd</samp>であるファイルを探し、最初に見つかったパス名を返します。ただし、探索対象のシステムがそのファイル内で実際に定義されているかどうかはチェックしません。２つ目の関数は同様のことを<code>source-registry</code>で指定されたディレクトリに対して行いますが、実際にファイルシステムを探すのは１回のみであり、結果はキャッシュされます。<a name="DOCF29" href="#FOOT29"><sup>29</sup></a> ３つ目の関数は<code>package-inferred-system</code>拡張で使われます。詳細は<a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a>を参照してください。
</p>
<p>システムの探索関数の仕様からもわかるように、システム<code>foo</code>は<samp>foo.asd</samp>という名のファイルに定義するべきであり、また、ファイルはセントラルレジストリかソースレジストリに指定されたディレクトリに置くようにするべきです。
</p>
<a name="System-names"></a><a name="index-System-names"></a>
<a name="index-Primary-system-name"></a>
<a name="index-primary_002dsystem_002dname"></a>
<a name="index-puraimarinemu"></a>
<a name="index-puraimarisisutemu"></a>
<p>１つのファイル内で複数のシステムを定義するのが便利なケースも良くあるでしょうが、ASDFはシステム名に基づいてシステム定義ファイルを探すことしかできません。この理由により、ASDF 3からはシステム定義を探すアルゴリズムが拡張され、ファイル<samp>foo.asd</samp>には、システム<code>foo</code>に加えて<code>foo/bar</code>、<code>foo/baz</code>、<code>foo/quux</code>といった名のシステムも定義できるようになりました。<code>/</code>で区切られたシステム名の最初の部分をシステムの<em>プライマリネーム(primary name)</em>と呼び、対応するシステムを<em>プライマリシステム(primary system)</em>と呼びます。ASDF 3は、名前にスラッシュを含むシステムを探すように指示されると、関数<code>asdf:primary-system-name</code>によってプライマリネームを抽出し、まずはプライマリシステムを探してロードしようとします。そして、見つかった場合は、そのファイルにターゲットのシステムが定義されているかどうか、もしくは<code>package-inferred-system</code>が定義されているかどうか調べます。<a name="DOCF30" href="#FOOT30"><sup>30</sup></a>
<samp>foo.asd</samp>に、この命名ルールに従わないシステム（例えば<code>foo-test</code>など）が定義されている場合、ASDFはシステム定義の場所を自動的に見つけることができないので、事前に<code>(asdf:find-system &quot;foo&quot;)</code>を実行するなどして、明示的にプライマリシステムの定義をロードしておかなければなりません。我々はそのような命名の慣習をやめることを強く推奨しますが、今のところ、後方互換性のためにサポートされてはいます。
</p></dd></dl>

<dl>
<dt><a name="index-primary_002dsystem_002dname-1"></a>関数: <strong>primary-system-name</strong> <em>name</em></dt>
<dd>
<p><var>name</var>がスラッシュ<code>/</code>によって区切られている場合、<code>primary-system-name</code>はプライマリネーム、つまり最初の部分を返します。
</p></dd></dl>

<dl>
<dt><a name="index-locate_002dsystem"></a>関数: <strong>locate-system</strong> <em>name</em></dt>
<dd>
<p>一般的には、この関数を直接呼び出す<em>べきではありません</em>。この関数がAPIの一部としてエクスポートされているのは、独自の<code>*system-definition-search-functions*</code>を使いたいプログラマのためです。
</p>
<p><code>locate-system</code>はシステム名の指示子を引数に取り、システム定義をどこからロードすれば良いか調べようとします。
</p>
<p>[訳者補足]
</p>
<p>この関数そのものはシステム定義をロードすることはない――と原文には書かれています。しかし現在のバージョンでは、プライマリネームが絡んでいるケースで、例えば<code>(asdf:locate-system :baz/test)</code>などとすると、<code>baz</code>と<code>baz/test</code>のシステム定義がロードされることがあるようです。いずれにせよ、システム定義のロードには<code>find-system</code>を、システムそのもののロードには<code>load-system</code>を使うべきです。
</p>
<p>[訳者補足終わり]
</p>
<p>この関数は６つの値を返します: <var>foundp</var>、<var>found-system</var>、<var>pathname</var>、
<var>previous</var>、<var>previous-time</var>、<var>previous-primary</var>。<var>foundp</var>はシステムが見つかれば（未登録であれ、登録済みであれ）真です。<var>found-system</var>が<code>nil</code>でない場合、システムオブジェクトです。（そのシステムは登録されているかもしれないし、されていないかもしれません。）
<var>pathname</var>が<code>nil</code>でない場合、システム定義ファイルのパス名であり、このパス名は<var>found-system</var>か<var>previous</var>のシステムと対応しているでしょう。<var>previous</var>が<code>nil</code>でない場合、<em>前回ロードされた</em>同名のシステムオブジェクトです。（なお、ここでロードされているのはシステム<em>定義</em>であって、システムそのものではないことに注意しましょう。）<var>previous-time</var>が<code>nil</code>でない場合、<var>previous</var>の定義が前回ロードされた際のシステム定義ファイルのタイムスタンプです。<var>previous-primary</var>が<code>nil</code>でない場合、システム<var>previous</var>のプライマリシステムです。
</p>
<p>例えば、ソースレジストリに登録されたパス<samp>/current/path/to/foo.asd</samp>にシステム定義ファイルがあるとしましょう。しかし、システム<code>foo</code>は前回は<samp>/previous/path/to/foo.asd</samp>からロードされたとします。このとき、<code>locate-system</code>は次の値を返すでしょう:
</p><ol>
<li> <var>foundp</var>は<code>t</code>です。
</li><li> <var>found-system</var>は<code>nil</code>です。
</li><li> <var>pathname</var>は<code>#p&quot;/current/path/to/foo.asd&quot;</code>です。
</li><li> <var>previous</var>は<code>system</code>オブジェクトであり、その<code>system-source-file</code>スロットは<code>#p&quot;/previous/path/to/foo.asd&quot;</code>です。
</li><li> <var>previous-time</var>は前回<code>#p&quot;/previous/path/to/foo.asd&quot;</code>がロードされたときのタイムスタンプです。
</li><li> <var>previous-primary</var>は<var>previous</var>と同じオブジェクトです。
</li></ol>
</dd></dl>

<dl>
<dt><a name="index-find_002dcomponent-1"></a>関数: <strong>find-component</strong> <em>base path</em></dt>
<dd>
<p><var>base</var>コンポーネント（あるいは指示子）と<var>path</var>を引数に取り、<var>base</var>を基点として<var>path</var>で指示されるコンポーネントを見つけます。
</p>
<p><var>path</var>がコンポーネントオブジェクトの場合は、<var>base</var>に関係なく、そのまま<var>path</var>が返ります。
</p>
<a name="index-coerce_002dname-1"></a>
<p><var>path</var>が文字列かシンボル（<code>coerce-name</code>で文字列に変換される）の場合、<var>base</var>はシステムかモジュールを指していなくてはなりません。この場合、返り値は<var>path</var>の指す<var>base</var>の子コンポーネントです。
</p>
<p><var>path</var>が<code>cons</code>セルの場合、<code>find-component</code>は<var>base</var>と<var>path</var>の<code>car</code>から再帰的に子コンポーネントを辿り、末端のコンポーネントを返します。
</p>

<p><var>base</var>が<code>nil</code>の場合、<code>(find-component <var>path</var> nil)</code>と同等になります。
</p>
<p><var>base</var>が文字列かシンボル（<code>coerce-name</code>で文字列に変換される）の場合、<var>base</var>は<code>find-system</code>の返すシステムであるとみなされます。
</p>
<p><var>base</var>が<code>cons</code>セルの場合、<var>base</var>は<code>(find-component (car <var>base</var>) (cdr <var>base</var>))</code>の返すコンポーネントであるとみなされます。
</p></dd></dl>



<hr>
<a name="g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027"></a>
<a name="konponentonoGong-Tong-noShu-Xing-"></a>
<h4 class="subsection">7.2.1 コンポーネントの共通の属性</h4>

<p>すべてのコンポーネントはその型にかかわらず、次の属性(attribute)を持っています。コンポーネント名以外の属性は任意です。
</p>
<a name="konponentoMing-"></a>
<h4 class="subsubsection">7.2.1.1 コンポーネント名</h4>
<a name="index-coerce_002dname-2"></a>
<p>コンポーネント名(component name)は文字列またはシンボルであり、シンボルは<code>asdf:coerce-name</code>によって小文字の文字列に変換されます。コンポーネント名には総称関数<code>component-name</code>でアクセスできます。
</p>
<p><code>:pathname</code>属性を上書きしない限り、コンポーネント名はUNIXスタイルの相対パスとしてそのままパス名指定子に使われるでしょう。（→ <a href="#g_t_30d1_30b9_540d_6307_5b9a_5b50">パス名指定子</a>）
</p>
<a name="baziyonShi-Bie-Zi-_0028_003aversion_0029"></a>
<h4 class="subsubsection">7.2.1.2 バージョン識別子（<code>:version</code>）</h4>
<a name="index-version_002dsatisfies"></a>
<a name="index-_003aversion-2"></a>

<p>この属性は任意であり、コンポーネントのバージョンを指定します。バージョンは、一般的にはドットで区切られた整数の文字列で、例えば&lsquo;<samp>1.0.11</samp>&rsquo;などです。（→ <a href="#g_t_30d0_30fc_30b8_30e7_30f3_6307_5b9a_5b50">バージョン指定子</a>） コンポーネントのバージョンには総称関数<code>component-version</code>でアクセスできます。
</p>

<p>ASDFが、<code>:depends-on</code>で指定された依存コンポーネントの<code>:version</code>オプションについて調べる時に、コンポーネントのバージョンを<code>version-satisfies</code>で問い合わせるかもしれません。例えばシステム定義に<code>:depends-on (((:version &quot;mydepname&quot; &quot;1.0.11&quot;))</code>という記述がある時は、<code>mydepname</code>コンポーネントのバージョンが<code>1.0.11</code>以上であるかどうか確認されることになります。<code>:version</code>オプションについては<a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>を、<code>version-satisfies</code>関数については<a href="#g_t_95a2_9023_3059_308b_95a2_6570">関連する関数</a>を参照してください。
</p>
<p>一般的には、バージョン番号が問題になるのは<code>system</code>型のコンポーネントだけであることに注意してください。ライブラリの作者が、システムに含まれる様々なファイルにバージョン番号を付けて自ら同期させるというような使い方は、おそらくまったく有用ではないでしょう。
</p>
<a name="Bi-Yao-nahuitiya_0028_003aif_002dfeature_0029"></a>
<h4 class="subsubsection">7.2.1.3 必要なフィーチャー（<code>:if-feature</code>）</h4>
<a name="g_t_5fc5_8981_306a_30d5_30a3_30fc_30c1_30e3_30fc"></a>
<p><code>defsystem</code>内で処理系に応じてファイルを含めたり除外したりする時は、伝統的にはリーダーマクロ<code>#+</code>が使われていました。例えばポータブルなCのFFIであるCFFIには、システム定義に次のような一行があります:
</p><div class="lisp">
<pre class="lisp">     #+sbcl       (:file &quot;cffi-sbcl&quot;)
</pre></div>
<p>しかしこの方法には、どの処理系もシステム全体を読み込むことができないという欠点があります。例えば、新しく<code>archive-op</code>というオペレーションを作り、システムのすべてのソースファイルをまとめたアーカイブを作ろうとしたとしましょう。この時、上の例の<samp>cffi-sbcl.lisp</samp>はSBCL以外の処理系では不可視であり、<code>archive-op</code>を実行してもアーカイブに収集されないという問題が起きます。
</p>
<p>この問題を解決するため、ASDF 3からコンポーネントに<code>:if-feature</code>オプションが導入されました。このオプションの値はフィーチャー表現であり、つまり、<code>#+</code>と同じ文法を使います。フィーチャー表現が満たされないとき、そのコンポーネントはコンパイル、ロード、リンクの際に無視されます。なお、「同じ文法」と述べましたが、このフィーチャー表現は標準のリーダーで読まれるので、シンボルを使う際には<code>:</code>を前置して明示的にキーワードにしなくてはなりません。<code>#+</code>に続くフィーチャー表現は暗黙にキーワードパッケージを使いますから、その点は異なることになります。
</p>
<p>例えば<code>(:file &quot;foo-sbcl&quot; :if-feature (:and :x86 (:or :sbcl :cmu :scl)))</code>という記述は、x86マシン上のSBCL、CMUCL、Scieneer CLにおいてのみ、<samp>foo-sbcl.lisp</samp>のコンパイル、ロードがなされるという意味です。先に述べた通り、<code>(:file &quot;foo-sbcl&quot; :if-feature (and x86 (or sbcl cmu scl)))</code>と書くことはできません。
</p>
<p>→ <a href="#if_002dfeature_30aa_30d7_30b7_30e7_30f3">if-featureオプション</a>
</p>
<a name="akusiyonnoYi-Cun-Guan-Xi-_0028_003ain_002dorder_002dto_0029"></a>
<h4 class="subsubsection">7.2.1.4 アクションの依存関係（<code>:in-order-to</code>）</h4>
<a name="g_t_30a2_30af_30b7_30e7_30f3_306e_4f9d_5b58_95a2_4fc2"></a>
<p>この属性には、当該コンポーネントに関するアクションが別のアクションに依存していることを記述します。任意の属性ですが、しばしば必要になります。
</p>


<p>依存関係はオペレーションとコンポーネントのペアについて指定します。例えば次のように記述したとしましょう:
</p>
<div class="lisp">
<pre class="lisp">:in-order-to ((compile-op (load-op &quot;a&quot; &quot;b&quot;) (compile-op &quot;c&quot;))
              (load-op (load-op &quot;foo&quot;)))
</pre></div>

<p>このとき、このコンポーネントに対して<code>compile-op</code>を実行する前に、ASDFは<code>a</code>と<code>b</code>に対して<code>load-op</code>を実行し、さらに<code>c</code>に対して<code>compile-op</code>を実行しなければなりません。また、<code>load-op</code>を実行する前に、<code>foo</code>がロードされていなければなりません。
</p>
<p>文法はおおむね次のようになります。
</p>
<div class="example">
<pre class="example">(this-op {(other-op required-components)}+)
                
required-components := component-name
                     | (required-components required-components)

component-name := simple-component-name
                | (:version simple-component-name minimum-version-object)
                
simple-component-name := string
                      |  symbol
</pre></div>

<p>[付記]
</p>
<p>これはACLのdefsystemと同等の機能です。mk-defsystemはやや一般性に欠けていて、次のような暗黙の依存関係
</p>
<pre class="verbatim">  すべてのソースファイルxについて、(load x)は(compile x)に依存する
</pre>
<p>を導入していました。<code>:depends-on</code>引数で<var>b</var>が<var>a</var>に依存すると指定したとき、それが<em>実際</em>に意味しているのは
</p>
<pre class="verbatim">  (compile b)は(load a)に依存する
</pre>
<p>ことだったのです。しかし、これは不十分な機能でした。McCLIMのように、何らかのファイルがコンパイルされる前に、まずはすべてロードされなければならないようなシステムを記述できなかったのです。
</p>
<p>[付記終わり]
</p>
<p>ASDFでは、与えられたアクションがどのアクションに依存しているかを<code>(component-depends-on operation component)</code>で問い合わせることができます。このフォームが返すリストは
</p>
<div class="lisp">
<pre class="lisp">((load-op &quot;a&quot; &quot;b&quot;) (compile-op &quot;c&quot;) (load-op &quot;d&quot;) ...)
</pre></div>

<p>のような形式です。
<code>component-depends-on</code>メソッドは、特定のコンポーネント・オペレーションのクラスについて定義することも可能です。その際、（デフォルトの依存関係を完全に上書きしたいのでなければ）自分のメソッドの結果と<code>(call-next-method)</code>の返り値を<code>append</code>して返す必要があります。
</p>
<p>この結合は、CLISPのことを考えなければ、メソッドコンビネーションの<code>list</code>を使って透過的に実現できるでしょうが、我々はCLISPもサポートする必要があるので、この仕様を使っていません。あなたにCLISPをハックする時間があれば、この部分の修正はきっと歓迎されることでしょう。
</p>
<p>コンポーネント（通常はシステム）に特定のバージョン以降を要求したい場合は、ここでも<code>:version</code>オプションが使えます。この場合、<code>:in-order-to ((load-op (load-op &quot;other-system'')))</code>の代わりに<code>:in-order-to ((load-op (load-op (:version &quot;other-system&quot; &quot;1.2.3&quot;))))</code>などと記述することになるでしょう。
</p>


<a name="pasuMing-_0028_003apathname_0029"></a>
<h4 class="subsubsection">7.2.1.5 パス名（<code>:pathname</code>）</h4>

<p>この属性の指定は任意であり、たいていは省略されるでしょう。その場合、コンポーネント名が（相対パスとして）使われます。
</p>
<p>パス名がどのように解釈されるかについては、<a href="#g_t_30d1_30b9_540d_6307_5b9a_5b50">パス名指定子</a>を参照してください。
</p>
<p>また、「トップレベル」のシステムを定義する<code>defsystem</code>マクロは、システム直下のコンポーネントがファイルシステム上のどこにあるか決めるために、追加の処理をします。詳しくは<a href="#defsystem_3067_30b7_30b9_30c6_30e0_3092_5b9a_7fa9_3059_308b">defsystemでシステムを定義する</a>を参照してください。
</p>

<dl>
<dt><a name="index-component_002dpathname"></a>総称関数: <strong>component-pathname</strong> <em>component</em></dt>
<dd><p><var>component</var>に対応するパス名を返します。ソースファイルのようなコンポーネントに対しては、ファイルのパス名を返すでしょう。以下に例を挙げます:
</p>
<div class="lisp">
<pre class="lisp">CL-USER&gt; (asdf:component-pathname (asdf:find-system &quot;xmls&quot;))
#P&quot;/Users/rpg/lisp/xmls/&quot;
</pre></div>


<div class="lisp">
<pre class="lisp">CL-USER&gt; (asdf:component-pathname
           (asdf:find-component
              (asdf:find-system &quot;xmls&quot;) &quot;xmls&quot;))
#P&quot;/Users/rpg/lisp/xmls/xmls.lisp&quot;
</pre></div>
</dd></dl>



<a name="puropatei_0028_003aproperties_0029"></a>
<h4 class="subsubsection">7.2.1.6 プロパティ（<code>:properties</code>）</h4>

<p>この属性は任意です。
</p>
<p>[訳者補足]
</p>
<p>この属性は廃止予定であり、ASDF 2との後方互換性のためだけに存在します。また、その名に反して、<code>:properties</code>オプションにはプロパティリストではなく連想リストを指定します。昔のASDFでは独自の属性が必要な時に<code>component-property</code>で読み書きしていた、という点だけ知っていれば十分でしょう。
</p>
<p>[訳者補足終わり]
</p>

<p>システムをパッケージングするにあたって、ASDFの組み込みの属性に指定した情報に加えて、ファイルやシステムについての他の情報が必要になることはしばしばあります。ASDFシステムからベンダーのパッケージを作るプログラムは、これらのシステムを満たすために「プレースホルダ―」情報を作る必要があります。ASDFシステムを作る方は、その付加的な情報を直接読み書きすることがあるでしょう。
</p>
<p><code>(component-property component property-name)</code>は<code>setf</code>のプレースとしても使用可能で、この情報を読み書きすることができます。<var>property-name</var>の同一性は<code>eql</code>で判定されるので、シンボルやキーワード等を使いましょう。
</p>

<hr>
<a name="g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9"></a>
<a name="konponentonoZu-miIp-minosabukurasu"></a>
<h4 class="subsection">7.2.2 コンポーネントの組み込みのサブクラス</h4>

<dl>
<dt><a name="index-source_002dfile"></a>コンポーネント: <strong>source-file</strong></dt>
<dd>
<p>ソースファイルとは、システムの他のコンポーネントから生成する方法をシステムが知らないファイルを指します。
</p>
<p>これは一般的な意味でのソースファイル、つまり「コンパイラに渡すデータを含んだファイル」と必ずしも同じでないことに注意してください。何らかのプリプロッセンシグを経て生成されたファイル（例えば<samp>.h.in</samp>からautoconfによって生成された<samp>.h</samp>ファイルなど）は、定義上、ソースファイルとは呼ばれないことになります。逆に、（毎回自動生成されない）画像ファイルや、バイナリとして得られるプロプライエタリな共有ライブラリなどは、我々の目的においてはソースファイルとみなすことになります。
</p>
<p>さまざまな言語に対して<code>source-file</code>のサブクラスが存在します。
</p>
<p>[訳者補足]
</p>
<dl>
<dt><a name="index-cl_002dsource_002dfile"></a>コンポーネント: <strong>cl-source-file</strong></dt>
<dt><a name="index-c_002dsource_002dfile"></a>コンポーネント: <strong>c-source-file</strong></dt>
<dt><a name="index-java_002dsource_002dfile"></a>コンポーネント: <strong>java-source-file</strong></dt>
<dt><a name="index-static_002dfile"></a>コンポーネント: <strong>static-file</strong></dt>
<dt><a name="index-doc_002dfile"></a>コンポーネント: <strong>doc-file</strong></dt>
<dt><a name="index-html_002dfile"></a>コンポーネント: <strong>html-file</strong></dt>
<dd><p><code>cl-source-file</code>、<code>c-source-file</code>、<code>java-source-file</code>はそれぞれCL、C、Javaのソースファイルに対応し、ファイル形式は<samp>lisp</samp>、<samp>c</samp>、<samp>java</samp>です。<code>static-file</code>はビルドの際にそのまま出力されることを意図したファイルを表し、ファイル形式は不定です。<code>doc-file</code>は<code>static-file</code>のサブクラス、<code>html-file</code>は<code>doc-file</code>のサブクラスであり、<code>html-file</code>のファイル形式は<samp>html</samp>です。
</p>
<p><code>defsystem</code>フォームの<code>:components</code>オプションにコンポーネントを記述するとき、<code>:file</code>は既定では<code>cl-source-file</code>を意味します。このクラスは親コンポーネントの<code>:default-component-class</code>オプションで書き換えることができます。
</p></dd></dl>


<p>[訳者補足終わり]
</p>
</dd></dl>

<dl>
<dt><a name="index-module"></a>コンポーネント: <strong>module</strong></dt>
<dd>
<p>モジュールは、コンポーネントのまとまりとしてのコンポーネントです。
</p>
<p>モジュールコンポーネントには次の追加の属性が指定できます。
</p>
<ul>
<li> <code>:components</code> このモジュールに含まれるコンポーネント群です。

</li><li> <code>:default-component-class</code>
クラスが明示されていない子コンポーネントはこのクラスであるとみなされます。

</li><li> <code>:if-component-dep-fails</code>
この属性はASDF 3で削除されたので、使わないでください。代わりに<code>:if-feature</code>を使いましょう。（→ <a href="#g_t_5fc5_8981_306a_30d5_30a3_30fc_30c1_30e3_30fc">必要なフィーチャー</a> あるいは → <a href="#if_002dfeature_30aa_30d7_30b7_30e7_30f3">if-featureオプション</a>）

</li><li> <code>:serial</code>
この属性が真の場合、（<code>:components</code>に指定された）それぞれの子コンポーネントは、それ以前のすべての子コンポーネントに依存しているとみなされます。

</li></ul>

<p>デフォルトのオペレーションはモジュールをどのように走査すれば良いか知っているため、ほとんどのオペレーションにはモジュールに特定化されたメソッドを定義する必要はないでしょう。
</p>
<p>他の言語のライブラリ群やアーカイブファイルを表すのに、<code>module</code>のサブクラスを定義することもできるでしょう。
</p></dd></dl>

<dl>
<dt><a name="index-system-1"></a>コンポーネント: <strong>system</strong></dt>
<dd>
<p>システムはモジュールのサブクラスです。
</p>
<p>システムは、主にドキュメントを付けるためにいくつかの属性を追加されたモジュールです。詳細は<a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>を参照してください。
</p>
<p>ユーザーは自分のシステムのために自ら新しいクラスを定義することもできます。定義したクラスは<code>defsystem</code>マクロの<code>:class</code>オプションに指定することで使えます。
</p></dd></dl>

<hr>
<a name="g_t_65b0_3057_3044_30b3_30f3_30dd_30fc_30cd_30f3_30c8_578b_3092_5b9a_7fa9_3059_308b"></a>
<a name="Xin-siikonponentoXing-woDing-Yi-suru"></a>
<h4 class="subsection">7.2.3 新しいコンポーネント型を定義する</h4>

<p>新しいコンポーネント型を作るには、既存のコンポーネントのサブクラスを作り、新しいクラスに特定化されたメソッドを定義します。
</p>

<p>例を見てみましょう。あなたのシステムは処理系依存の機能をいくつか備えています。あなたは、それらのソースファイルを１つの（サポートする）Lisp処理系ごとに１つのサブディレクトリに隔離したいと考えました。まずは<code>cl-source-file</code>のサブクラスを定義しましょう。
</p>
<div class="lisp">
<pre class="lisp">(defclass unportable-cl-source-file (cl-source-file)
  ()
  (:documentation &quot;処理系依存のLispソースファイル&quot;))
</pre></div>

<p>サブディレクトリの名前は、<code>asdf:implementation-type</code>（バージョン2.014.14以降でエクスポートされています）の返り値を使うことにします。あとは、<code>unportable-cl-source-file</code>のパス名を推論する仕組みを加えるだけです。
</p>
<div class="lisp">
<pre class="lisp">(defmethod component-pathname ((component unportable-cl-source-file))
  (merge-pathnames*
    (parse-unix-namestring (format nil &quot;~(~A~)/&quot; (asdf:implementation-type)))
    (call-next-method)))
</pre></div>

<p>これで完了です。新しいコンポーネント型は、<code>defsystem</code>フォーム中で次のように使われます:
</p>
<div class="lisp">
<pre class="lisp">(defsystem :foo
    :components
    ((:file &quot;packages&quot;)
     ...
     (:unportable-cl-source-file &quot;threads&quot;
      :depends-on (&quot;packages&quot; ...))
     ...
    ))
</pre></div>

<hr>
<a name="g_t_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066"></a>
<a name="Yi-Cun-Guan-Xi-nituite"></a>
<h3 class="section">7.3 依存関係について</h3>

<p>ビルドを成功させるためには、アクションのグラフが循環的であってはなりません。あなたが（ASDFの純粋なユーザーであれ、拡張を実装しているのであれ）依存関係のグラフにループを含めてしまうと、ASDFは盛大なエラーを引き起こすでしょう。依存の向きを明確にするため、ASDF 3では、アクションが他のアクションに依存していることを<em>requiring</em>、<em>required</em>という言葉で表しています。つまり&ldquo;requiring action&rdquo;は、それ自身が<code>perform</code>される前に、そのすべての&ldquo;required action&rdquo;が完了することに依存（<code>depends-on</code>）しているわけです。
</p>
<p><code>defsystem</code>の文法を使うと、ユーザーはオブジェクトの階層グラフに沿った直接の依存関係（コンポーネントとその親コンポーネント、子コンポーネント、兄弟コンポーネント<a name="DOCF31" href="#FOOT31"><sup>31</sup></a>）を簡単に書くことができますし、CLOSメソッドをカスタマイズすることでさらに複雑な依存関係を表現することも可能です。もっとも一般的なオペレーションである<code>load-op</code>、<code>compile-op</code>、<code>load-source-op</code>などはコンポーネントの階層を「下向き」に伝搬し、「共変的」に振る舞います。つまり、親コンポーネントに対するオペレーションを行う前に、まずはすべての子コンポーネントに対して同じオペレーションを行わなくてはならないわけです。いっぽう、<code>prepare-op</code>や（ASDF 3で導入された）<code>prepare-souce-op</code>のようなオペレーションは、コンポーネントの階層を「上向き」に伝搬し、「反変的」に振る舞います。つまり、子コンポーネントに対するコンパイルを準備するオペレーションを行う前に、まずは親コンポーネントに対して同じオペレーションを行わなくてはならず、そのような挙動によって、子コンポーネントがコンパイル・ロードされる前に、親コンポーネントの依存関係がすべて（コンパイル、）ロードされることが保証されるわけです。最後に、<code>test-op</code>や<code>load-bundle-op</code>はターゲットのシステムのレベルにとどまるオペレーションであり、階層を伝搬していくことはありません。これらはシステムに対してグローバルな処理を行うのです。
</p>
<p>[訳者補足]
</p>
<p>このセクションはオペレーションの依存関係について述べたものですが、実践的には、<a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a>の補足に挙げた５つのオペレーションについて理解していれば事足りるでしょう。つまり、
</p><ul>
<li> <code>load-op</code>、<code>compile-op</code>、<code>load-source-op</code>は<code>downward-operation</code>（かつ<code>selfward-operation</code>）であり、
</li><li> <code>prepare-op</code>、<code>prepare-source-op</code>は<code>upward-operation</code>（かつ<code>sideway-operation</code>）であり、
</li><li> <code>test-op</code>、<code>load-bundle-op</code>は<code>selfward-operation</code>です。
</li></ul>


<p>[訳者補足終わり]
</p>


<hr>
<a name="g_t_95a2_9023_3059_308b_95a2_6570"></a>
<a name="Guan-Lian-suruGuan-Shu-"></a>
<h3 class="section">7.4 関連する関数</h3>

<dl>
<dt><a name="index-version_002dsatisfies-1"></a>総称関数: <strong>version-satisfies</strong> <em><var>version</var> <var>version-spec</var></em></dt>
<dd><p><var>version</var>が<var>version-spec</var>を満たすか判定する総称関数です。組み込みのメソッドとしては、<var>version</var>が<code>component</code>のものと文字列のものが用意されており、<code>component</code>の場合はそのバージョン文字列が使われます。いっぽう、<var>version-spec</var>は文字列であるべきです。
</p>
<p><var>version</var>が<var>version-spec</var>を満たしているとは、<var>version-spec</var>と同じか新しいバージョンであることです。したがって、<code>&quot;1.9.1&quot;</code>、<code>&quot;1.9.2&quot;</code>、<code>&quot;1.10&quot;</code>はすべて<code>&quot;1.9.1&quot;</code>を満たしますが、<code>&quot;1.8.4&quot;</code>や<code>&quot;1.9&quot;</code>は満たしません。<code>version-satisfies</code>がバージョンの文字列をどのようにパースし、解釈するかについては、<a href="#g_t_30d0_30fc_30b8_30e7_30f3_6307_5b9a_5b50">バージョン指定子</a>と<a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a>を参照してください。
</p>
<p>ASDF 3.0.1以前（ASDF 1、2を含む）では、<code>version-satisfies</code>は<var>version</var>と<var>version-spec</var>が同じメジャーバージョン番号（１番目の整数）であることも必要条件にしていました。メジャーバージョンが違う場合は<var>version-spec</var>を満たさないとみなされたのです。しかし、この挙動はドキュメントには書かれておらず、おそらく仕様として依拠することはできなかったし、一部のユーザーにとっては悩みの種でした。ASDF 3.0.1から、<code>version-satisfies</code>はメジャーバージョンを特別扱いしなくなり、単にバージョンが同じか新しければ<code>t</code>を返すようになりました。
</p>
<p>なお、バージョン指定付きの依存関係を表す<code>(:version ...)</code>構文<a name="DOCF32" href="#FOOT32"><sup>32</sup></a>は現在は特定のバージョン「以上」という指定しかできませんが、将来的には「未満」も指定できるようになるかもしれません。
</p></dd></dl>

<hr>
<a name="ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b"></a>
<a name="ASDFgasisutemuwoTan-suChang-Suo-woShe-Ding-suru"></a>
<h2 class="chapter">8 ASDFがシステムを探す場所を設定する</h2>
<a name="index-sosurezisutori"></a>



<hr>
<a name="g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_8a2d_5b9a"></a>
<a name="sosurezisutorinoShe-Ding-"></a>
<h3 class="section">8.1 ソースレジストリの設定</h3>

<p>ASDFがシステム定義ファイルを探す場所は、<em>ソースレジストリ(source registry)</em>に指定されています。
</p>
<p>[訳者補足]
</p>
<p>ソースレジストリ（や次章で解説するアウトプットトランスレーション）の設定を記述したファイルは、<em>システム設定ファイル(system configuration file)</em>または単に<em>設定ファイル(configuration file)</em>と呼ばれます。ファイル形式は<samp>.conf</samp>です。システム定義ファイル（<samp>.asd</samp>ファイル）と混同しないようにしましょう。さらに、<em>設定ディレクトリ(configuration directory)</em>という概念もあります。設定ディレクトリは設定ファイルを含むディレクトリですが、設定ディレクトリ中の設定ファイルはその文法が微妙に異なるので注意が必要です。詳しくは<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a>と<a href="#g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">設定ディレクトリ（ソースレジストリ）</a>を参照してください。
</p>
<p>また、以下の記述は、OSや処理系、環境変数によって異なる複雑なロジックを漏れなく解説したものではありませんが、これを補完するのは訳者の手に余ります。正確な挙動を把握する必要がある場合は<samp>source-registry.lisp</samp>と<samp>uiop/configuration.lisp</samp>を参照してください。
</p>
<p>ソースレジストリは次のように設定されます。おおむね、上から順に処理されていくと考えてかまいません。
</p>
<p>[訳者補足終わり]
</p>

<ol>
<li> ソースレジストリには、ハードコーディングされた設定が加わることがあります。これは主に処理系（特にSBCL）自身が提供するシステムの場所を追加する処理で、処理系のバージョンによってパスが変わるのにも対応しています。

</li><li> アプリケーションは、ソースレジストリのAPIを使って明示的に設定を初期化することが許されており、その場合はその設定が優先されることになります。設定はコマンドラインからも行えますし、スクリプトファイルからも、あるいは独自のシステム設定ファイルからも行うことができます。（→ <a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a>）

</li><li> 環境変数<code>CL_SOURCE_REGISTRY</code>が存在する場合は、ソースレジストリがこの変数によって設定されます。

</li><li> 環境変数<code>XDG_CONFIG_DIRS</code>とユーザー設定ファイル<samp>$XDG_CONFIG_DIRS/common-lisp/source-registry.conf</samp>が存在する場合は、ソースレジストリがこのファイルによって設定されます。<code>XDG_CONFIG_DIRS</code>のデフォルトの値は<samp>~/.config/</samp>です。

</li><li> 環境変数<code>XDG_CONFIG_DIRS</code>とユーザー設定ディレクトリ<samp>$XDG_CONFIG_DIRS/common-lisp/source-registry.conf.d/</samp>が存在する場合は、ソースレジストリがこのディレクトリ内の設定ファイルによって設定されます。

</li><li> ソースレジストリには、既定のディレクトリである<samp>~/common-lisp/</samp>（ASDF 3.1.2以降のみ）、<samp>~/.sbcl/systems/</samp>（SBCLのみ）、<samp>$XDG_DATA_HOME/common-lisp/systems/</samp>（ただし、再帰的探索はしない）、<samp>$XDG_DATA_HOME/common-lisp/source/</samp>が加わります。<code>XDG_DATA_HOME</code>のデフォルトの値は<samp>~/.local/share/</samp>です。Windowsで環境変数<code>XDG_DATA_HOME</code>が存在しない場合は、代わりに<code>Local AppData</code>または<code>AppData</code>が使われます。

</li><li> 設定ファイル<samp>/etc/common-lisp/source-registry.conf</samp>が存在する場合、ソースレジストリがこのファイルによって設定されます。Unixのみの処理です。

</li><li> 設定ディレクトリ<samp>/etc/common-lisp/source-registry.conf.d/</samp>が存在する場合、ソースレジストリがこのディレクトリ内の設定ファイルによって設定されます。Unixのみの処理です。

</li><li> <samp>$XDG_DATA_DIRS/common-lisp/systems/</samp>と<samp>$XDG_DATA_DIRS/common-lisp/source/</samp>がソースレジストリに加わります。ただし、前者には再帰的探索がされないので、<samp>.asd</samp>ファイルへのリンクを置く目的で使います。Unixでは<code>XDG_DATA_DIRS</code>のデフォルトは<samp>/usr/local/share</samp>と<samp>/usr/share</samp>です。Windowsで<code>XDG_DATA_DIRS</code>が存在しない場合、代わりに<code>AppData</code>と<code>Common AppData</code>が使われるでしょう。

</li><li> ソースレジストリは、処理系提供の拡張モジュールに対応する処理系依存のディレクトリを含むことがあります。<a name="DOCF33" href="#FOOT33"><sup>33</sup></a>

</li></ol>

<p>これらの設定は、S式による簡単なDSLで記述します。（→ <a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a>） 加えて、環境変数で設定する場合は、よりシェルに向いた文法も用意されています。（→ <a href="#g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">シェル向けの設定の構文（ソースレジストリ）</a>）
</p>
<p>また、上に挙げた各設定は、必ずしもすべてが「結合」して使われるわけではありません。各設定が、継承する設定を明示的にあるいは暗黙にインクルードしない限り、以降の設定は無視されることになります。
</p>
<p>さらに、処理系依存のディレクトリが、設定ファイルで指定されたディレクトリ群の先頭に自動的に加わることがあり、これは設定ファイルで継承をどのように設定しても変えられません。（訳注: 上記リストの１番目の処理のこと）
</p>

<hr>
<a name="Truenames-and-other-dangers"></a>
<a name="Truenames-and-other-dangers-1"></a>
<h3 class="section">8.2 Truenames and other dangers</h3>

<p>初期のASDFが導入した偉大な革新の１つは、ソースコードの場所やビルドを行う場所を決めるのに<code>cl:truename</code>を活用したことでした。これによって（システム定義ファイルへの）シンボリックリンクを集めたディレクトリを管理の対象にできるようになりました。このメカニズムは単純ですが効果的であり、プログラムで扱うのが容易でした。ASDF 3は今なおこのスタイルをサポートしていますし、デフォルトで有効です。しかし我々は、以下で解説するソースレジストリの仕組みを代わりに使うことを推奨します。そちらのほうが特定のユーザー、処理系に依存しないポータブルな設定をするのが容易だからです。
</p>
<p>また、<code>truename</code>を嫌う人もいます。というのも、システムによっては<code>truename</code>はとても遅いし、また、いわゆる内容アドレス記憶装置(CAS, content-addressable storage)を使っている場合、ファイルの<code>truename</code>が指すのは個々のコンテンツのダイジェストであり、同じプロジェクト内の別のファイルではないからです。そこで、ASDF 3には<code>truename</code>を避ける方法も用意されています: <code>asdf:*resolve-symlinks*</code>に<code>nil</code>をセットしてください。
</p>

<p>PS: Vernor Vingeの短編 &ldquo;True Names... and Other Dangers&rdquo;（邦題: 『マイクロチップの魔術師』）を読んだことがない方は、きっと楽しめるでしょう。偉大なSFの古典です。
</p>
<hr>
<a name="XDG_30d9_30fc_30b9_30c7_30a3_30ec_30af_30c8_30ea"></a>
<a name="XDGbesudeirekutori"></a>
<h3 class="section">8.3 XDGベースディレクトリ</h3>

<p>設定ファイルやデータファイル、キャッシュファイルを保持する場所に関しては、我々はXDGベースディレクトリの仕様に従うことを目指しています。XDGの環境変数については、次のドキュメントを参照しています。
</p>
<p><a href="http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html">http://standards.freedesktop.org/basedir-spec/basedir-spec-latest.html</a>
</p>
<p>この規格は、ユーザーがアプリケーションをカスタマイズするための環境変数を規定しています。
</p>
<p>ASDF 3.1.5より、Windows上で（Cygwin不使用で）もXDGベースディレクトリの仕様に可能な限り従うようになりました。もっとも、この規格はWindowsアプリケーションの一般的な慣習に必ずしも適合するわけではありません。この際、Unixのパス<samp>~/.local</samp>、<samp>/usr/local</samp>、<samp>/usr</samp>は、おおむねWindows上で同等と考えられる<samp>Local AppData</samp>、<samp>AppData</samp>、<samp>Common AppData</samp>などに置き換えています。また、Windowsのレジストリに問い合わせるのは、大量のポータブルなCommon Lispコードにおいては不可能ですから、ASDF 3は（レジストリと同期していることを願って）対応する環境変数を使っています。詳細については<samp>uiop/configuration.lisp</samp>を参照してください。また、改善案があればぜひお願いします。
</p>
<hr>
<a name="g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09"></a>
<a name="Hou-Fang-Hu-Huan-Xing-notamenoJi-Neng-"></a>
<h3 class="section">8.4 後方互換性のための機能</h3>

<p>後方互換性のために、また、ハッカーに実用的なバックドアを提供するために、ASDF 3はセントラルレジストリという古い仕組みもサポートしています。ASDFは、ソースレジストリを探す<em>前</em>にまず<code>asdf:*central-registry*</code>に指定されたディレクトリから<samp>.asd</samp>ファイルを探します。
</p>
<p>この変数の使い方については<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_898b_3064_3051_3089_308c_308b_3088_3046_306b_8a2d_5b9a_3059_308b_ff08_53e4_3044_30b9_30bf_30a4_30eb_ff09">ASDFがシステムを見つけられるように設定する（古いスタイル）</a>を参照してください。
</p>
<p>デフォルトでは<code>asdf:*central-registry*</code>は空でしょう。
</p>
<p>つまり、この古い方法は、使わなければあなたには関係ありませんが、使う場合は新しい仕組みに優先することになります。
</p>
<hr>
<a name="g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL"></a>
<a name="sosurezisutoriwoShe-Ding-suruDSL"></a>
<h3 class="section">8.5 ソースレジストリを設定するDSL</h3>
<a name="index-_003ainherit_002dconfiguration-source-config-directive"></a>
<a name="index-inherit_002dconfiguration-source-config-directive"></a>
<a name="index-_003aignore_002dinvalid_002dentries-source-config-directive"></a>
<a name="index-ignore_002dinvalid_002dentries-source-config-directive"></a>
<a name="index-_003adirectory-source-config-directive"></a>
<a name="index-directory-source-config-directive"></a>
<a name="index-_003atree-source-config-directive"></a>
<a name="index-tree-source-config-directive"></a>
<a name="index-_003aexclude-source-config-directive"></a>
<a name="index-exclude-source-config-directive"></a>
<a name="index-_003aalso_002dexclude-source-config-directive"></a>
<a name="index-also_002dexclude-source-config-directive"></a>
<a name="index-_003ainclude-source-config-directive"></a>
<a name="index-include-source-config-directive"></a>
<a name="index-_003adefault_002dregistry-source-config-directive"></a>
<a name="index-default_002dregistry-source-config-directive"></a>

<p>ソースレジストリの設定は、S式によるDSLで行います。以下はその文法です:
</p>

<div class="example">
<pre class="example">;; 設定の１単位は１つのS式であり、S式はキーワード:source-registryから
;; 始まって１つ以上のディレクティブが続きます。
CONFIGURATION := (:source-registry DIRECTIVE ...)

;; ディレクティブは次のいずれかです:
DIRECTIVE :=
    ;; 継承ディレクティブ:
    ;; CONFIGURATIONは<em>必ず</em>次の２つのディレクティブのいずれかを含ま
    ;; なければなりません。
    :inherit-configuration |
    ;; 継承した設定をその位置に挿入するディレクティブで、多くの場合、
    ;; 最後に指定されます。<a name="DOCF34" href="#FOOT34">(34)</a>
    :ignore-inherited-configuration |
    ;; 継承した設定を除外します。どこに指定してもかまいません。

    ;; 前方互換性のためのディレクティブ（ASDF 2.011.4）以降です。新し
    ;; い設定機能を使いたいが、その機能をサポートしていない古いASDFか
    ;; ら新しいASDFをブートストラップして使っているという場合には、こ
    ;; のディレクティブが必要でしょう。
    :ignore-invalid-entries |

    ;; １つのディレクトリを探索の対象に加えます。（ただし再帰的探索はしない）
    (:directory DIRECTORY-PATHNAME-DESIGNATOR) |

    ;; １つのディレクトリ階層を再帰的探索の対象に加えます。
    ;; 除外するパターンは下述のディレクティブで指定できます。
    (:tree DIRECTORY-PATHNAME-DESIGNATOR) |

    ;; デフォルトの除外パターンを上書きします。
    (:exclude EXCLUSION-PATTERN ...) |
    ;; デフォルトの除外パターンに追加します。
    (:also-exclude EXCLUSION-PATTERN ...) |
    ;; 除外パターンが適用されるスコープはその設定（もしくはファイル）
    ;; の残りの部分です。

    ;; 別の設定ファイルの内容をパースして、この位置に挿入します。
    (:include REGULAR-FILE-PATHNAME-DESIGNATOR) |

    ;; デフォルトのレジストリをこの位置に挿入します。<a name="DOCF35" href="#FOOT35">(35)</a>
    :default-registry

REGULAR-FILE-PATHNAME-DESIGNATOR
    := PATHNAME-DESIGNATOR ; ファイル名として解釈されます
DIRECTORY-PATHNAME-DESIGNATOR
    := PATHNAME-DESIGNATOR ; ディレクトリ名として解釈されます

PATHNAME-DESIGNATOR :=
    NIL | ; このエントリをスキップします
    ABSOLUTE-COMPONENT-DESIGNATOR ; パス名のDSLを参照（下述）

EXCLUSION-PATTERN := ワイルドカードを含まない文字列です。あるサブディ
レクトリの名前とこの文字列が正確に一致する場合、そのパス名は除外されま
す。例えば<code>&quot;_darcs&quot;</code>は<samp>#p&quot;/foo/bar/_darcs/src/bar.asd&quot;</samp>にマッチする
でしょう。
</pre></div>

<p>パス名は別のDSLで指定されます。このDSLは<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>の設定と共通であり、<code>asdf:resolve-location</code>によって解決されます。この関数はまだドキュメント化されていません。
</p>
<div class="example">
<pre class="example">ABSOLUTE-COMPONENT-DESIGNATOR :=
    (ABSOLUTE-COMPONENT-DESIGNATOR RELATIVE-COMPONENT-DESIGNATOR ...) |
    STRING |
    ;; 文字列は<a href="http://clhs.lisp.se/Body/26_glo_n.htm#namestring">ネームストリング</a>（絶対パスを推奨、ディレクトリが必要な
    ;; 箇所ではディレクトリと判断される）です。アウトプットトランスレー
    ;; ションにおいては、常にディレクトリと判断され、最後に**/*.*.*が
    ;; 加わります。MCLではMacOS XスタイルのPOSIXネームストリングが使わ
    ;; れます。（MacOS 9のスタイルが必要であれば、リテラル#p&quot;...&quot;を使
    ;; いましょう。）
    ;; なお、この文字列は*central-registry*で使われる文字列とは異なる
    ;; ことに注意してください。セントラルレジストリはこのDSLを使ってお
    ;; らず、普通のネームストリングとして処理されます。しかし、
    ;; asdf:resolve-locationを呼べば、*central-regisrry*で使えるオブジェ
    ;; クトは得られます:
    ;; (asdf:resolve-location &quot;/Users/fare/cl/cl-foo/&quot;)
    PATHNAME |
    ;; パス名は絶対パスを推奨します。アウトプットトランスレーションに
    ;; おいては（その後にRELATIVE-COMPONENT-DESIGNATORが続かない限り）
    ;; **/*.*.*のようなワイルドカードを含めたほうがよいでしょう。
    :HOME | ; user-homedir-pathname、つまり~/を指します
    :USER-CACHE | ; ユーザーキャッシュの既定の場所を探します<a name="DOCF36" href="#FOOT36">(36)</a>
    :HERE |
    ;; 設定ファイルのあるディレクトリを指します。（対話的に呼び出され
    ;; た場合は*default-pathname-defaults*です。）
    :ROOT
    ;; アウトプットトランスレーションでのみ使われます。入力指示子では
    ;; すべてのホストとデバイスにマッチし、出力指示子では入力パスのホ
    ;; ストとデバイス（のルート）を表します。

キーワード:SYSTEM-CACHEはASDF 3.1以降では受け付けません。セキュリティ
上の問題を引き起こすためです。

RELATIVE-COMPONENT-DESIGNATOR :=
    (RELATIVE-COMPONENT-DESIGNATOR RELATIVE-COMPONENT-DESIGNATOR ...) |
    STRING |
      ;; parse-unix-namestringで解釈される相対パスです。アウトプットト
      ;; ランスレーションにおいては、最後のコンポーネントに**/*.*.*が
      ;; 加わります。
    PATHNAME | ; 末尾にある場合を除いて、ディレクトリと判断されます。
    :IMPLEMENTATION |
      ;; implementation-identifierに基づくディレクトリです。
      ;; 例えばsbcl-1.0.45-linux-x64/など。
    :IMPLEMENTATION-TYPE |
      ;; lisp-implementation-typeに基づくディレクトリです。例えばsbcl/など。
    :*/ | ; 直下のすべてのサブディレクトリです。（ASDF 2.011.4以降）
    :**/ | ; 再帰的に辿れるすべてのサブディレクトリです。（ASDF 2.011.4以降）
    :*.*.* ; すべてのファイルです。（ASDF 2.011.4以降）

キーワード:UID、:USERNAME、:DEFAULT-DIRECTORYは今ではサポートされていません。
</pre></div>

<p>単純な例を挙げてみましょう。<samp>~/.config/common-lisp/source-registry.conf</samp>は、ASDFが設定ファイルを探す既定のパスです。このファイルの内容が
</p><div class="lisp">
<pre class="lisp">(:source-registry
  (:tree (:home &quot;cl&quot;))
  :inherit-configuration)
</pre></div>
<p>であれば、ソースレジストリに<samp>~/cl/</samp>が加わり、ASDFがシステム定義ファイルを見つける際には、このディレクトリ以下が再帰的に探索されることになります。
</p>
<hr>
<a name="g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09"></a>
<a name="She-Ding-deirekutori"></a>
<h3 class="section">8.6 設定ディレクトリ</h3>

<p>設定ディレクトリ内の<samp>.conf</samp>ファイルのDSLは、<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a>と少し<em>異なります</em>。まず、ディレクティブを<code>(:source-registry ...)</code>で囲む必要はありません。また、継承ディレクティブ<code>:inherit-configuration</code>、<code>:ignore-inherited-configuration</code>は使えず、ディレクティブのリストの<em>末尾</em>に暗黙に<code>:inherit-configuration</code>が加わります。これらに反した設定ファイルを読み込むと、ASDFは<code>uiop:invalid-configuration</code>エラーを通知するでしょう。なお、ディレクトリ中の設定ファイルは、そのネームストリングに従って<code>string&lt;</code>の順で読み込まれ、ディレクティブもこの順番で結合されます。
</p>
<p>Common Lispソフトウェアのディストリビューションは、自身の設定ファイル（例えば<samp>10-foo.conf</samp>）を設置する際、すべてのユーザーに対する設定は<samp>/etc/common-lisp/source-registry.conf.d/10-foo.conf</samp>を、ユーザー単位の設定は<samp>~/.config/common-lisp/source-registry.conf.d/10-foo.conf</samp>を使うことができます。そうすれば、インストールされるソフトウェアの設定情報を、容易かつモジュール化された形で登録できるでしょう。例えばDebianのパッケージや、将来のバージョンの<code>clbuild</code>がそうなることでしょう。<a name="DOCF37" href="#FOOT37"><sup>37</sup></a>
</p>
<p>設定ディレクトリ内の設定ファイル名は、上で挙げたように２つの数字から始めるのが慣習です。こうすることで、設定が読み込まれる順番を決めることができます。また、ファイル形式は<samp>.conf</samp>でなければなりません。この仕様のメリットは、単に実装が簡単であるだけでなく、設定ファイルを無効にするにはただファイル形式を変えればよい、という点にもあります。
</p>
<p>設定ファイル内で別の設定ディレクトリをインクルードしたい場合は、ディレクトリのパス名か文字列を<code>:include</code>ディレクティブに指定してください:
</p>
<div class="lisp">
<pre class="lisp">	(:include &quot;/foo/bar/&quot;)
</pre></div>

<p>例として、前のセクションの<samp>~/.config/common-lisp/source-registry.conf</samp>と同じ設定を、設定ディレクトリで行ってみましょう。ファイル<samp>~/.config/common-lisp/source-registry.conf.d/33-home-fare-cl.conf</samp>を次の内容で作ります<a name="DOCF38" href="#FOOT38"><sup>38</sup></a>:
</p><div class="lisp">
<pre class="lisp">(:tree &quot;/home/fare/cl/&quot;)
</pre></div>


<hr>
<a name="g_t_003ahere_30c7_30a3_30ec_30af_30c6_30a3_30d6"></a>
<a name="g_t_003aheredeirekuteibu"></a>
<h4 class="subsection">8.6.1 <code>:here</code>ディレクティブ</h4>

<p><code>:here</code>ディレクティブは、いま処理されている設定ファイルのあるディレクトリを、絶対パスで指します。
</p>
<p><code>:here</code>ディレクティブは、複雑なシステムの配布を簡単にするために、また、リビジョン管理システムの下にあるプロジェクトを簡単に設定できるようにするために用意されています。我々のデザイン原則――プロジェクトの各参加者は各々だけがアクセスできる情報をすべて提供できるべきである――に従ってのことです。
</p>
<p>例えば、Xさんという人が、複雑なプロジェクトのソースコードリポジトリを設定し、マスターディレクトリを<samp>dir/</samp>にしたとしましょう。普通なら、ユーザーには次のディレクティブを加えてもらうことになるかもしれません。
</p><div class="lisp">
<pre class="lisp">   (:tree &quot;path/to/dir&quot;)
</pre></div>
<p>しかし、<samp>dir/</samp>以下には巨大なサブツリーがあって、Javaのソースコードやアイコンの画像など、多様なファイルが存在するとしたらどうでしょうか。ASDFのシステム定義ファイルがあるのは<samp>dir/src/lisp/</samp>と<samp>dir/extlib/lisp/</samp>以下のツリーだけで、探すべきなのもそこだけだとしましょう。
</p>
<p>この場合、Xさんは<samp>dir/</samp>に次のような<samp>asdf.conf</samp>ファイルを置くでしょう。
</p><div class="lisp">
<pre class="lisp">(:source-registry
   (:tree (:here &quot;src/lisp/&quot;))
   (:tree (:here &quot;extlib/lisp&quot;))
   (:directory (:here &quot;outlier/&quot;)))
</pre></div>

<p>こうすれば、Yさんがこのリポジトリのコピーをチェックアウトした時、自分の設定ファイルに
</p><div class="lisp">
<pre class="lisp">(:include &quot;/path/to/my/checkout/directory/asdf.conf&quot;)
</pre></div>
<p>の１行を加えるだけで済みます。あるいは、
</p><div class="lisp">
<pre class="lisp">(asdf:initialize-source-registry
  '(:source-registry
     (:include &quot;/path/to/my/checkout/directory/asdf.conf&quot;)
     :inherit-configuration))
</pre></div>
<p>をREPLで実行してもかまいません。ASDFはXさんが提供した<samp>asdf.conf</samp>ファイルを見つけて、その内容通りにソースの場所を（<samp>dir/</samp>を基点にした相対パスを解釈して）設定するでしょう。
</p>
<hr>
<a name="g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09"></a>
<a name="sieruXiang-kenoShe-Ding-noGou-Wen"></a>
<h3 class="section">8.7 シェル向けの設定の構文</h3>

<p>環境変数<code>CL_SOURCE_REGISTRY</code>が空の文字列の時、ASDFはこの設定をスキップします。また、<code>(</code>から始まる場合は、先に述べたDSLによるS式と解釈し、全体に<code>read</code>を適用します。しかし、それ以外の場合は別の構文によるパスのリストとみなします。この構文は以下の通りで、<code>TEXINPUTS</code>のスタイルに似ています。
</p>
<ul>
<li> Unix（Cygwin含む）上ではエントリの区切りは<code>:</code>であり、それ以外（主にWindows）では<code>;</code>です。

</li><li> 各エントリはシステムの探索パスに追加されるディレクトリです。<code>:directory</code>ディレクティブと同等であり、再帰的探索はしません。

</li><li> エントリの末尾が<code>//</code>の場合は、再帰的探索の対象になります。<code>:tree</code>ディレクティブと同等です。

</li><li> 空のエントリ（２回以上現れても問題ありません）は継承した設定がその部分に挿入されることを示します。<a name="DOCF39" href="#FOOT39"><sup>39</sup></a>
</li></ul>

<hr>
<a name="g_t_63a2_7d22_30a2_30eb_30b4_30ea_30ba_30e0"></a>
<a name="Tan-Suo-arugorizumu"></a>
<h3 class="section">8.8 探索アルゴリズム</h3>
<a name="index-_002adefault_002dsource_002dregistry_002dexclusions_002a"></a>

<p>念のため説明しておくと、与えられたシステム名を持つシステムを探すとき、ディレクティブは順番に処理されていきます。
</p>
<p>ディレクトリ（<code>:directory</code>）を探索する場合、システムが見つかれば探索は成功であり、見つからなければ次の探索に進みます。
</p>
<p>ツリー（<code>:tree</code>）を探索する場合、システムがただ１つ見つかれば探索は成功です。複数のシステムが見つかった時の動作はバージョンによって異なりますが、ASDF 3.2.1以降では、パス名の（ノーマライズされた）ディレクトリコンポーネント<a name="DOCF40" href="#FOOT40"><sup>40</sup></a>の長さを比較し、短いほうが探索結果として採用されるようになりました。長さが同じ場合は、パス名の<code>unix-namestring</code>を<code>string&lt;</code>で比較して小さいほうが採用されます。それ以前のASDFでは最初に見つかったシステムを返していましたが、どのシステムが返るかは処理系によって異なり、上の仕様のように<code>string&lt;</code>に関して小さいパス名が返るかどうかも不確定でした。また、XCVB<a name="DOCF41" href="#FOOT41"><sup>41</sup></a>ではエラーが通知されていました。システムが見つからなかった場合は次の探索に進みます。
</p>

<p><code>:exclude</code>、<code>:also-exclude</code>ディレクティブには、ツリーを探索するときに除外するサブディレクトリ名を指定します。一般的には、バージョン管理システムのデータベースディレクトリ（<samp>.git</samp>、<samp>_darcs</samp>など）は除外されるでしょう。なお、除外の指定は継承された設定には<em>伝搬しません</em>。すべての設定は、デフォルトでは<code>asdf::*default-source-registry-exclusions*</code>に登録されている除外パターンを採用します。
</p>

<p><code>:include</code>ディレクティブでインクルードされた設定については、探索は再帰的に適用されます。
また、<code>:inherit-configuration</code>ディレクティブで継承された設定についても、探索は再帰的に適用されます。
</p>


<hr>
<a name="g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_30ad_30e3_30c3_30b7_30e5"></a>
<a name="sosurezisutorinokiyatusiyu"></a>
<h3 class="section">8.9 ソースレジストリのキャッシュ</h3>

<p>ソースレジストリがどのタイミングで構成されるかは、実装に任されています。つまり、ソースレジストリの実装は、設定とファイルシステムからソースレジストリを先行して(eagerly)構成してもかまわないし、あるいは情報が必要になるたびに(lazily)再構成してもかまいません。また、一部をキャッシュすることも許されています。実践的には、推奨される実装とは、ソースレジストリを先行して構成してキャッシュし、設定やファイルシステムの変更を反映したい場合はユーザーが明示的にキャッシュをクリアしなくてはならないというものです。<a name="DOCF42" href="#FOOT42"><sup>42</sup></a>
いっぽう、古いスタイルである<code>*central-registry*</code>のメカニズムは、ファイルシステムに毎回問い合わせるというものでした。
</p>
<p>ファイルシステムを変更したあと、キャッシュを明示的にクリアする方法については<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a>を参照してください。例えば<code>asdf:clear-source-registry</code>を呼ぶなどの方法があります。
</p>
<p>ASDF 3.1.4以降では、ツリー内にある<samp>.asd</samp>ファイルの場所を保持する、永続的なキャッシュファイルを作れるようになりました。仕様を説明すると、<code>:tree</code>ディレクティブで指定されたディレクトリ以下を再帰的に探索している途中で<samp>.cl-source-registry.cache</samp>ファイルを発見した場合、そのファイルに指定された<samp>.asd</samp>ファイルの場所だけを登録し、再帰を打ち切るようになりました。<samp>.cl-source-registry.cache</samp>は<code>:source-registry-cache</code>から始まる１つのフォームで構成され、<code>(:source-registry-cache <var>&quot;foo/bar.asd&quot;</var> <var>&quot;path/to/more.asd&quot;</var> ...)</code>のように、ツリーに含まれる<samp>.asd</samp>ファイルが<code>unix-namestring</code>で指定されます。なお、<code>(:source-registry-cache)</code>のような空の指定も許されており、その場合は単にその再帰を打ち切るだけになります。<a name="DOCF43" href="#FOOT43"><sup>43</sup></a>
</p>
<p>このキャッシュファイルを新たに作りたい場合、あるいはソースリポジトリのインストール・アップデート・削除などを行ったあとにキャッシュファイルをアップデートしたい場合、ASDFに含まれるスクリプトが使えます: <code>tools/cl-source-registry-cache.lisp <var>/path/to/directory</var></code>。また、キャッシュを無効にしたい場合は単に<samp>.cl-source-registry.cache</samp>を削除すればよいでしょう。いずれの場合も、起動中のLispプロセスにこの変更を反映するためには<code>(asdf:clear-source-registry)</code>などで（メモリ上の）キャッシュをクリアする必要があります。
</p>
<p>開発者は自分の開発ツリー内に安全にキャッシュファイルを作ることができますし、もしもソースツリーにたくさんのファイルやディレクトリが含まれているのであれば、そうすることを勧めます。このキャッシュファイルをアップデートする必要があるのは、<samp>.asd</samp>ファイルを作成・削除・移動したときだけです。また、ソフトウェアディストリビューションの管理者も安全にキャッシュファイルを作ることができますが、ソースリポジトリやインストールパッケージをインストール・アップデート・アンインストールする際にキャッシュファイルが更新されるように注意しなければなりません。最後に、経験ある開発者でソースレジストリ内の大量のコードを管理しなければならない方は、Lispプログラムを高速に起動するためにキャッシュファイルを手動で管理することも可能です。
</p>
<p>この永続的なキャッシュは起動を高速化するのに役立ちます。例えば数百ものソースレジストリを１つのマシンに抱えている場合、キャッシュファイルがあれば、SBCLで<code>#!/usr/bin/cl</code>スクリプトを起動するのが半秒ほど早くなりますし、他の処理系ではさらに差が大きいでしょう。これは主観的なインタラクティビティやユーザビリティに大きな違いをもたらします。なお、この起動の高速化を実現するには、処理系<em>付属</em>のASDFのバージョンが3.1.3.7以降である必要があります。すなわち、新しいASDFをソースレジストリに設定された場所に置いて処理系付属のASDFからブートストラップするというやり方では、この方式の恩恵は得られないでしょう。なぜなら、新しいASDFをキャッシュ無しで探すことになるからです。（→ <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>）
</p>

<hr>
<a name="g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI"></a>
<a name="sosurezisutorinoAPI"></a>
<h3 class="section">8.10 ソースレジストリのAPI</h3>

<p>次の関数は<code>asdf</code>パッケージからエクスポートされています。
</p>
<dl>
<dt><a name="index-initialize_002dsource_002dregistry"></a>関数: <strong>initialize-source-registry</strong> <em>&amp;optional <var>(parameter *source-registry-parameter*)</var></em></dt>
<dd><p>設定を読み込み、すべての内部変数を初期化します。その際、引数を与えることで、環境変数や設定ファイルによる設定を上書きしたり拡張したりすることができます。<var>parameter</var>が<code>nil</code>の時は設定の上書きは起こりません。S式の時は<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">S式によるDSL</a>が適用されます。文字列の時は<a href="#g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_ff09">シェル向けのDSL</a>が適用されます。パス名の時は対応する設定ファイル・設定ディレクトリから設定が読み込まれます。シンボルの時は<code>funcall</code>され、返ったオブジェクトの型に応じて同じ処理が適用されます。
</p></dd></dl>

<dl>
<dt><a name="index-clear_002dsource_002dregistry"></a>関数: <strong>clear-source-registry</strong></dt>
<dd><p>ソースレジストリの現在の設定と探索アルゴリズムによるキャッシュをすべて削除します。コアイメージのダンプをする際、そのイメージを別の（ソースレジストリの）設定で復元する予定であれば、その前にこの関数（あるいは<code>clear-configuration</code>）を呼んで、設定を空にしておく必要があるかもしれません。なお、この関数を呼んでも、現在のイメージにロードされているシステム定義は削除されないことに注意してください。消えるのは（まだシステム定義が読み込まれていない）システムを見つける際にどこを探すか、という情報だけです。
</p></dd></dl>

<dl>
<dt><a name="index-ensure_002dsource_002dregistry"></a>関数: <strong>ensure-source-registry</strong> <em>&amp;optional <var>(parameter *source-registry-parameter*)</var></em></dt>
<dd><p>ソースレジストリが既に<code>initialize-source-registry</code>で初期化されたかどうかチェックします。されていない場合は<code>initialize-source-registry</code>を呼びます。
</p></dd></dl>

<p><code>find-system</code>が呼ばれた時、（直接呼ばれたにせよ、<code>operate</code>や<code>load-system</code>などから呼ばれたにせよ）ASDFは<code>(ensure-source-registry nil)</code>を実行します。つまり、<code>find-system</code>が初めて呼ばれた時に、ソースレジストリは初期化されるわけです。また、設定ファイルを変更したあとは、明示的に<code>initialize-source-registry</code>で初期化するか、あるいは<code>clear-source-registry</code>や<code>clear-configuration</code>でソースレジストリをクリアし、次の<code>find-system</code>で初期化が行われるようにする必要があります。
</p>
<hr>
<a name="g_t_30a4_30f3_30c8_30ed_30b9_307a_30af_30b7_30e7_30f3"></a>
<a name="intorosupekusiyon"></a>
<h3 class="section">8.11 イントロスぺクション</h3>


<hr>
<a name="g_t_002asource_002dregistry_002dparameter_002a_5909_6570"></a>
<a name="g_t_002asource_002dregistry_002dparameter_002aBian-Shu-"></a>
<h4 class="subsection">8.11.1 <code>*source-registry-parameter*</code>変数</h4>
<a name="index-_002asource_002dregistry_002dparameter_002a"></a>

<p><code>*source-registry-parameter*</code>は、前回<code>initialize-source-registry</code>が呼ばれた時の引数を保持しているので、過去のソースレジストリの設定について知りたい時に参照できます。デフォルトは<code>nil</code>です。<strong>この変数はリードオンリーです。書き込んではいけません。</strong>
</p>
<hr>
<a name="g_t_30b7_30b9_30c6_30e0_306e_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066_306e_60c5_5831"></a>
<a name="sisutemunoYi-Cun-Guan-Xi-nituitenoQing-Bao-"></a>
<h4 class="subsection">8.11.2 システムの依存関係についての情報</h4>

<p>システム間の依存関係について知りたい時には、次の３つの関数が使えます。これらは依存関係の解析を行いたいプログラマのために用意されています。
</p>
<dl>
<dt><a name="index-system_002ddefsystem_002ddepends_002don"></a>関数: <strong>system-defsystem-depends-on</strong> <em>system</em></dt>
</dl>

<dl>
<dt><a name="index-system_002ddepends_002don"></a>関数: <strong>system-depends-on</strong> <em>system</em></dt>
</dl>

<dl>
<dt><a name="index-system_002dweakly_002ddepends_002don"></a>関数: <strong>system-weakly-depends-on</strong> <em>system</em></dt>
<dd><p><var>system</var>が弱依存しているシステムの名前のリストを返します。弱依存は<em>廃止予定</em>の機能であり、使うことは推奨されていません。<code>defsystem</code>フォームの<code>:weakly-depends-on</code>オプションに指定されたシステムについては、ASDFはそれらのシステムを探しますが、仮に見つからなくてもエラーを通知<em>しません</em>。（→ <a href="#g_t_5f31_3044_4f9d_5b58_95a2_4fc2">弱い依存関係</a>）
</p>
</dd></dl>

<p>上の２つの関数については、返り値は<code>dependency-def</code>のリスト（→ <a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>）であるため、必ずしもシステム名のリストとは限りません。いっぽう、<code>system-weakly-depends-on</code>は常にシステム名のリストを返します。
</p>

<hr>
<a name="g_t_73fe_72b6"></a>
<a name="Xian-Zhuang-"></a>
<h3 class="section">8.12 現状</h3>

<p>ソースレジストリの仕組みは大いに成功をおさめたので、我々はもはや<code>asdf:*central-registry*</code>は推奨しないと宣言しました。しかし、サポートは継続するでしょう。
</p>
<p>探索の仕組みのうち、処理系に依存する部分についてはすべて<code>asdf::wrapping-source-registry</code>関数（<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_8a2d_5b9a">ソースレジストリの設定</a>の１番目の処理にあたる）に統合され、常に暗黙に利用されています。
</p>
<hr>
<a name="g_t_5374_4e0b_3055_308c_305f_30a2_30a4_30c7_30a2"></a>
<a name="Que-Xia-saretaaidea"></a>
<h3 class="section">8.13 却下されたアイデア</h3>

<p>ASDF 2の開発中に私(FRR)が検討し、却下した代案には、次のようなものがあります。
</p>
<ol>
<li> Keep <code>asdf:*central-registry*</code> as the master with its current semantics,
   and somehow the configuration parser expands the new configuration
   language into a expanded series of directories of subdirectories to
   lookup, pre-recursing through specified hierarchies. This is kludgy,
   and leaves little space of future cleanups and extensions.

</li><li> Keep <code>asdf:*central-registry*</code> as the master but extend its semantics
   in completely new ways, so that new kinds of entries may be implemented
   as a recursive search, etc. This seems somewhat backwards.

</li><li> Completely remove <code>asdf:*central-registry*</code>
   and break backwards compatibility.
   Hopefully this will happen in a few years after everyone migrate to
   a better ASDF and/or to XCVB, but it would be very bad to do it now.

</li><li> Replace <code>asdf:*central-registry*</code> by a symbol-macro with appropriate magic
   when you dereference it or setf it. Only the new variable with new
   semantics is handled by the new search procedure.
   Complex and still introduces subtle semantic issues.
</li></ol>


<p>また、私は次の機能を提案しましたが、けっきょく却下しました。ASDFを必要以上に複雑にしないためです。
</p>
<ul>
<li> シンタックスシュガーの追加: いくつかのディレクティブにエイリアスを追加する案。例えば<code>(:add-directory X)</code>を<code>(:directory X)</code>と、<code>(:add-directory-hierarchy X)</code>や<code>(:add-directory X :recurse t)</code>を<code>(:tree X)</code>と同等にする、など。

</li><li> ディレクトリの代わりに個々のファイルを登録できるようにする案。

</li><li> Xach Beaneの<a href="https://github.com/xach/tilde">tilde展開器</a>をパーザに統合するか、あるいは類似のシェル互換の（またはシェルに近い）構文を導入する案。私はASDFを最小に保っておきたいのですが、今のASDFにある、評価されるエントリの必要性をなくしてしまえば、そちらのほうが的確に最小性を維持できるかもしれません。すなわち、<code>user-homedir-pathname</code>と<code>$SBCL_HOME</code>を使うことになります。おそらく、これらは既に<code>:default-registry</code>ディレクティブで置き換えられているでしょう。

</li><li> 環境変数での設定で、ツリーを指定する構文をTEXINPUTS風の<code>//</code>の代わりにシェル向けでない<code>/**</code>にする案。いずれにせよLispの構文とは相性がよくありません。
</li></ul>

<hr>
<a name="TODO"></a>
<a name="TODO-1"></a>
<h3 class="section">8.14 TODO</h3>

<ul>
<li> 例を追加する
</li></ul>

<hr>
<a name="g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306b_95a2_3059_308b_30af_30ec_30b8_30c3_30c8"></a>
<a name="sosurezisutoriniGuan-surukurezituto"></a>
<h3 class="section">8.15 ソースレジストリに関するクレジット</h3>

<p>最初のアイデアについてはStelian Ionescuに多大な感謝をささげます。
</p>
<p>最初の実装の試みについてはRommel Martinezに感謝をささげます。
</p>
<p>良いデザイン案やエレガントな実装のトリックは彼らのおかげですが、悪いデザイン案や実装のバグはすべて私に帰するものです。
</p>
<p>&mdash; Francois-Rene Rideau <a href="mailto:fare@tunes.org">fare@tunes.org</a>, Mon, 22 Feb 2010 00:07:33 -0500
</p>


<hr>
<a name="ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b"></a>
<a name="ASDFgakonpairusaretahuairuwoBao-Chi-suruChang-Suo-woShe-Ding-suru"></a>
<h2 class="chapter">9 ASDFがコンパイルされたファイルを保持する場所を設定する</h2>
<a name="index-asdf_002doutput_002dtranslations"></a>
<a name="index-ASDF_005fOUTPUT_005fTRANSLATIONS"></a>
<a name="index-autopututotoransuresiyon"></a>

<p>fasl<a name="DOCF44" href="#FOOT44"><sup>44</sup></a>、つまりコンパイルされたファイルのフォーマットは、処理系によって異なります。faslを扱うにあたっては、厄介な問題がいくつか存在します。まず、複数の処理系（あるいは１つの処理系の複数のバージョン）を使っている場合に、ソースディレクトリが様々な形式のfaslファイル（<samp>fasl</samp>、<samp>dfsl</samp>、<samp>cfsl</samp>など）で散らかってしまいます。その上、異なる処理系が同じ拡張子を使っていることがあり、また、同じ処理系でもバージョン間、プラットフォーム間でfaslの互換性がないのに同じ拡張子を維持していたりします。このため、別の処理系に切り替えたときに、膨大なエラーと混乱が引き起こされるかもしれません。さらに、faslをソースファイルと同じディレクトリに保持するスタイルは、ソースディレクトリへの書き込みを必要とするので、複数のユーザーが同じソースディレクトリを共有するのを困難にします。
</p>
<p>この問題を軽減するため、ASDF 2以降には<code>asdf-output-translations</code>機能が備わっています。
</p>

<hr>
<a name="g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_8a2d_5b9a"></a>
<a name="autopututotoransuresiyonnoShe-Ding-"></a>
<h3 class="section">9.1 アウトプットトランスレーションの設定</h3>



<p><em>アウトプットトランスレーション(output translations)</em>は（ソースファイルなどの）入力パスに（faslなどの）出力パスを対応させる仕組みです。アウトプットトランスレーションの設定ファイルは、ソースレジストリと同様に、<a href="#XDG_30d9_30fc_30b9_30c7_30a3_30ec_30af_30c8_30ea">XDGベースディレクトリ</a>の仕様に沿った場所に置かれます。
</p>

<p>[訳者補足]
</p>
<p>アウトプットトランスレーション（や前章で解説したソースレジストリ）の設定を記述したファイルは、<em>システム設定ファイル(system configuration file)</em>または単に<em>設定ファイル(configuration file)</em>と呼ばれます。ファイル形式は<samp>.conf</samp>です。システム定義ファイル（<samp>.asd</samp>ファイル）と混同しないようにしましょう。さらに、<em>設定ディレクトリ(configuration directory)</em>という概念もあります。設定ディレクトリは設定ファイルを含むディレクトリですが、設定ディレクトリ中の設定ファイルはその文法が微妙に異なるので注意が必要です。詳しくは<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a>と<a href="#g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">設定ディレクトリ（アウトプットトランスレーション）</a>を参照してください。
</p>
<p>また、以下の記述は、OSや処理系、環境変数によって異なる複雑なロジックを漏れなく解説したものではありませんが、これを補完するのは訳者の手に余ります。正確な挙動を把握する必要がある場合は<samp>output-translations.lisp</samp>と<samp>uiop/configuration.lisp</samp>を参照してください。
</p>
<p>アウトプットトランスレーションは次のように設定されます。おおむね、上から順に処理されていくと考えてかまいません。
</p>
<p>[訳者補足終わり]
</p>

<ol>
<li> アウトプットトランスレーションには、ハードコーディングされた設定が加わることがあります。これはソースレジストリの特別なエントリに対応した特別な出力先として機能します。

</li><li> アプリケーションは、アウトプットトランスレーションのAPIを使って明示的に設定を初期化することが許されており、その場合はその設定が優先されることになります。設定はコマンドラインからも行えますし、スクリプトファイルからも、あるいは独自のシステム設定ファイルからも行うことができます。（→ <a href="#Output-location-API">Output location API</a>）

</li><li> 環境変数<code>ASDF_OUTPUT_TRANSLATIONS</code>が存在する場合は、アウトプットトランスレーションがこの変数によって設定されます。

</li><li> 環境変数<code>XDG_CONFIG_DIRS</code>とユーザー設定ファイル<samp>$XDG_CONFIG_DIRS/common-lisp/asdf-output-translations.conf</samp>が存在する場合は、アウトプットトランスレーションがこのファイルによって設定されます。<code>XDG_CONFIG_DIRS</code>のデフォルトの値は<samp>~/.config/</samp>です。

</li><li> 環境変数<code>XDG_CONFIG_DIRS</code>とユーザー設定ディレクトリ<samp>$XDG_CONFIG_DIRS/common-lisp/asdf-output-translations.conf.d/</samp>が存在する場合は、アウトプットトランスレーションがこのディレクトリ内の設定ファイルによって設定されます。

</li><li> 設定ファイル<samp>/etc/common-lisp/asdf-output-translations.conf</samp>が存在する場合、アウトプットトランスレーションがこのファイルによって設定されます。Unixのみの処理です。 

</li><li> 設定ディレクトリ<samp>/etc/common-lisp/asdf-output-translations.conf.d/</samp>が存在する場合、ソースレジストリがこのディレクトリ内の設定ファイルによって設定されます。Unixのみの処理です。
<a name="DOCF45" href="#FOOT45"><sup>45</sup></a>

</li></ol>

<p>これらの設定は、S式による簡単なDSLで記述します。（→ <a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a>） 加えて、環境変数で設定する場合は、よりシェルに向いた構文も用意されています。（→ <a href="#g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">シェル向けの設定の構文（アウトプットトランスレーション）</a>）
</p>
<p>また、上に挙げた各設定は、必ずしもすべてが「結合」して使われるわけではありません。各設定が、継承する設定を明示的にあるいは暗黙にインクルードしない限り、以降の設定は無視されることになります。 
</p>
<p>なお、アウトプットトランスレーションのデフォルトの設定では、出力ファイルにはユーザーごとに分離されたキャッシュディレクトリが使われます。<a name="DOCF46" href="#FOOT46"><sup>46</sup></a>
この仕様によって、インストールされたソフトウェアを複数のユーザー間でシームレスに使うことができますし、開発者がソースコードを閲覧する際に出力ファイルが邪魔にならないようにできます。もっとも、開発者が出力ファイルを掃除したくなった場合にアウトプットトランスレーションについて学習する必要がある、という代償もありますが。<a name="DOCF47" href="#FOOT47"><sup>47</sup></a>
</p>


<hr>
<a name="g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09"></a>
<a name="Hou-Fang-Hu-Huan-Xing-notamenoJi-Neng--1"></a>
<h3 class="section">9.2 後方互換性のための機能</h3>
<a name="index-ASDF_002dBINARY_002dLOCATIONS-compatibility"></a>


<p>アウトプットトランスレーションと同様の機能を持つ従来のツールとして<code>ASDF-Binary-Locations</code>、<code>common-lisp-controller</code>、<code>cl-launch</code>などがありましたが、ASDFにはこれらの以前のバージョンとの後方互換性が<em>ありません</em>。（この仕様は意図的なものです。）従来のツールは、ユーザーが設定ファイルで簡単に設定できるようなデザインになっていませんでした。なお、最近のバージョンの<code>common-lisp-controller</code> (7.2)と<code>cl-launch</code> (3.000)は<code>asdf-output-translations</code>のAPIを使っており、また、<code>ASDF-Binary-Locations</code>は完全に置き換えられているのでもはや使うべきではありません。
</p>
<p>もっとも、この非互換性によって不便を被る人はあまりいないでしょう。実のところ、これらのツールをカスタマイズして使っている人はほとんどいませんし、その少数の人々はエキスパートであり、新しい設定に容易に適応するでしょう。そして、エキスパートでないほとんどの人々は（デフォルトの設定で使えている限りは）これらのツールを適切に設定することができず、システムのディストリビュータによる設定やデフォルト設定によってソフトウェアが「ただ動く」ことを知るだけでしょうから。
</p>
<p>しかし、<code>ASDF-Binary-Locations</code>を好む方のために、限定的なエミュレーションモードが用意されています:
</p>
<dl>
<dt><a name="index-enable_002dasdf_002dbinary_002dlocations_002dcompatibility"></a>関数: <strong>enable-asdf-binary-locations-compatibility</strong> <em>&amp;key centralize-lisp-binaries default-toplevel-directory include-per-user-information map-all-source-files source-to-target-mappings</em></dt>
<dd><p>この機能は<code>asdf-output-translations</code>の初期化を<code>ASDF-Binary-Locations</code>と似た仕組みで行います。<code>ASDF-Binary-Locations</code>はいくつかのグローバル変数（<code>*centralize-lisp-binaries*</code>、<code>*default-toplevel-directory*</code>、<code>*include-per-user-information*</code>、<code>*map-all-source-files*</code>、<var>*source-to-target-mappings*</var>）で設定を行っていましたが、この関数では同名のキーワード引数に値を渡すことで、設定が可能になります。なお、留意点として、<code>:source-to-target-mappings</code>引数の値は、単に文字列とパス名だけではなく<code>asdf-output-translations</code>で使える有効なパス名指示子であればなんでもよい、ということを述べておきます。
</p></dd></dl>


<p>また、アウトプットトランスレーションはデフォルトで有効になっていることに気をつけましょう。無効にするためには<code>(asdf:disable-output-translations)</code>を実行します。特に、従来の<code>ASDF-Binary-Locations</code>（ASDFの古いバージョンに組み込まれたものではなく、最新版に拡張としてロードできるもの）を使い続ける方は、始めに無効にするように気を付けてください。そうしないと「興味深い」問題が起きるかもしれません。
</p>

<hr>
<a name="g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL"></a>
<a name="autopututotoransuresiyonwoShe-Ding-suruDSL"></a>
<h3 class="section">9.3 アウトプットトランスレーションを設定するDSL</h3>

<p>アウトプットトランスレーションの設定は、S式によるDSLで行います。以下はその文法です:
</p>
<div class="example">
<pre class="example">;; 設定の１単位は１つのS式であり、S式はキーワード:source-registryから
;; 始まって１つ以上のディレクティブが続きます。
CONFIGURATION := (:output-translations DIRECTIVE ...)

;; ディレクティブは次のいずれかです:
DIRECTIVE :=
    ;; 継承ディレクティブ:
    ;; CONFIGURATIONは<em>必ず</em>次の２つのディレクティブのいずれかを含ま
    ;; なければなりません。
    :inherit-configuration |
    ;; 継承した設定をその位置に挿入するディレクティブで、多くの場合、
    ;; 最後に指定されます。<a name="DOCF48" href="#FOOT48">(48)</a>
    :ignore-inherited-configuration |
    ;; 継承した設定を除外します。どこに指定してもかまいません。

    ;; 前方互換性のためのディレクティブ（ASDF 2.011.4）以降です。新し
    ;; い設定機能を使いたいが、その機能をサポートしていない古いASDFか
    ;; ら新しいASDFをブートストラップして使っているという場合には、こ
    ;; のディレクティブが必要でしょう。
    :ignore-invalid-entries |

    ;; 別の設定ファイルまたは設定ディレクトリをインクルードします。
    (:include PATHNAME-DESIGNATOR) |

    ;; ユーザーキャッシュを有効にします。環境に応じて、例えば
    ;; ~/.common-lisp/cache/sbcl-1.0.45-linux-amd64/や
    ;; C:/Users/foo/AppData/Local/cache/common-lisp/sbcl-1.4.2-win-x64/
    ;; などが使われるでしょう。デフォルトでは有効です。
    :enable-user-cache |
    ;; ユーザーキャッシュを無効にします。/が/にマップされることになり
    ;; ます。
    :disable-cache |

    ;; １つのマッピングを(入力指示子　出力指示子)として追加します。
    (DIRECTORY-DESIGNATOR DIRECTORY-DESIGNATOR)

    ;; １つのマッピングを追加します。入力パスの変換は関数で行われます。
    (DIRECTORY-DESIGNATOR (:function TRANSLATION-FUNCTION))

DIRECTORY-DESIGNATOR :=
    NIL | ; 入力に指定した場合: このエントリをスキップします。
          ; 出力に指定した場合: 入力されたパス名を同じパス名にマップします。
    T | ; 入力に指定した場合: あらゆる入力パスに対応します。
        ; 出力に指定した場合: 入力されたパス名を同じパス名にマップします。
    ABSOLUTE-COMPONENT-DESIGNATOR ; → <a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a>

TRANSLATION-FUNCTION :=
    ;; 入力パスを出力パスに変換する関数です。この関数は２つの引数を取
    ;; り、１つ目は変換するべきパス名であり、２つ目は入力に指定した
    ;; DIRECTORY-DESIGNATOR（から導出されたワイルドカードを含むパス名）
    ;; です。
    SYMBOL |
    LAMBDA

</pre></div>



<p>ABSOLUTE-COMPONENT-DESIGNATORの末尾のコンポーネントがパス名でない場合、<samp>/**/*.*</samp>が加わっているものとみなされます。末尾のコンポーネントにパス名を使うと、<code>#p&quot;some/path/**/foo*/bar-*.fasl&quot;</code>のようにより細かいパターンを指定することができます。（→ <a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a>）
</p>
<p><code>#+フィーチャー</code>のようなフィーチャー表現も設定ファイル中で使うことが出来ます。
</p>


<p>入力指示子が<code>t</code>である場合、すべてのパスにマッチします。入力指示子が<code>:root</code>から始まる場合、すべてのホストとデバイスにマッチします。いずれの場合も（出力指示子が<code>t</code>でなく<code>:root</code>から始まるのでもなければ）<code>apply-output-translations</code>で入力パスが変換される際に、出力指示子のホストとデバイスが入力パスにマージされることになります。
</p>
<p>出力指示子が<code>t</code>（または<code>nil</code>）である場合、マッピングは恒等写像であり、入力パスがそのまま出力パスになります。
</p>
<p>出力指示子が<code>:root</code>から始まる場合、マッピングは入力パスのホストとデバイスを保持します。ファイルが存在するディレクトリのサブディクレトリにマッピングしたい場合にはこの機能を使って実現できますが、旧来の構文は次のようにやや複雑なものでした。
</p><div class="lisp">
<pre class="lisp">#.(let ((wild-subdir
          (make-pathname :directory '(:relative :wild-inferiors)))
        (wild-file
          (make-pathname :name :wild :version :wild :type :wild)))
   `((:root ,wild-subdir ,wild-file)
     (:root ,wild-subdir :implementation ,wild-file)))
</pre></div>
<p>しかし、ASDF 2.011.4からは次のように簡単に書けるようになりました。<a name="DOCF49" href="#FOOT49"><sup>49</sup></a>
</p><div class="lisp">
<pre class="lisp">(:root (:root :**/ :implementation :*.*.*))
</pre></div>

<p>また、ASDF-Binary-Locationsを使いたい方は、<code>enable-asdf-binary-locations-compatibility</code>を<code>:centralize-lisp-binaries nil</code>オプションで呼び出しても内部では同じ動作をすることになります。（→ <a href="#g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">後方互換性のための機能（アウトプットトランスレーション）</a>
</p>

<p><code>:include</code>ディレクティブでインクルードされる設定ファイル、設定ディレクトリについては再帰的に処理が適用されることになります。
</p>
<p>入力パスから出力パスへの変換は<code>cl:translate-pathname</code>（をポータブルにラップした<code>uiop:translate-pathname*</code>）で行われますが、望む変換ができない場合は、ユーザーは自ら変換アルゴリズムを書いて関数として指定することも出来ます。このような関数は出力指示子で<code>:function</code>キーワードの後に指定します。関数を指すシンボルでも、ラムダ式でもかまいません。この関数は２つの引数を取り、変換されたパス名を返さなければなりません。１つ目の引数は入力ファイルのパス名であり、２つ目は入力指示子（から導出されたワイルドカードを含むパス名）です。
</p>
<p><code>:inherit-configuration</code>は次の設定について再帰的に処理を適用します。次の設定とは、<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_8a2d_5b9a">アウトプットトランスレーションの設定</a>のリストにおいて下で処理される設定のことです。
</p>
<p>ユーザーキャッシュに関するディレクティブは以下の通りです:
<a name="index-asdf_003a_002auser_002dcache_002a"></a>
</p><ul>
<li> <code>:enable-user-cache</code>は <code>(t :user-cache)</code>と同等です。
</li><li> <code>:disable-cache</code>は<code>(t t)</code>と同等です。
</li><li> <code>:user-cache</code>は<code>asdf:*user-cache*</code>の値に対応します。unixならデフォルトでは<code>(:home &quot;.cache&quot; &quot;common-lisp&quot; :implementation)</code>と同等です。<a name="DOCF50" href="#FOOT50"><sup>50</sup></a>
</li></ul>


<hr>
<a name="g_t_8a2d_5b9a_30c7_30a3_30ec_30af_30c8_30ea_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09"></a>
<a name="She-Ding-deirekutori-1"></a>
<h3 class="section">9.4 設定ディレクトリ</h3>

<p>設定ディレクトリ内の<samp>.conf</samp>ファイルのDSLは、<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a>と少し<em>異なります</em>。まず、ディレクティブを<code>(:output-translations ...)</code>で囲む必要はありません。また、継承ディレクティブ<code>:inherit-configuration</code>、<code>:ignore-inherited-configuration</code>は使えず、ディレクティブのリストの<em>末尾</em>に暗黙に<code>:inherit-configuration</code>が加わります。これらに反した設定ファイルを読み込むと、ASDFは<code>uiop:invalid-configuration</code>エラーを通知するでしょう。なお、ディレクトリ中の設定ファイルは、そのネームストリングに従って<code>string&lt;</code>の順で読み込まれ、ディレクティブもこの順番で結合されます。
</p>
<p>Common Lispソフトウェアのディストリビューションは、自身の設定ファイル（例えば<samp>10-foo.conf</samp>）を設置する際、すべてのユーザーに対する設定は<samp>/etc/common-lisp/asdf-output-translations.conf.d/10-foo.conf</samp>を、ユーザー単位の設定は<samp>~/.config/common-lisp/asdf-output-translations.conf.d/10-foo.conf</samp>を使うことができます。そうすれば、インストールされるソフトウェアの設定情報を、容易かつモジュール化された形で登録できるでしょう。例えばDebianのパッケージや、将来のバージョンの<code>clbuild</code>がそうなることでしょう。<a name="DOCF51" href="#FOOT51"><sup>51</sup></a>
</p>
<p>設定ディレクトリ内の設定ファイル名は、上で挙げたように２つの数字から始めるのが慣習です。こうすることで、設定が読み込まれる順番を決めることができます。また、ファイル形式は<samp>.conf</samp>でなければなりません。この仕様のメリットは、単に実装が簡単であるだけでなく、設定ファイルを無効にするにはただファイル形式を変えればよい、という点にもあります。
</p>
<p>設定ファイル内で別の設定ディレクトリをインクルードしたい場合は、ディレクトリのパス名か文字列を<code>:include</code>ディレクティブに指定してください:
</p>
<pre class="verbatim">	(:include &quot;/foo/bar/&quot;)
</pre>
<hr>
<a name="g_t_30b7_30a7_30eb_5411_3051_306e_8a2d_5b9a_306e_69cb_6587_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09"></a>
<a name="sieruXiang-kenoShe-Ding-noGou-Wen-1"></a>
<h3 class="section">9.5 シェル向けの設定の構文</h3>

<p>ASDFは環境変数<code>ASDF_OUTPUT_TRANSLATIONS</code>を次のように処理します:
</p><ul>
<li> 空の文字列の場合は、無視して次の設定に進みます。
</li><li> <code>(</code>から始まる場合は、先に述べたDSLによるS式と解釈し、全体に<code>read</code>を適用します。
</li><li> それ以外の場合は特別な構文によるディレクトリのリストとみなします。（下述）
</li></ul>

<p>ディレクトリのリストは、正確に言えばディレクトリのペアのリストであり、１つのペアがマッピングのディレクティブを表します。各エントリの区切りは、UNIX（Cygwin含む）では<code>:</code>であり、それ以外（主にWindows）では<code>;</code>です。
</p>
<p>空のエントリがペアの１つ目のエントリ（つまり入力指示子）の位置に現れた場合、その部分に継承された設定が挿入されます。この場合、２つ目のエントリはないものとして扱われ、次のエントリは新しいペアとみなされます。空のエントリがペアの２つ目のエントリ（つまり出力指示子）の位置に現れた場合、１つ目のエントリと同じディレクトリを指します。（つまり、ディレクトリを繰り返し書いたのと同等です。）
</p>
<p>例として<code>&quot;/foo:/bar::/baz:&quot;</code>という設定を見てみましょう。この設定の最初のペアは<code>/foo:/bar</code>ですから、<samp>/foo/</samp>以下のパスは<samp>/bar/</samp>以下に変換されることになります。その次は空のエントリなので、継承された設定がこの部分に挿入されます。最後のペアは<code>/baz:</code>であり、これは<code>/baz:/baz</code>と同等ですから、<samp>/baz/</samp>以下のパスは変換されないことになります。
</p>

<hr>
<a name="g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_30bb_30de_30f3_30c6_30a3_30af_30b9"></a>
<a name="autopututotoransuresiyonnosemanteikusu"></a>
<h3 class="section">9.6 アウトプットトランスレーションのセマンティクス</h3>

<p>From the specified configuration,
a list of mappings is extracted in a straightforward way:
mappings are collected in order, recursing through
included or inherited configuration as specified.
To this list is prepended some implementation-specific mappings,
and is appended a global default.
</p>
<p>The list is then compiled to a mapping table as follows:
for each entry, in order, resolve the first designated directory
into an actual directory pathname for source locations.
If no mapping was specified yet for that location,
resolve the second designated directory to an output location directory
add a mapping to the table mapping the source location to the output location,
and add another mapping from the output location to itself
(unless a mapping already exists for the output location).
</p>
<p>Based on the table, a mapping function is defined,
mapping source pathnames to output pathnames:
given a source pathname, locate the longest matching prefix
in the source column of the mapping table.
Replace that prefix by the corresponding output column
in the same row of the table, and return the result.
If no match is found, return the source pathname.
(A global default mapping the filesystem root to itself
may ensure that there will always be a match,
with same fall-through semantics).
</p>
<hr>
<a name="Output-Caching-Results"></a>
<a name="Caching-Results"></a>
<h3 class="section">9.7 Caching Results</h3>

<p>The implementation is allowed to either eagerly compute the information
from the configurations and file system, or to lazily re-compute it
every time, or to cache any part of it as it goes.
To explicitly flush any information cached by the system, use the API below.
</p>

<hr>
<a name="Output-location-API"></a>
<a name="Output-location-API-1"></a>
<h3 class="section">9.8 Output location API</h3>

<p>The specified functions are exported from package ASDF.
</p>
<dl>
<dt><a name="index-initialize_002doutput_002dtranslations"></a>Function: <strong>initialize-output-translations</strong> <em>&amp;optional PARAMETER</em></dt>
<dd><p>will read the configuration and initialize all internal variables.
   You may extend or override configuration
   from the environment and configuration files
   with the given <var>PARAMETER</var>, which can be
   <code>nil</code> (no configuration override),
   or a SEXP (in the SEXP DSL),
   a string (as in the string DSL),
   a pathname (of a file or directory with configuration),
   or a symbol (fbound to function that when called returns one of the above).
</p></dd></dl>

<dl>
<dt><a name="index-disable_002doutput_002dtranslations"></a>Function: <strong>disable-output-translations</strong></dt>
<dd><p>will initialize output translations in a way
   that maps every pathname to itself,
   effectively disabling the output translation facility.
</p></dd></dl>

<dl>
<dt><a name="index-clear_002doutput_002dtranslations-1"></a>Function: <strong>clear-output-translations</strong></dt>
<dd><p>undoes any output translation configuration
   and clears any cache for the mapping algorithm.
   You might want to call this function
   (or better, <code>clear-configuration</code>)
   before you dump an image that would be resumed
   with a different configuration,
   and return an empty configuration.
   Note that this does not include clearing information about
   systems defined in the current image, only about
   where to look for systems not yet defined.
</p></dd></dl>

<dl>
<dt><a name="index-ensure_002doutput_002dtranslations"></a>Function: <strong>ensure-output-translations</strong> <em>&amp;optional PARAMETER</em></dt>
<dd><p>checks whether output translations have been initialized.
   If not, initialize them with the given <var>PARAMETER</var>.
   This function will be called before any attempt to operate on a system.
</p></dd></dl>

<dl>
<dt><a name="index-apply_002doutput_002dtranslations"></a>Function: <strong>apply-output-translations</strong> <em>PATHNAME</em></dt>
<dd><p>Applies the configured output location translations to <var>PATHNAME</var>
   (calls <code>ensure-output-translations</code> for the translations).
</p></dd></dl>

<p>Every time you use ASDF&rsquo;s <code>output-files</code>, or
anything that uses it (that may compile, such as <code>operate</code>, <code>perform</code>, etc.),
<code>ensure-output-translations</code> is called with parameter <code>nil</code>,
which the first time around causes your configuration to be read.
If you change a configuration file,
you need to explicitly <code>initialize-output-translations</code> again,
or maybe <code>clear-output-translations</code> (or <code>clear-configuration</code>),
which will cause the initialization to happen next time around.
</p>

<hr>
<a name="Credits-for-output-translations"></a>
<a name="Credits-for-output-translations-1"></a>
<h3 class="section">9.9 Credits for output translations</h3>

<p>Thanks a lot to Peter van Eynde for <code>Common Lisp Controller</code>
and to Bjorn Lindberg and Gary King for <code>ASDF-Binary-Locations</code>.
</p>
<p>All bad design ideas and implementation bugs are to mine, not theirs.
But so are good design ideas and elegant implementation tricks.
</p>
<p>&mdash; Francois-Rene Rideau <a href="mailto:fare@tunes.org">fare@tunes.org</a>
</p>







<hr>
<a name="g_t_30a8_30e9_30fc_51e6_7406"></a>
<a name="eraChu-Li-"></a>
<h2 class="chapter">10 エラー処理</h2>
<a name="index-system_002ddefinition_002derror"></a>
<a name="index-operation_002derror"></a>

<a name="ASDFnoera"></a>
<h3 class="section">10.1 ASDFのエラー</h3>

<p>ASDFが不正なシステム定義を検出すると、<code>system-definition-error</code>を通知します。
</p>
<p>いっぽう、オペレーションが失敗した場合（例えばソースファイルがエラーを含んでいた場合）は、<code>operation-error</code>が通知されます。
</p>
<a name="konpairuShi-noeraJing-Gao-noChu-Li-"></a>
<h3 class="section">10.2 コンパイル時のエラー・警告の処理</h3>
<a name="index-_002acompile_002dfile_002dwarnings_002dbehaviour_002a"></a>
<a name="index-_002acompile_002dfile_002dfailure_002dbehaviour_002a"></a>

<p>ASDFは、ファイルのコンパイル時の警告、エラーをチェックしており、それらを検出した時の動作は変数<code>*compile-file-warnings-behaviour*</code>と<code>*compile-file-failure-behaviour*</code>で制御することができます。有効な値は<code>:error</code>、<code>:warn</code>、<code>:ignore</code>です。
</p>
<hr>
<a name="Miscellaneous-additional-functionality"></a>
<a name="Miscellaneous-additional-functionality-1"></a>
<h2 class="chapter">11 Miscellaneous additional functionality</h2>

<p>ASDF includes several additional features that are generally
useful for system definition and development.
</p>

<hr>
<a name="Controlling-file-compilation"></a>
<a name="Controlling-file-compilation-1"></a>
<h3 class="section">11.1 Controlling file compilation</h3>
<a name="index-_003aaround_002dcompile"></a>
<a name="index-around_002dcompile-keyword"></a>
<a name="index-compile_002dcheck-keyword"></a>
<a name="index-_003acompile_002dcheck"></a>
<a name="index-compile_002dfile_002a"></a>


<p>When declaring a component (system, module, file),
you can specify a keyword argument <code>:around-compile function</code>.
If left unspecified (and therefore unbound),
the value will be inherited from the parent component if any,
or with a default of <code>nil</code>
if no value is specified in any transitive parent.
</p>
<p>The argument must be either <code>nil</code>, an fbound symbol,
a lambda-expression (e.g. <code>(lambda (thunk) ...(funcall thunk ...) ...)</code>)
a function object (e.g. using <code>#.#'</code> but that&rsquo;s discouraged
because it prevents the introspection done by e.g. asdf-dependency-grovel),
or a string that when <code>read</code> yields a symbol or a lambda-expression.
<code>nil</code> means the normal compile-file function will be called.
A non-nil value designates a function of one argument
that will be called with a function that will
invoke <code>compile-file*</code> with various arguments;
the around-compile hook may supply additional keyword arguments
to pass to that call to <code>compile-file*</code>.
</p>
<p>One notable argument that is heeded by <code>compile-file*</code> is
<code>:compile-check</code>,
a function called when the compilation was otherwise a success,
with the same arguments as <code>compile-file</code>;
the function shall return true if the compilation
and its resulting compiled file respected all system-specific invariants,
and false (<code>nil</code>) if it broke any of those invariants;
it may issue warnings or errors before it returns <code>nil</code>.
(NB: The ability to pass such extra flags
is only available starting with ASDF 2.22.3.)
This feature is notably exercised by asdf-finalizers.
</p>
<p>By using a string, you may reference
a function, symbol and/or package
that will only be created later during the build, but
isn&rsquo;t yet present at the time the defsystem form is evaluated.
However, if your entire system is using such a hook, you may have to
explicitly override the hook with <code>nil</code> for all the modules and files
that are compiled before the hook is defined.
</p>
<p>Using this hook, you may achieve such effects as:
locally renaming packages,
binding <var>*readtables*</var> and other syntax-controlling variables,
handling warnings and other conditions,
proclaiming consistent optimization settings,
saving code coverage information,
maintaining meta-data about compilation timings,
setting gensym counters and PRNG seeds and other sources of non-determinism,
overriding the source-location and/or timestamping systems,
checking that some compile-time side-effects were properly balanced,
etc.
</p>
<p>Note that there is no around-load hook. This is on purpose.
Some implementations such as ECL, GCL or MKCL link object files,
which allows for no such hook.
Other implementations allow for concatenating FASL files,
which doesn&rsquo;t allow for such a hook either.
We aim to discourage something that&rsquo;s not portable,
and has some dubious impact on performance and semantics
even when it is possible.
Things you might want to do with an around-load hook
are better done around-compile,
though it may at times require some creativity
(see e.g. the <code>package-renaming</code> system).
</p>

<hr>
<a name="Controlling-source-file-character-encoding"></a>
<a name="Controlling-source-file-character-encoding-1"></a>
<h3 class="section">11.2 Controlling source file character encoding</h3>

<p>Starting with ASDF 2.21, components accept a <code>:encoding</code> option
so authors may specify which character encoding should be used
to read and evaluate their source code.
When left unspecified, the encoding is inherited
from the parent module or system;
if no encoding is specified at any point,
or if <code>nil</code> is explicitly specified,
an extensible protocol described below is followed,
that ultimately defaults to <code>:utf-8</code> since ASDF 3.
</p>
<p>The protocol to determine the encoding is
to call the function <code>detect-encoding</code>,
which itself, if provided a valid file,
calls the function specified by <var>*encoding-detection-hook*</var>,
or else defaults to the <var>*default-encoding*</var>.
The <var>*encoding-detection-hook*</var> is by default bound
to function <code>always-default-encoding</code>,
that always returns the contents of <var>*default-encoding*</var>.
<var>*default-encoding*</var> is bound to <code>:utf-8</code> by default
(before ASDF 3, the default was <code>:default</code>).
</p>
<p>Whichever encoding is returned must be a portable keyword,
that will be translated to an implementation-specific external-format designator
by function <code>encoding-external-format</code>,
which itself simply calls the function specified <var>*encoding-external-format-hook*</var>;
that function by default is <code>default-encoding-external-format</code>,
that only recognizes <code>:utf-8</code> and <code>:default</code>,
and translates the former to the implementation-dependent <var>*utf-8-external-format*</var>,
and the latter to itself (that itself is portable but has an implementation-dependent meaning).
</p>
<p>In other words, there now are plenty of extension hooks, but
by default ASDF enforces the previous <em>de facto</em> standard behaviour
of using <code>:utf-8</code>, independently from
whatever configuration the user may be using.
Thus, system authors can now rely on <code>:utf-8</code>
being used while compiling their files,
even if the user is currently using <code>:koi8-r</code> or <code>:euc-jp</code>
as their interactive encoding.
(Before ASDF 3, there was no such guarantee, <code>:default</code> was used,
and only plain ASCII was safe to include in source code.)
</p>
<p>Some legacy implementations only support 8-bit characters,
and some implementations provide 8-bit only variants.
On these implementations, the <var>*utf-8-external-format*</var>
gracefully falls back to <code>:default</code>,
and Unicode characters will be read as multi-character mojibake.
To detect such situations, UIOP will push the <code>:asdf-unicode</code> feature
on implementations that support Unicode, and you can use reader-conditionalization
to protect any <code>:encoding <em>encoding</em></code> statement, as in
<code>#+asdf-unicode :encoding #+asdf-unicode :utf-8</code>.
We recommend that you avoid using unprotected <code>:encoding</code> specifications
until after ASDF 2.21 or later becomes widespread.
As of May 2016, all maintained implementations provide ASDF 3.1,
so you may prudently start using this and other features without such protection.
</p>
<p>While it offers plenty of hooks for extension,
and one such extension is available (see <code>asdf-encodings</code> below),
ASDF itself only recognizes one encoding beside <code>:default</code>,
and that is <code>:utf-8</code>, which is the <em>de facto</em> standard,
already used by the vast majority of libraries that use more than ASCII.
On implementations that do not support unicode,
the feature <code>:asdf-unicode</code> is absent, and
the <code>:default</code> external-format is used
to read even source files declared as <code>:utf-8</code>.
On these implementations, non-ASCII characters
intended to be read as one CL character
may thus end up being read as multiple CL characters.
In most cases, this shouldn&rsquo;t affect the software&rsquo;s semantics:
comments will be skipped just the same, strings with be read and printed
with slightly different lengths, symbol names will be accordingly longer,
but none of it should matter.
But a few systems that actually depend on unicode characters
may fail to work properly, or may work in a subtly different way.
See for instance <code>lambda-reader</code>.
</p>
<p>We invite you to embrace UTF-8
as the encoding for non-ASCII characters starting today,
even without any explicit specification in your <samp>.asd</samp> files.
Indeed, on some implementations and configurations,
UTF-8 is already the <code>:default</code>,
and loading your code may cause errors if it is encoded in anything but UTF-8.
Therefore, even with the legacy behaviour,
non-UTF-8 is guaranteed to break for some users,
whereas UTF-8 is pretty much guaranteed not to break anywhere
(provided you do <em>not</em> use a BOM),
although it might be read incorrectly on some implementations.
<code>:utf-8</code> has been the default value of <code>*default-encoding*</code> since ASDF 3.
</p>
<p>If you need non-standard character encodings for your source code,
use the extension system <code>asdf-encodings</code>, by specifying
<code>:defsystem-depends-on (&quot;asdf-encodings&quot;)</code> in your <code>defsystem</code>.
This extension system will register support for more encodings using the
<code>*encoding-external-format-hook*</code> facility,
so you can explicitly specify <code>:encoding :latin1</code>
in your <samp>.asd</samp> file.
Using the <code>*encoding-detection-hook*</code> it will also
eventually implement some autodetection of a file&rsquo;s encoding
from an emacs-style <code>-*- mode: lisp ; coding: latin1 -*-</code> declaration,
or otherwise based on an analysis of octet patterns in the file.
At this point, <code>asdf-encoding</code> only supports the encodings
that are supported as part of your implementation.
Since the list varies depending on implementations,
we still recommend you use <code>:utf-8</code> everywhere,
which is the most portable (next to it is <code>:latin1</code>).
</p>
<p>Recent versions of Quicklisp include <code>asdf-encodings</code>;
if you&rsquo;re not using it, you may get this extension using git:
<kbd>git clone https://gitlab.common-lisp.net/asdf/asdf-encodings.git</kbd>
or
<kbd>git clone git@gitlab.common-lisp.net:asdf/asdf-encodings.git</kbd>.
You can also browse the repository on
<a href="https://gitlab.common-lisp.net/asdf/asdf-encodings">https://gitlab.common-lisp.net/asdf/asdf-encodings</a>.
</p>
<p>When you use <code>asdf-encodings</code>,
any <samp>.asd</samp> file loaded
will use the autodetection algorithm to determine its encoding.
If you depend on this detection happening,
you should explicitly load <code>asdf-encodings</code> early in your build.
Note that <code>:defsystem-depends-on</code> cannot be used here: by the time
the <code>:defsystem-depends-on</code> is loaded, the enclosing
<code>defsystem</code> form has already been read.
</p>
<p>In practice, this means that the <code>*default-encoding*</code>
is usually used for <samp>.asd</samp> files.
Currently, this defaults to <code>:utf-8</code>, and
you should be safe using Unicode characters in those files.
This might matter, for instance, in meta-data about author&rsquo;s names.
Otherwise, the main data in these files is component (path)names,
and we don&rsquo;t recommend using non-ASCII characters for these,
for the result probably isn&rsquo;t very portable.
</p>
<hr>
<a name="Miscellaneous-Functions"></a>
<a name="Miscellaneous-Functions-1"></a>
<h3 class="section">11.3 Miscellaneous Functions</h3>

<p>These functions are exported by ASDF for your convenience.
</p>
<a name="system_002drelative_002dpathname"></a><dl>
<dt><a name="index-system_002drelative_002dpathname"></a>Function: <strong>system-relative-pathname</strong> <em>system name &amp;key type</em></dt>
<dd>
<p>It&rsquo;s often handy to locate a file relative to some system.
The <code>system-relative-pathname</code> function meets this need.
</p>
<p>It takes two mandatory arguments <var>system</var> and <var>name</var>
and a keyword argument <var>type</var>:
<var>system</var> is name of a system, whereas <var>name</var> and optionally <var>type</var>
specify a relative pathname, interpreted like a component pathname specifier
by <code>coerce-pathname</code>. See <a href="#g_t_30d1_30b9_540d_6307_5b9a_5b50">パス名指定子</a>.
</p>
<p>It returns a pathname built from the location of the system&rsquo;s
source directory and the relative pathname. For example:
</p>
<div class="lisp">
<pre class="lisp">&gt; (asdf:system-relative-pathname 'cl-ppcre &quot;regex.data&quot;)
#P&quot;/repository/other/cl-ppcre/regex.data&quot;
</pre></div>

</dd></dl>

<dl>
<dt><a name="index-system_002dsource_002ddirectory"></a>Function: <strong>system-source-directory</strong> <em>system-designator</em></dt>
<dd>
<p>ASDF does not provide a turnkey solution for locating
data (or other miscellaneous) files
that are distributed together with the source code of a system.
Programmers can use <code>system-source-directory</code> to find such files.
Returns a pathname object.
The <var>system-designator</var> may be a string, symbol, or ASDF system object.
</p></dd></dl>

<dl>
<dt><a name="index-clear_002dsystem"></a>Function: <strong>clear-system</strong> <em>system-designator</em></dt>
<dd>
<p>It is sometimes useful to force recompilation of a previously loaded system.
For these cases, <code>(asdf:clear-system :foo)</code>
will remove the system from the table of currently loaded systems:
the next time the system <code>foo</code> or one that depends on it is re-loaded,
<code>foo</code> will be loaded again.<a name="DOCF52" href="#FOOT52"><sup>52</sup></a>
</p>
<p>Note that this does not and cannot undo
the previous loading of the system.
Common Lisp has no provision for such an operation,
and its reliance on irreversible side-effects to global data structures
makes such a thing impossible in the general case.
If the software being re-loaded is not conceived with hot upgrade in mind,
re-loading may cause many errors, warnings or subtle silent problems,
as packages, generic function signatures, structures, types, macros, constants, etc.
are being redefined incompatibly.
It is up to the user to make sure that reloading is possible and has the desired effect.
In some cases, extreme measures such as recursively deleting packages,
unregistering symbols, defining methods on <code>update-instance-for-redefined-class</code>
and much more are necessary for reloading to happen smoothly.
ASDF itself goes to extensive effort to make a hot upgrade possible
with respect to its own code.
If you want, you can reuse some of its utilities such as
<code>uiop:define-package</code> and <code>uiop:with-upgradability</code>,
and get inspiration (or disinspiration)
from what it does in <samp>header.lisp</samp> and <samp>upgrade.lisp</samp>.
</p></dd></dl>

<dl>
<dt><a name="index-register_002dpreloaded_002dsystem"></a>Function: <strong>register-preloaded-system</strong> <em>name &amp;rest keys &amp;key version &amp;allow-other-keys</em></dt>
<dd><p>A system with name <var>name</var>,
created by <code>make-instance</code> with extra keys <var>keys</var>
(e.g. <code>:version</code>),
is registered as <em>preloaded</em>.
If <var>version</var> is <code>t</code> (default), then the version is copied from the defined system
of the same name (if registered) or else is <code>nil</code>
(this automatic copy of version is only available starting since ASDF 3.1.8).
</p>
<p>A preloaded system is considered as having already been loaded into the current image,
and if at some point some other system <code>:depends-on</code> it yet no source code is found,
it is considered as already provided,
and ASDF will not raise a <code>missing-component</code> error.
</p>
<p>This function is particularly useful if you distribute your code
as fasls with either <code>compile-bundle-op</code> or <code>monolithic-compile-bundle-op</code>,
and want to register systems so that dependencies will work uniformly
whether you&rsquo;re using your software from source or from fasl.
</p>
<p>Note that if the system was already defined or loaded from source code,
its build information will remain active until you call <code>clear-system</code> on it,
at which point a system without build information will be registered in its place.
</p></dd></dl>

<dl>
<dt><a name="index-register_002dimmutable_002dsystem-1"></a>Function: <strong>register-immutable-system</strong> <em>name &amp;rest keys</em></dt>
<dd><p>A system with name <var>name</var> is registered as preloaded,
and additionally is marked as <em>immutable</em>:
that is, attempts to compile or load it will be succeed
without actually reading, creating or loading any file,
as if the system was passed as a <code>force-not</code> argument
to all calls to <code>plan</code> or <code>operate</code>.
There will be no search for an updated <samp>.asd</samp> file
to override the loaded version,
whether from the source-register or any other method.
</p>
<p>If a <var>version</var> keyword argument is specified as <code>t</code> or left unspecified,
then the version is copied from the defined system
of the same name (if registered) or else is <code>nil</code>.
This automatic copy of version is available starting
since immutable systems have been available in ASDF 3.1.5.
</p>
<p>This function, available since ASDF 3.1.5, is particularly useful
if you distribute a large body of code as a precompiled image,
and want to allow users to extend the image with further extension systems,
but without making thousands of filesystem requests looking for inexistent
(or worse, out of date) source code
for all the systems that came bundled with the image but aren&rsquo;t
distributed as source code to regular users.
<a name="index-immutable-systems-1"></a>
</p></dd></dl>

<dl>
<dt><a name="index-run_002dshell_002dcommand"></a>Function: <strong>run-shell-command</strong> <em>control-string &amp;rest args</em></dt>
<dd>
<p>This function is obsolete and present only for the sake of backwards-compatibility:
&ldquo;If it&rsquo;s not backwards, it&rsquo;s not compatible&rdquo;. We <em>strongly</em> discourage its use.
Its current behaviour is only well-defined on Unix platforms
(which include MacOS X and cygwin). On Windows, anything goes.
The following documentation is only for the purpose of your migrating away from it
in a way that preserves semantics.
</p>
<p>Instead we recommend the use <code>run-program</code>, described in the next section, and
available as part of ASDF since ASDF 3.
</p>
<p><code>run-shell-command</code> takes as arguments a format <code>control-string</code>
and arguments to be passed to <code>format</code> after this control-string
to produce a string.
This string is a command that will be evaluated with a POSIX shell if possible;
yet, on Windows, some implementations will use CMD.EXE,
while others (like SBCL) will make an attempt at invoking a POSIX shell
(and fail if it is not present).
</p></dd></dl>

<hr>
<a name="Some-Utility-Functions"></a>
<a name="Some-Utility-Functions-1"></a>
<h3 class="section">11.4 Some Utility Functions</h3>

<p>The below functions are not exported by ASDF itself, but by UIOP, available since ASDF 3.
Some of them have precursors in ASDF 2, but we recommend that for active developments,
you should rely on the package UIOP as included in ASDF 3.
UIOP provides many, many more utility functions, and we recommend
you read its <samp>README.md</samp> and sources for more information.
</p>

<dl>
<dt><a name="index-parse_002dunix_002dnamestring"></a>Function: <strong>parse-unix-namestring</strong> <em>name &amp;key type defaults dot-dot ensure-directory &amp;allow-other-keys</em></dt>
<dd><p>Coerce <var>name</var> into a <var>pathname</var> using standard Unix syntax.
</p>
<p>Unix syntax is used whether or not the underlying system is Unix;
on non-Unix systems it is only usable for relative pathnames.
In order to manipulate relative pathnames portably, it is crucial
to possess a portable pathname syntax independent of the underlying OS.
This is what <code>parse-unix-namestring</code> provides, and why we use it in ASDF.
</p>
<p>When given a <code>pathname</code> object, just return it untouched.
When given <code>nil</code>, just return <code>nil</code>.
When given a non-null <code>symbol</code>, first downcase its name and treat it as a string.
When given a <code>string</code>, portably decompose it into a pathname as below.
</p>
<p><code>#\/</code> separates directory components.
</p>
<p>The last <code>#\/</code>-separated substring is interpreted as follows:
1- If <var>type</var> is <code>:directory</code> or <var>ensure-directory</var> is true,
 the string is made the last directory component, and its <code>name</code> and <code>type</code> are <code>nil</code>.
 if the string is empty, it&rsquo;s the empty pathname with all slots <code>nil</code>.
2- If <var>type</var> is <code>nil</code>, the substring is a file-namestring,
 and its <code>name</code> and <code>type</code> are separated by <code>split-name-type</code>.
3- If <var>type</var> is a string, it is the given <code>type</code>, and the whole string is the <code>name</code>.
</p>
<p>Directory components with an empty name the name <code>.</code> are removed.
Any directory named <code>..</code> is read as <var>dot-dot</var>,
which must be one of <code>:back</code> or <code>:up</code> and defaults to <code>:back</code>.
</p>
<a name="index-_002anil_002dpathname_002a"></a>
<p><code>host</code>, <code>device</code> and <code>version</code> components are taken from <var>defaults</var>,
which itself defaults to <code>*nil-pathname*</code>.
<code>*nil-pathname*</code> is also used if <var>defaults</var> is <code>nil</code>.
No host or device can be specified in the string itself,
which makes it unsuitable for absolute pathnames outside Unix.
</p>
<p>For relative pathnames, these components (and hence the defaults) won&rsquo;t matter
if you use <code>merge-pathnames*</code> but will matter if you use <code>merge-pathnames</code>,
which is an important reason to always use <code>merge-pathnames*</code>.
</p>
<p>Arbitrary keys are accepted, and the parse result is passed to <code>ensure-pathname</code>
with those keys, removing <var>type</var>, <var>defaults</var> and <var>dot-dot</var>.
When you&rsquo;re manipulating pathnames that are supposed to make sense portably
even though the OS may not be Unixish, we recommend you use <code>:want-relative t</code>
so that <code>parse-unix-namestring</code> will throw an error if the pathname is absolute.
</p></dd></dl>

<dl>
<dt><a name="index-merge_002dpathnames_002a"></a>Function: <strong>merge-pathnames*</strong> <em>specified &amp;optional defaults</em></dt>
<dd>
<p>This function is a replacement for <code>merge-pathnames</code> that uses the host and device
from the <var>defaults</var> rather than the <var>specified</var> pathname when the latter
is a relative pathname. This allows ASDF and its users to create and use relative pathnames
without having to know beforehand what are the host and device
of the absolute pathnames they are relative to.
</p>
</dd></dl>

<dl>
<dt><a name="index-subpathname"></a>Function: <strong>subpathname</strong> <em>pathname subpath &amp;key type</em></dt>
<dd>
<p>This function takes a <var>pathname</var> and a <var>subpath</var> and a <var>type</var>.
If <var>subpath</var> is already a <code>pathname</code> object (not namestring),
and is an absolute pathname at that, it is returned unchanged;
otherwise, <var>subpath</var> is turned into a relative pathname with given <var>type</var>
as per <code>parse-unix-namestring</code> with <code>:want-relative t :type </code><var>type</var>,
then it is merged with the <code>pathname-directory-pathname</code> of <var>pathname</var>,
as per <code>merge-pathnames*</code>.
</p>
<p>We strongly encourage the use of this function
for portably resolving relative pathnames in your code base.
</p></dd></dl>

<dl>
<dt><a name="index-subpathname_002a"></a>Function: <strong>subpathname*</strong> <em>pathname subpath &amp;key type</em></dt>
<dd>
<p>This function returns <code>nil</code> if the base <var>pathname</var> is <code>nil</code>,
otherwise acts like <code>subpathname</code>.
</p></dd></dl>

<dl>
<dt><a name="index-run_002dprogram"></a>Function: <strong>run-program</strong> <em>command &amp;key ignore-error-status force-shell input output error-output if-input-does-not-exist if-output-exists if-error-output-exists element-type external-format &amp;allow-other-keys</em></dt>
<dd>
<p><code>run-program</code> takes a <var>command</var> argument that is either
a list of a program name or path and its arguments,
or a string to be executed by a shell.
It spawns the command, waits for it to return,
verifies that it exited cleanly (unless told not too below),
and optionally captures and processes its output.
It accepts many keyword arguments to configure its behaviour.
</p>
<p><code>run-program</code> returns three values: the first for the output,
the second for the error-output, and the third for the return value.
(Beware that before ASDF 3.0.2.11, it didn&rsquo;t handle input or error-output,
and returned only one value,
the one for the output if any handler was specified, or else the exit code;
please upgrade ASDF, or at least UIOP, to rely on the new enhanced behaviour.)
</p>
<p><var>output</var> is its most important argument;
it specifies how the output is captured and processed.
If it is <code>nil</code>, then the output is redirected to the null device,
that will discard it.
If it is <code>:interactive</code>, then it is inherited from the current process
(beware: this may be different from your <var>*standard-output*</var>,
and under SLIME will be on your <code>*inferior-lisp*</code> buffer).
If it is <code>t</code>, output goes to your current <var>*standard-output*</var> stream.
Otherwise, <var>output</var> should be a value that is a suitable first argument to
<code>slurp-input-stream</code> (see below), or
a list of such a value and keyword arguments.
In this case, <code>run-program</code> will
create a temporary stream for the program output;
the program output, in that stream,
will be processed by a call to <code>slurp-input-stream</code>,
using <var>output</var> as the first argument
(or if it&rsquo;s a list the first element of <var>output</var> and the rest as keywords).
The primary value resulting from that call
(or <code>nil</code> if no call was needed)
will be the first value returned by <code>run-program</code>.
E.g., using <code>:output :string</code>
will have it return the entire output stream as a string.
And using <code>:output '(:string :stripped t)</code>
will have it return the same string stripped of any ending newline.
</p>
<p><var>error-output</var> is similar to <var>output</var>, except that
the resulting value is returned as the second value of <code>run-program</code>.
<code>t</code> designates the <var>*error-output*</var>.
Also <code>:output</code> means redirecting the error output to the output stream,
in which case <code>nil</code> is returned.
</p>
<p><var>input</var> is similar to <var>output</var>, except that
<code>vomit-output-stream</code> is used, no value is returned,
and <code>t</code> designates the <var>*standard-input*</var>.
</p>
<p><code>element-type</code> and <code>external-format</code> are passed on
to your Lisp implementation, when applicable, for creation of the output stream.
</p>
<p>One and only one of the stream slurping or vomiting may or may not happen
in parallel in parallel with the subprocess,
depending on options and implementation,
and with priority being given to output processing.
Other streams are completely produced or consumed
before or after the subprocess is spawned, using temporary files.
</p>
<p><code>force-shell</code> forces evaluation of the command through a shell,
even if it was passed as a list rather than a string.
If a shell is used, it is <samp>/bin/sh</samp> on Unix or <samp>CMD.EXE</samp> on Windows,
except on implementations that (erroneously, IMNSHO)
insist on consulting <code>$SHELL</code> like clisp.
</p>
<p><code>ignore-error-status</code> causes <code>run-program</code>
to not raise an error if the spawned program exits in error.
Following POSIX convention, an error is anything but
a normal exit with status code zero.
By default, an error of type <code>subprocess-error</code> is raised in this case.
</p>
<p><code>run-program</code> works on all platforms supported by ASDF, except Genera.
See the source code for more documentation.
</p>
</dd></dl>

<dl>
<dt><a name="index-slurp_002dinput_002dstream"></a>Function: <strong>slurp-input-stream</strong> <em>processor input-stream &amp;key</em></dt>
<dd>
<p><code>slurp-input-stream</code> is a generic function of two arguments, a target object and an input stream,
and accepting keyword arguments.
Predefined methods based on the target object are as follows:
</p>
<ul>
<li> If the object is a function, the function is called with the stream as argument.

</li><li> If the object is a cons, its first element is applied to its rest appended by
a list of the input stream.

</li><li> If the object is an output stream, the contents of the input stream are copied to it.
If the <var>linewise</var> keyword argument is provided, copying happens line by line,
and an optional <var>prefix</var> is printed before each line.
Otherwise, copying happen based on a buffer of size <var>buffer-size</var>,
using the specified <var>element-type</var>.

</li><li> If the object is <code>'string</code> or <code>:string</code>, the content is captured into a string.
Accepted keywords include the <var>element-type</var> and a flag <var>stripped</var>,
which when true causes any single line ending to be removed as per <code>uiop:stripln</code>.

</li><li> If the object is <code>:lines</code>, the content is captured as a list of strings,
one per line, without line ending. If the <var>count</var> keyword argument is provided,
it is a maximum count of lines to be read.

</li><li> If the object is <code>:line</code>, the content is captured as with <code>:lines</code> above,
and then its sub-object is extracted with the <var>at</var> argument,
which defaults to <code>0</code>, extracting the first line.
A number will extract the corresponding line.
See the documentation for <code>uiop:access-at</code>.

</li><li> If the object is <code>:forms</code>, the content is captured as a list of s-expressions,
as read by the Lisp reader.
If the <var>count</var> argument is provided,
it is a maximum count of lines to be read.
We recommend you control the syntax with such macro as
<code>uiop:with-safe-io-syntax</code>.

</li><li> If the object is <code>:form</code>, the content is captured as with <code>:forms</code> above,
and then its sub-object is extracted with the <var>at</var> argument,
which defaults to <code>0</code>, extracting the first form.
A number will extract the corresponding form.
See the documentation for <code>uiop:access-at</code>.
We recommend you control the syntax with such macro as
<code>uiop:with-safe-io-syntax</code>.
</li></ul>
</dd></dl>


<hr>
<a name="g_t_6700_65b0_7248_3092_624b_306b_5165_308c_308b"></a>
<a name="Zui-Xin-Ban-woShou-niRu-reru"></a>
<h2 class="chapter">12 最新版を手に入れる</h2>

<p>まずはどのバージョンが欲しいか決めましょう。開発は<code>master</code>ブランチで行われており、<code>HEAD</code>は最新のバグフィックスとポータビリティの修正を含んでいて、たいてい使えます。また、我々は（限られた）テストスイートも備えてはいます。しかし、リグレッションが起こることはあります。
</p>
<p>用心深い人は<code>release</code>ブランチを使うべきでしょう。たいていの場合、このブランチはより多くのテストがなされていますし、リリースは既知の解決されていないイシューがなくなったタイミングでカットされるからです。
</p>
<p>ASDFのソースリポジトリはgitを使って得られます: <kbd>git clone https://gitlab.common-lisp.net/asdf/asdf.git</kbd>
</p>
<p>上で述べたタグはこのリポジトリに見つかるでしょう。また、リポジトリは<a href="https://gitlab.common-lisp.net/asdf/asdf">https://gitlab.common-lisp.net/asdf/asdf</a>で閲覧することもできます。
</p>
<p>ASDFの開発に関する議論はメーリングリストで行われています。（→ <a href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">メーリングリスト</a>）
</p>
<hr>
<a name="FAQ"></a>
<a name="FAQ-1"></a>
<h2 class="chapter">13 FAQ</h2>


<hr>
<a name="g_t_3069_3053_306b_30d0_30b0_3092_5831_544a_3059_308c_3070_3088_3044_3067_3059_304b"></a>
<a name="dokonibaguwoBao-Gao-surebayoidesuka"></a>
<h3 class="section">13.1 どこにバグを報告すればよいですか</h3>
<a name="index-bug-tracker"></a>
<a name="index-launchpad"></a>
<p>ASDFのバグはlaunchpadにトラックされています: <a href="https://launchpad.net/asdf">https://launchpad.net/asdf</a>
</p>
<p>バグかどうかわからない場合、あるいは一般的な議論をしたい場合は、メーリングリストasdf-develを使ってください。（→ <a href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">メーリングリスト</a>）
</p>
<hr>
<a name="g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8"></a>
<a name="meringurisuto"></a>
<h3 class="section">13.2 メーリングリスト</h3>
<a name="index-mailing-list"></a>

<p>ASDFの開発に関する議論は、メーリングリスト<kbd>asdf-devel@common-lisp.net</kbd>で行われています。<a href="http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel">http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel</a>
</p>

<hr>
<a name="What-has-changed-between-ASDF-1-ASDF-2-and-ASDF-3_003f"></a>
<a name="g_t_0060_0060What-has-changed-between-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f_0027_0027"></a>
<h3 class="section">13.3 &ldquo;What has changed between ASDF 1, ASDF 2, and ASDF 3?&rdquo;</h3>

<p>We released ASDF 2.000 on May 31st 2010,
ASDF 3.0.0 on May 15th 2013,
ASDF 3.1.2 on May 6th 2014.
Releases of ASDF 2 and now ASDF 3 have since then been included
in all actively maintained CL implementations that used to bundle ASDF 1,
plus many implementations that previously did not.
ASDF has been made to work with all actively maintained CL
implementations and even a few implementations that are <em>not</em>
actively maintained.
</p>
<p>Furthermore, it is possible to upgrade from ASDF 1 to ASDF 2 or ASDF 3 on the fly
(though we recommend instead upgrading your implementation or replacing its ASDF module).
For this reason, we have stopped supporting ASDF 1 and ASDF 2.
If you are using ASDF 1 or ASDF 2 and are experiencing any kind of issues or limitations,
we recommend you upgrade to ASDF 3
&mdash; and we explain how to do that. See <a href="#ASDF_3092_30ed_30fc_30c9_3059_308b">ASDFをロードする</a>.
</p>
<p>Note that in the context of compatibility requirements,
ASDF 2.27, released on Feb 1st 2013, and further releases up to 2.33,
count as pre-releases of ASDF 3, and define the <code>:asdf3</code> feature,
though the first stable release of ASDF 3 was release 3.0.1.
Significant new or improved functionality were added in ASDF 3.1;
the <code>:asdf3.1</code> feature is present in recent enough versions to detect this functionality;
the first stable release since then was ASDF 3.1.2.
New <code>*features*</code> are only added at major milestones,
and the next one will probably be <code>:asdf3.2</code>.
</p>


<hr>
<a name="What-are-ASDF-1-2-3_003f"></a>
<a name="What-are-ASDF-1_002c-ASDF-2_002c-and-ASDF-3_003f"></a>
<h4 class="subsection">13.3.1 What are ASDF 1, ASDF 2, and ASDF 3?</h4>

<p>ASDF 1 refers to any release earlier than 1.369 or so (from August 2001 to October 2009),
and to any development revision earlier than 2.000 (May 2010).
If your copy of ASDF doesn&rsquo;t even contain version information, it&rsquo;s an old ASDF 1.
Revisions between 1.656 and 1.728 may count as development releases for ASDF 2.
</p>
<p>ASDF 2 refers to releases from 2.000 (May 31st 2010) to 2.26 (Oct 30th 2012),
and any development revision newer than ASDF 1 and older than 2.27 (Feb 1st 2013).
</p>
<p>ASDF 3 refers to releases from 2.27 (Feb 1st 2013) to 2.33 and 3.0.0 onward (May 15th 2013).
2.27 to 2.33 count as pre-releases to ASDF 3.
</p>
<p>ASDF 3.1 refers to releases from 3.1.2 (May 6th 2014) onward.
These releases are also considered part of ASDF 3.
</p>
<hr>
<a name="How-do-I-detect-the-ASDF-version_003f"></a>
<a name="How-do-I-detect-the-ASDF-version_003f-1"></a>
<h4 class="subsection">13.3.2 How do I detect the ASDF version?</h4>
<a name="index-asdf_002dversion"></a>
<a name="index-_002afeatures_002a"></a>

<p>All releases of ASDF
push <code>:asdf</code> onto <code>*features*</code>.
Releases starting with ASDF 2
push <code>:asdf2</code> onto <code>*features*</code>.
Releases starting with ASDF 3 (including 2.27 and later pre-releases)
push <code>:asdf3</code> onto <code>*features*</code>.
Furthermore, releases starting with ASDF 3.1.2 (May 2014),
though they count as ASDF 3, include enough progress that they
also push <code>:asdf3.1</code> onto <code>*features*</code>.
You may depend on the presence or absence of these features
to write code that takes advantage of recent ASDF functionality
but still works on older versions, or at least detects the old version and signals an error.
</p>
<p>Additionally, all releases starting with ASDF 2
define a function <code>(asdf:asdf-version)</code> you may use to query the version.
All releases starting with 2.013 display the version number prominently
on the second line of the <samp>asdf.lisp</samp> source file.
</p>
<p>If you are experiencing problems or limitations of any sort with ASDF 1 or ASDF 2,
we recommend that you should upgrade to the latest release, be it ASDF 3 or other.
</p>
<p>Finally, here is a code snippet to programmatically determine what version of ASDF is loaded, if any,
that works on all versions including very old ones:
</p>
<div class="lisp">
<pre class="lisp">(when (find-package :asdf)
  (let ((ver (symbol-value
                   (or (find-symbol (string :*asdf-version*) :asdf)
                       (find-symbol (string :*asdf-revision*) :asdf)))))
    (etypecase ver
      (string ver)
      (cons (with-output-to-string (s)
              (loop for (n . m) on ver
                    do (princ n s)
                       (when m (princ &quot;.&quot; s)))))
      (null &quot;1.0&quot;))))
</pre></div>

<p>If it returns <code>nil</code> then ASDF is not installed.
Otherwise it should return a string.
If it returns <code>&quot;1.0&quot;</code>, then it can actually be
any version before 1.77 or so, or some buggy variant of 1.x.
If it returns anything older than <code>&quot;3.0.1&quot;</code>,
you really need to upgrade your implementation or at least upgrade its ASDF.
See <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>.
</p>


<hr>
<a name="ASDF-can-portably-name-files-in-subdirectories"></a>
<a name="ASDF-can-portably-name-files-in-subdirectories-1"></a>
<h4 class="subsection">13.3.3 ASDF can portably name files in subdirectories</h4>

<p>Common Lisp namestrings are not portable,
except maybe for logical pathname namestrings,
that themselves have various limitations and require a lot of setup
that is itself ultimately non-portable.
</p>
<p>In ASDF 1, the only portable ways to refer to pathnames inside systems and components
were very awkward, using <code>#.(make-pathname ...)</code> and
<code>#.(merge-pathnames ...)</code>.
Even the above were themselves were inadequate in the general case
due to host and device issues, unless horribly complex patterns were used.
Plenty of simple cases that looked portable actually weren&rsquo;t,
leading to much confusion and greavance.
</p>
<p>ASDF 2 implements its own portable syntax for strings as pathname specifiers.
Naming files within a system definition becomes easy and portable again.
See <a href="#Miscellaneous-additional-functionality">system-relative-pathname</a>,
<code>merge-pathnames*</code>,
<code>coerce-pathname</code>.
</p>
<p>On the other hand, there are places where systems used to accept namestrings
where you must now use an explicit pathname object:
<code>(defsystem ... :pathname &quot;LOGICAL-HOST:PATH;TO;SYSTEM;&quot; ...)</code>
must now be written with the <code>#p</code> syntax:
<code>(defsystem ... :pathname #p&quot;LOGICAL-HOST:PATH;TO;SYSTEM;&quot; ...)</code>
</p>
<p>See <a href="#g_t_30d1_30b9_540d_6307_5b9a_5b50">パス名指定子</a>.
</p>

<hr>
<a name="Output-translations"></a>
<a name="Output-translations-1"></a>
<h4 class="subsection">13.3.4 Output translations</h4>

<p>A popular feature added to ASDF was output pathname translation:
<code>asdf-binary-locations</code>, <code>common-lisp-controller</code>,
<code>cl-launch</code> and other hacks were all implementing it in ways
both mutually incompatible and difficult to configure.
</p>
<p>Output pathname translation is essential to share
source directories of portable systems across multiple implementations
or variants thereof,
or source directories of shared installations of systems across multiple users,
or combinations of the above.
</p>
<p>In ASDF 2, a standard mechanism is provided for that,
<code>asdf-output-translations</code>,
with sensible defaults, adequate configuration languages,
a coherent set of configuration files and hooks,
and support for non-Unix platforms.
</p>
<p>See <a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a>.
</p>
<hr>
<a name="Source-Registry-Configuration"></a>
<a name="Source-Registry-Configuration-1"></a>
<h4 class="subsection">13.3.5 Source Registry Configuration</h4>

<p>Configuring ASDF used to require special magic
to be applied just at the right moment,
between the moment ASDF is loaded and the moment it is used,
in a way that is specific to the user,
the implementation he is using and the application he is building.
</p>
<p>This made for awkward configuration files and startup scripts
that could not be shared between users, managed by administrators
or packaged by distributions.
</p>
<p>ASDF 2 provides a well-documented way to configure ASDF,
with sensible defaults, adequate configuration languages,
and a coherent set of configuration files and hooks.
</p>
<p>We believe it&rsquo;s a vast improvement because it decouples
application distribution from library distribution.
The application writer can avoid thinking where the libraries are,
and the library distributor (dpkg, clbuild, advanced user, etc.)
can configure them once and for every application.
Yet settings can be easily overridden where needed,
so whoever needs control has exactly as much as required.
</p>
<p>At the same time, ASDF 2 remains compatible
with the old magic you may have in your build scripts
(using <code>*central-registry*</code> and
<code>*system-definition-search-functions*</code>)
to tailor the ASDF configuration to your build automation needs,
and also allows for new magic, simpler and more powerful magic.
</p>
<p>See <a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがシステムを探す場所を設定する</a>.
</p>

<hr>
<a name="Usual-operations-are-made-easier-to-the-user"></a>
<a name="Usual-operations-are-made-easier-to-the-user-1"></a>
<h4 class="subsection">13.3.6 Usual operations are made easier to the user</h4>

<p>In ASDF 1, you had to use the awkward syntax
<code>(asdf:oos 'asdf:load-op :foo)</code>
to load a system,
and similarly for <code>compile-op</code>, <code>test-op</code>.
</p>
<p>In ASDF 2, you can use shortcuts for the usual operations:
<code>(asdf:load-system :foo)</code>, and
similarly for <code>compile-system</code>, <code>test-system</code>.
</p>

<hr>
<a name="Many-bugs-have-been-fixed"></a>
<a name="Many-bugs-have-been-fixed-1"></a>
<h4 class="subsection">13.3.7 Many bugs have been fixed</h4>

<p>The following issues and many others have been fixed:
</p>
<ul>
<li> The infamous TRAVERSE function has been revamped completely
between ASDF 1 and ASDF 2, with many bugs squashed.
In particular, dependencies were not correctly propagated
across modules but now are.
It has been completely rewritten many times over
between ASDF 2.000 and ASDF 3,
with fundamental issues in the original model being fixed.
Timestamps were not propagated at all, and now are.
The internal model of how actions depend on each other
is now both consistent and complete.
The <code>:version</code> and
the <code>:force (system1 .. systemN)</code> feature have been fixed.

</li><li> Performance has been notably improved for large systems
(say with thousands of components) by using
hash-tables instead of linear search,
and linear-time list accumulation instead of cubic time recursive append,
for an overall <em>O(n)</em> complexity vs <em>O(n^4)</em>.

</li><li> Many features used to not be portable,
especially where pathnames were involved.
Windows support was notably quirky because of such non-portability.

</li><li> The internal test suite used to massively fail on many implementations.
While still incomplete, it now fully passes
on all implementations supported by the test suite,
though some tests are commented out on a few implementations.

</li><li> Support was lacking for some implementations.
ABCL and GCL were notably wholly broken.
ECL extensions were not integrated with ASDF release.

</li><li> The documentation was grossly out of date.

</li></ul>


<hr>
<a name="ASDF-itself-is-versioned"></a>
<a name="ASDF-itself-is-versioned-1"></a>
<h4 class="subsection">13.3.8 ASDF itself is versioned</h4>

<p>Between new features, old bugs fixed, and new bugs introduced,
there were various releases of ASDF in the wild,
and no simple way to check which release had which feature set.
People using or writing systems had to either make worst-case assumptions
as to what features were available and worked,
or take great pains to have the correct version of ASDF installed.
</p>
<p>With ASDF 2, we provide a new stable set of working features
that everyone can rely on from now on.
Use <code>#+asdf2</code> to detect presence of ASDF 2,
<code>(asdf:version-satisfies (asdf:asdf-version) &quot;2.345.67&quot;)</code>
to check the availability of a version no earlier than required.
</p>

<hr>
<a name="ASDF-can-be-upgraded"></a>
<a name="ASDF-can-be-upgraded-1"></a>
<h4 class="subsection">13.3.9 ASDF can be upgraded</h4>

<p>When an old version of ASDF was loaded,
it was very hard to upgrade ASDF in your current image
without breaking everything.
Instead you had to exit the Lisp process and
somehow arrange to start a new one from a simpler image.
Something that can&rsquo;t be done from within Lisp,
making automation of it difficult,
which compounded with difficulty in configuration,
made the task quite hard.
Yet as we saw before, the task would have been required
to not have to live with the worst case or non-portable
subset of ASDF features.
</p>
<p>With ASDF 2, it is easy to upgrade
from ASDF 2 to later versions from within Lisp,
and not too hard to upgrade from ASDF 1 to ASDF 2 from within Lisp.
We support hot upgrade of ASDF and any breakage is a bug
that we will do our best to fix.
There are still limitations on upgrade, though,
most notably the fact that after you upgrade ASDF,
you must also reload or upgrade all ASDF extensions.
</p>
<hr>
<a name="Decoupled-release-cycle"></a>
<a name="Decoupled-release-cycle-1"></a>
<h4 class="subsection">13.3.10 Decoupled release cycle</h4>

<p>When vendors were releasing their Lisp implementations with ASDF,
they had to basically never change version
because neither upgrade nor downgrade was possible
without breaking something for someone,
and no obvious upgrade path was visible and recommendable.
</p>
<p>With ASDF 2, upgrade is possible, easy and can be recommended.
This means that vendors can safely ship a recent version of ASDF,
confident that if a user isn&rsquo;t fully satisfied,
he can easily upgrade ASDF and deal
with a supported recent version of it.
This means that release cycles will be causally decoupled,
the practical consequence of which will mean faster convergence
towards the latest version for everyone.
</p>

<hr>
<a name="Pitfalls-of-the-transition-to-ASDF-2"></a>
<a name="Pitfalls-of-the-transition-to-ASDF-2-1"></a>
<h4 class="subsection">13.3.11 Pitfalls of the transition to ASDF 2</h4>

<p>The main pitfalls in upgrading to ASDF 2 seem to be related
to the output translation mechanism.
</p>
<ul>
<li> Output translations is enabled by default. This may surprise some users,
most of them in pleasant way (we hope), a few of them in an unpleasant way.
It is trivial to disable output translations.
See <a href="#FAQ">&ldquo;How can I wholly disable the compiler output cache?&rdquo;</a>.

</li><li> Some systems in the large have been known
not to play well with output translations.
They were relatively easy to fix.
Once again, it is also easy to disable output translations,
or to override its configuration.

</li><li> The new ASDF output translations are incompatible with ASDF-Binary-Locations.
They replace A-B-L, and there is compatibility mode to emulate
your previous A-B-L configuration.
See <code>enable-asdf-binary-locations-compatibility</code> in
see <a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">Backward Compatibility</a>.
But thou shalt not load ABL on top of ASDF 2.

</li></ul>

<p>Other issues include the following:
</p>
<ul>
<li> ASDF pathname designators are now specified
in places where they were unspecified,
and a few small adjustments have to be made to some non-portable defsystems.
Notably, in the <code>:pathname</code> argument
to a <code>defsystem</code> and its components,
a logical pathname (or implementation-dependent hierarchical pathname)
must now be specified with <code>#p</code> syntax
where the namestring might have previously sufficed;
moreover when evaluation is desired <code>#.</code> must be used,
where it wasn&rsquo;t necessary in the toplevel <code>:pathname</code> argument
(but necessary in other <code>:pathname</code> arguments).

</li><li> There is a slight performance bug, notably on SBCL,
when initially searching for <samp>asd</samp> files,
the implicit <code>(directory &quot;/configured/path/**/*.asd&quot;)</code>
for every configured path <code>(:tree &quot;/configured/path/&quot;)</code>
in your <code>source-registry</code> configuration can cause a slight pause.
Try to <code>(time (asdf:initialize-source-registry))</code>
to see how bad it is or isn&rsquo;t on your system.
If you insist on not having this pause,
you can avoid the pause by overriding the default source-registry configuration
and not use any deep <code>:tree</code> entry but only <code>:directory</code> entries
or shallow <code>:tree</code> entries.
Or you can fix your implementation to not be quite that slow
when recursing through directories.
<em>Update</em>: This performance bug fixed the hard way in 2.010.

</li><li> On Windows, only LispWorks supports proper default configuration pathnames
based on the Windows registry.
Other implementations make do with environment variables,
that you may have to define yourself
if you&rsquo;re using an older version of Windows.
Windows support is somewhat less tested than Unix support.
Please help report and fix bugs.
<em>Update</em>: As of ASDF 2.21, all implementations
should now use the same proper default configuration pathnames
and they should actually work, though they haven&rsquo;t all been tested.

</li><li> The mechanism by which one customizes a system so that Lisp files
may use a different extension from the default <samp>.lisp</samp> has changed.
Previously, the pathname for a component
was lazily computed when operating on a system,
and you would
<code>(defmethod source-file-type ((component cl-source-file) (system (eql (find-system 'foo))))
  (declare (ignorable component system)) &quot;lis&quot;)</code>.
Now, the pathname for a component is eagerly computed when defining the system,
and instead you will <code>(defclass cl-source-file.lis (cl-source-file) ((type :initform &quot;lis&quot;)))</code>
and use <code>:default-component-class cl-source-file.lis</code>
as argument to <code>defsystem</code>,
as detailed in a see <a href="#FAQ">How do I create a system definition where all the source files have a .cl extension?</a> below.
<code>source-file-type</code> is deprecated.  To access a component&rsquo;s
file-type, use <code>file-type</code>, instead.  <code>source-file-type</code> will
be removed.

<a name="index-source_002dfile_002dtype"></a>
<a name="index-file_002dtype"></a>

</li></ul>


<hr>
<a name="Pitfalls-of-the-upgrade-to-ASDF-3"></a>
<a name="Pitfalls-of-the-upgrade-to-ASDF-3-1"></a>
<h4 class="subsection">13.3.12 Pitfalls of the upgrade to ASDF 3</h4>

<p>While ASDF 3 is largely compatible with ASDF 2,
there are a few pitfalls when upgrading from ASDF 2,
due to limitations in ASDF 2.
</p>
<ul>
<li> ASDF 2 was designed so it could be upgraded;
but upgrading it required a special setup at the beginning of your build files.
Failure to upgrade it early could result in catastrophic attempt to self-upgrade in mid-build.

</li><li> Starting with ASDF 3 (2.27 or later),
ASDF will automatically attempt to upgrade itself
as the first step before any system operation,
to avoid any possibility of such catastrophic mid-build self-upgrade.
But that doesn&rsquo;t help if your old implementation still provides ASDF 2.

</li><li> It was unsafe in ASDF 2 for a system definition to declare a dependency on ASDF,
since it could trigger such catastrophe for users who were not carefully configured.
If you declare a dependency on a recent enough ASDF,
yet want to be nice with these potentially misconfigured users,
we recommend that you not only specify a recent ASDF in your dependencies with
<code>:depends-on ((:version &quot;asdf&quot; &quot;3.1.2&quot;))</code>,
but that you <em>also</em> check that ASDF 3 is installed,
or else the upgrade catastrophe might happen before that specification is checked,
by starting your <samp>.asd</samp> file with a version check as follows:
<div class="example">
<pre class="example">#-asdf3 (error &quot;<var>MY-SYSTEM</var> requires ASDF 3.1.2&quot;)
</pre></div>

</li><li> When you upgrade from too old a version of ASDF,
previously loaded ASDF extensions become invalid, and will need to be reloaded.
Example extensions include CFFI-Grovel, hacks used by ironclad, etc.
Since it isn&rsquo;t possible to automatically detect what extensions
need to be invalidated and what systems use them,
ASDF will invalidate <em>all</em> previously loaded systems
when it is loaded on top of a forward-incompatible ASDF version.
<a name="DOCF53" href="#FOOT53"><sup>53</sup></a>

</li><li> To write a portable build script, you need to rely on a recent version of UIOP,
but until you have ensured a recent ASDF is loaded,
you can&rsquo;t rely on UIOP being present,
and thus must manually avoid all the pathname pitfalls when loading ASDF itself.

</li><li> Bugs in CMUCL and XCL prevent upgrade of ASDF from an old forward-incompatible version.
Happily, CMUCL comes with a recent ASDF,
and XCL is more of a working demo than something you&rsquo;d use seriously anyway.

</li><li> For the above reasons, your build and startup scripts
should load ASDF 3, configure it, and upgrade it,
among the very first things they do.
They should ensure that only ASDF 3 or later is used indeed,
and error out if ASDF 2 or earlier was used.

</li><li> Now that (since May 2016) all maintained implementations
(i.e. having had at least one release since 2014,
or a commit on their public source code repository)
provide ASDF 3.1 or later,
the simple solution is just to use code as below in your setup,
and when it fails, upgrade your implementation or replace its ASDF.
(see <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>):
<div class="example">
<pre class="example">(require &quot;asdf&quot;)
#-asdf3.1 (error &quot;ASDF 3.1 or bust&quot;)
</pre></div>

</li><li> For scripts that try to use ASDF simply via <code>require</code> at first, and
make heroic attempts to load it the hard way if at first they don&rsquo;t succeed,
see <samp>tools/load-asdf.lisp</samp> distributed with the ASDF source repository,
or the code of <a href="https://cliki.net/cl-launch"><code>cl-launch</code></a>.

</li><li> <a name="reinitializeASDFAfterUpgrade"></a>Note that in addition to the pitfalls and constraints above,
these heroic scripts (should you wish to write or modify one),
must take care to configure ASDF <em>twice</em>.
A first time, right after you load the old ASDF 2 (or 1!)
and before you upgrade to the new ASDF 3,
so it may find where you put ASDF 3.
A second time, because most implementations can&rsquo;t handle a smooth upgrade from ASDF 2 to ASDF 3,
so ASDF 3 doesn&rsquo;t try (anymore) and loses any configuration from ASDF 2.
<div class="lisp">
<pre class="lisp">(ignore-errors (funcall 'require &quot;asdf&quot;)) ;; &lt;--- try real hard
;; &lt;--- insert heroics here, if that failed to provide ASDF 2 or 3
;; &lt;--- insert configuration here, if that succeeded
(asdf:load-system &quot;asdf&quot;)
;; &lt;--- re-configure here, too, in case at first you got ASDF 2
</pre></div>

</li></ul>


<hr>
<a name="What-happened-to-the-bundle-operations"></a>
<a name="What-happened-to-the-bundle-operations_003f"></a>
<h4 class="subsection">13.3.13 What happened to the bundle operations?</h4>

<a name="index-fasl_002dop-_0028obsolete_0029"></a>
<a name="index-load_002dfasl_002dop-_0028obsolete_0029"></a>
<a name="index-binary_002dop-_0028obsolete_0029"></a>
<a name="index-monolithic_002dfasl_002dop-_0028obsolete_0029"></a>
<a name="index-monolithic_002dload_002dfasl_002dop-_0028obsolete_0029"></a>
<a name="index-monolithic_002dbinary_002dop-_0028obsolete_0029"></a>
<a name="index-compile_002dbundle_002dop-1"></a>
<a name="index-load_002dbundle_002dop-1"></a>
<a name="index-deliver_002dasd_002dop-1"></a>
<a name="index-monolithic_002dcompile_002dbundle_002dop-1"></a>
<a name="index-monolithic_002dload_002dbundle_002dop-1"></a>
<a name="index-monolithic_002ddeliver_002dasd_002dop-1"></a>

<p><code>asdf-ecl</code> and its short-lived successor <code>asdf-bundle</code> are no more,
having been replaced by code now built into ASDF 3.
Moreover, the name of the bundle operations has changed since ASDF 3.1.3.
Starting with ASDF 3.2.0, <code>load-system</code>
will once again use <code>load-bundle-op</code> instead of <code>load-op</code> on ECL,
as originally intended by <code>asdf-ecl</code> authors, but disabled for a long time
due to bugs in both ECL and ASDF.
</p>
<p>Note that some of the bundle operations were renamed after ASDF 3.1.3,
and the old names have been removed.
Old bundle operations, and their modern equivalents are:
</p>
<ul>
<li> <code>fasl-op</code> is now <code>compile-bundle-op</code>
</li><li> <code>load-fasl-op</code> is now <code>load-bundle-op</code>
</li><li> <code>binary-op</code> is now <code>deliver-asd-op</code>
</li><li> <code>monolithic-fasl-op</code> is now <code>monolithic-compile-bundle-op</code>
</li><li> <code>monolithic-load-fasl-op</code> is now <code>monolithic-load-bundle-op</code>
</li><li> <code>monolithic-binary-op</code> is now <code>monolithic-deliver-asd-op</code>
</li></ul>



<hr>
<a name="Issues-with-installing-the-proper-version-of-ASDF"></a>
<a name="Issues-with-installing-the-proper-version-of-ASDF-1"></a>
<h3 class="section">13.4 Issues with installing the proper version of ASDF</h3>


<hr>
<a name="My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f"></a>
<a name="g_t_0060_0060My-Common-Lisp-implementation-comes-with-an-outdated-version-of-ASDF_002e-What-to-do_003f_0027_0027"></a>
<h4 class="subsection">13.4.1 &ldquo;My Common Lisp implementation comes with an outdated version of ASDF. What to do?&rdquo;</h4>

<p>If you have a recent implementation, it should already come with ASDF 3 or later.
If you need a more recent version than is provided,
we recommend you simply upgrade ASDF by installing a recent version
in a path configured in your source-registry.
See <a href="#ASDF_3092_30a2_30c3_30d7_30b0_30ec_30fc_30c9_3059_308b">ASDFをアップグレードする</a>.
</p>
<p>If you have an old implementation that does not provide ASDF 3,
we recommend you replace your implementation&rsquo;s ASDF.
See <a href="#g_t_51e6_7406_7cfb_4ed8_5c5e_306eASDF_3092_7f6e_304d_63db_3048_308b">処理系付属のASDFを置き換える</a>.
</p>

<hr>
<a name="I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f"></a>
<a name="g_t_0060_0060I_0027m-a-Common-Lisp-implementation-vendor_002e-When-and-how-should-I-upgrade-ASDF_003f_0027_0027"></a>
<h4 class="subsection">13.4.2 &ldquo;I&rsquo;m a Common Lisp implementation vendor. When and how should I upgrade ASDF?&rdquo;</h4>

<p>Since ASDF 2,
it should always be a good time to upgrade to a recent version of ASDF.
You may consult with the maintainer for which specific version they recommend,
but the latest <code>release</code> should be correct.
Though we do try to test ASDF releases against all implementations that we can,
we may not be testing against all variants of your implementation,
and we may not be running enough tests;
we trust you to thoroughly test it with your own implementation
before you release it.
If there are any issues with the current release,
it&rsquo;s a bug that you should report upstream and that we will fix ASAP.
</p>
<p>As to how to include ASDF, we recommend the following:
</p>
<ul>
<li> If ASDF isn&rsquo;t loaded yet, then <code>(require &quot;asdf&quot;)</code>
should load the version of ASDF that is bundled with your system.
If possible so should <code>(require &quot;ASDF&quot;)</code>.
You may have it load some other version configured by the user,
if you allow such configuration.

</li><li> If your system provides a mechanism to hook into <code>cl:require</code>,
then it would be nice to add ASDF to this hook the same way that
ABCL, CCL, CLISP, CMUCL, ECL, SBCL and SCL do it.
Please send us appropriate code to this end.

</li><li> You may, like SBCL since 1.1.13 or MKCL since 1.1.9,
have ASDF create bundle FASLs
that are provided as modules by your Lisp distribution.
You may also, but we don&rsquo;t recommend that anymore,
as in SBCL up until 1.1.12, have ASDF be implicitly used
to <code>cl:require</code> these modules that are provided by your Lisp distribution;
if you do, you should add these modules in the beginning of both
<code>wrapping-source-registry</code> and <code>wrapping-output-translations</code>.

</li><li> If you have magic systems as above, like SBCL used to do,
then we explicitly ask you to <em>NOT</em> distribute
<samp>asdf.asd</samp> as part of those magic systems.
You should still include the file <samp>asdf.lisp</samp> in your source distribution
and precompile it in your binary distribution,
but <samp>asdf.asd</samp> if included at all,
should be secluded from the magic systems,
in a separate file hierarchy.
Alternatively, you may provide the system
after renaming it and its <samp>.asd</samp> file to e.g.
<code>asdf-ecl</code> and <samp>asdf-ecl.asd</samp>, or
<code>sb-asdf</code> and <samp>sb-asdf.asd</samp>.
Indeed, if you made <samp>asdf.asd</samp> a magic system,
then users would no longer be able to upgrade ASDF using ASDF itself
to some version of their preference that
they maintain independently from your Lisp distribution.

</li><li> If you do not have any such magic systems, or have other non-magic systems
that you want to bundle with your implementation,
then you may add them to the <code>wrapping-source-registry</code>,
and you are welcome to include <samp>asdf.asd</samp> amongst them.
Non-magic systems should be at the back of the <code>wrapping-source-registry</code>
while magic systems are at the front.
If they are precompiled,
they should also be in the <code>wrapping-output-translations</code>.

</li><li> Since ASDF 3, the library UIOP comes transcluded in ASDF.
But if you want to be nice to users who care for UIOP but not for ASDF,
you may package UIOP separately,
so that one may <code>(require &quot;uiop&quot;)</code> and not load ASDF,
or one may <code>(require &quot;asdf&quot;)</code>
which would implicitly require and load the former.

</li><li> Please send us upstream any patches you make to ASDF itself,
so we can merge them back in for the benefit of your users
when they upgrade to the upstream version.

</li></ul>

<hr>
<a name="After-upgrading-ASDF"></a>
<a name="After-upgrading-ASDF_002c-ASDF-_0028and-Quicklisp_0029-can_0027t-find-my-systems"></a>
<h4 class="subsection">13.4.3 After upgrading ASDF, ASDF (and Quicklisp) can&rsquo;t find my systems</h4>
<a name="index-_002acentral_002dregistry_002a"></a>
<a name="index-Quicklisp"></a>

<p>When you upgrade the ASDF running in your Lisp image
from an ancient ASDF 2 or older to ASDF 3 or newer,
then you may have to re-configure ASDF.
If your configuration only consists in
using the source-registry and output-translations (as it should),
and if you are not explicitly calling <code>asdf:initialize-source-registry</code>
or <code>asdf:initialize-output-translations</code> with a non-nil argument,
then ASDF will reconfigure itself.
Otherwise, you will have to configure ASDF 2 (or older) to find ASDF 3,
then configure ASDF 3.
Notably, <var>*central-registry*</var> is not maintained across upgrades from ASDF 2.
See <a href="#reinitializeASDFAfterUpgrade">note about ASDF reconfiguration after upgrade</a>.
</p>
<p>Problems like this may be experienced if one loads Quicklisp
(which as of this writing bundles an obsolete ASDF version 2.26),
upgrades ASDF, and then tries to load new systems.
The correct solution is to load the most up-to-date ASDF you can,
<em>then</em> configure it, <em>then</em> load Quicklisp and any other extension.
Do <em>not</em> try to upgrade from ASDF 2 <em>after</em> loading Quicklisp,
for it will leave both ASDF and Quicklisp badly misconfigured.
For details see the discussion at the above cross-reference.
</p>
<p>Also, if you are experiencing such failures due to Quicklisp shipping an ancient ASDF,
please complain to Zach Beane about it.
</p>

<hr>
<a name="Issues-with-configuring-ASDF"></a>
<a name="Issues-with-configuring-ASDF-1"></a>
<h3 class="section">13.5 Issues with configuring ASDF</h3>


<hr>
<a name="How-can-I-customize-where-fasl-files-are-stored_003f"></a>
<a name="g_t_0060_0060How-can-I-customize-where-fasl-files-are-stored_003f_0027_0027"></a>
<h4 class="subsection">13.5.1 &ldquo;How can I customize where fasl files are stored?&rdquo;</h4>

<p>See <a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a>.
</p>
<p>Note that in the past there was an add-on to ASDF called
<code>ASDF-binary-locations</code>, developed by Gary King.
That add-on has been merged into ASDF proper,
then superseded by the <code>asdf-output-translations</code> facility.
</p>
<p>Note that use of <code>asdf-output-translations</code>
can interfere with one aspect of your systems
&mdash; if your system uses <code>*load-truename*</code> to find files
(e.g., if you have some data files stored with your program),
then the relocation that this ASDF customization performs
is likely to interfere.
Use <code>asdf:system-relative-pathname</code> to locate a file
in the source directory of some system, and
use <code>asdf:apply-output-translations</code> to locate a file
whose pathname has been translated by the facility.
</p>
<hr>
<a name="How-can-I-wholly-disable-the-compiler-output-cache_003f"></a>
<a name="g_t_0060_0060How-can-I-wholly-disable-the-compiler-output-cache_003f_0027_0027"></a>
<h4 class="subsection">13.5.2 &ldquo;How can I wholly disable the compiler output cache?&rdquo;</h4>

<p>To permanently disable the compiler output cache
for all future runs of ASDF, you can:
</p>
<div class="example">
<pre class="example">mkdir -p ~/.config/common-lisp/asdf-output-translations.conf.d/
echo ':disable-cache' &gt; \
~/.config/common-lisp/asdf-output-translations.conf.d/99-disable-cache.conf
</pre></div>

<p>This assumes that you didn&rsquo;t otherwise configure the ASDF files
(if you did, edit them again),
and don&rsquo;t somehow override the configuration at runtime
with a shell variable (see below) or some other runtime command
(e.g. some call to <code>asdf:initialize-output-translations</code>).
</p>
<p>To disable the compiler output cache in Lisp processes
run by your current shell, try (assuming <code>bash</code> or <code>zsh</code>)
(on Unix and cygwin only):
</p>
<div class="example">
<pre class="example">export ASDF_OUTPUT_TRANSLATIONS=/:
</pre></div>

<p>To disable the compiler output cache just in the current Lisp process,
use (after loading ASDF but before using it):
</p>
<div class="example">
<pre class="example">(asdf:disable-output-translations)
</pre></div>

<p>Note that this does <em>NOT</em> belong in a <samp>.asd</samp> file.
Please do not tamper with ASDF configuration from a <samp>.asd</samp> file,
and only do this from your personal configuration or build scripts.
</p>
<hr>
<a name="Issues-with-using-and-extending-ASDF-to-define-systems"></a>
<a name="Issues-with-using-and-extending-ASDF-to-define-systems-1"></a>
<h3 class="section">13.6 Issues with using and extending ASDF to define systems</h3>


<hr>
<a name="How-can-I-cater-for-unit_002dtesting-in-my-system_003f"></a>
<a name="g_t_0060_0060How-can-I-cater-for-unit_002dtesting-in-my-system_003f_0027_0027"></a>
<h4 class="subsection">13.6.1 &ldquo;How can I cater for unit-testing in my system?&rdquo;</h4>

<p>ASDF provides a predefined test operation, <code>test-op</code>.
See <a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">test-op</a>.
The test operation, however, is largely left to the system definer to specify.
<code>test-op</code> has been
a topic of considerable discussion on the
<a href="http://common-lisp.net/cgi-bin/mailman/listinfo/asdf-devel">asdf-devel mailing list</a>
(see <a href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">メーリングリスト</a>),
and on the
<a href="https://launchpad.net/asdf">launchpad bug-tracker</a> (see <a href="#g_t_3069_3053_306b_30d0_30b0_3092_5831_544a_3059_308c_3070_3088_3044_3067_3059_304b">どこにバグを報告すればよいですか</a>).
We provide some guidelines in the discussion of <code>test-op</code>.
</p>







<hr>
<a name="How-can-I-cater-for-documentation-generation-in-my-system_003f"></a>
<a name="g_t_0060_0060How-can-I-cater-for-documentation-generation-in-my-system_003f_0027_0027"></a>
<h4 class="subsection">13.6.2 &ldquo;How can I cater for documentation generation in my system?&rdquo;</h4>

<p>Various ASDF extensions provide some kind of <code>doc-op</code> operation.
See also <a href="https://bugs.launchpad.net/asdf/+bug/479470">https://bugs.launchpad.net/asdf/+bug/479470</a>.
</p>

<hr>
<a name="How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f"></a>
<a name="g_t_0060_0060How-can-I-maintain-non_002dLisp-_0028e_002eg_002e-C_0029-source-files_003f_0027_0027"></a>
<h4 class="subsection">13.6.3 &ldquo;How can I maintain non-Lisp (e.g. C) source files?&rdquo;</h4>

<p>See <code>cffi</code>&rsquo;s <code>cffi-grovel</code>.
</p>
<a name="report_002dbugs"></a>

<hr>
<a name="I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f"></a>
<a name="g_t_0060_0060I-want-to-put-my-module_0027s-files-at-the-top-level_002e-How-do-I-do-this_003f_0027_0027"></a>
<h4 class="subsection">13.6.4 &ldquo;I want to put my module&rsquo;s files at the top level.  How do I do this?&rdquo;</h4>

<p>By default, the files contained in an asdf module go
in a subdirectory with the same name as the module.
However, this can be overridden by adding a <code>:pathname &quot;&quot;</code> argument
to the module description.
For example, here is how it could be done
in the spatial-trees ASDF system definition for ASDF 2 or later:
</p>
<div class="example">
<pre class="example">(asdf:defsystem &quot;spatial-trees&quot;
  :components
  ((:module &quot;base&quot;
            :pathname &quot;&quot;
            :components
            ((:file &quot;package&quot;)
             (:file &quot;basedefs&quot; :depends-on (&quot;package&quot;))
             (:file &quot;rectangles&quot; :depends-on (&quot;package&quot;))))
   (:module tree-impls
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:file &quot;r-trees&quot;)
             (:file &quot;greene-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;rstar-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;rplus-trees&quot; :depends-on (&quot;r-trees&quot;))
             (:file &quot;x-trees&quot; :depends-on (&quot;r-trees&quot; &quot;rstar-trees&quot;))))
   (:module viz
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:static-file &quot;spatial-tree-viz.lisp&quot;)))
   (:module tests
            :depends-on (&quot;base&quot;)
            :pathname &quot;&quot;
            :components
            ((:static-file &quot;spatial-tree-test.lisp&quot;)))
   (:static-file &quot;LICENCE&quot;)
   (:static-file &quot;TODO&quot;)))
</pre></div>

<p>All of the files in the <code>tree-impls</code> module are at the top level,
instead of in a <samp>tree-impls/</samp> subdirectory.
</p>
<p>Note that the argument to <code>:pathname</code> can be either a pathname object or a string.
A pathname object can be constructed with the <samp>#p&quot;foo/bar/&quot;</samp> syntax,
but this is discouraged because the results of parsing a namestring are not portable.
A pathname can only be portably constructed with such syntax as
<code>#.(make-pathname :directory '(:relative &quot;foo&quot; &quot;bar&quot;))</code>,
and similarly the current directory can only be portably specified as
<code>#.(make-pathname :directory '(:relative))</code>.
However, as of ASDF 2, you can portably use a string to denote a pathname.
The string will be parsed as a <code>/</code>-separated path from the current directory,
such that the empty string <code>&quot;&quot;</code> denotes the current directory, and
<code>&quot;foo/bar&quot;</code> (no trailing <code>/</code> required in the case of modules)
portably denotes the same subdirectory as above.
When files are specified, the last <code>/</code>-separated component is interpreted
either as the name component of a pathname
(if the component class specifies a pathname type),
or as a name component plus optional dot-separated type component
(if the component class doesn&rsquo;t specifies a pathname type).
</p>
<hr>
<a name="How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f"></a>
<a name="How-do-I-create-a-system-definition-where-all-the-source-files-have-a-_002ecl-extension_003f-1"></a>
<h4 class="subsection">13.6.5 How do I create a system definition where all the source files have a .cl extension?</h4>

<p>Starting with ASDF 2.014.14, you may just pass
the builtin class <code>cl-source-file.cl</code> as
the <code>:default-component-class</code> argument to <code>defsystem</code>:
</p>
<div class="lisp">
<pre class="lisp">(defsystem my-cl-system
  :default-component-class cl-source-file.cl
  ...)
</pre></div>

<p>Another builtin class <code>cl-source-file.lsp</code> is offered
for files ending in <samp>.lsp</samp>.
</p>
<p>If you want to use a different extension
for which ASDF doesn&rsquo;t provide builtin support,
or want to support versions of ASDF
earlier than 2.014.14 (but later than 2.000),
you can define a class as follows:
</p>
<div class="lisp">
<pre class="lisp">;; Prologue: make sure we're using a sane package.
(defpackage :my-asdf-extension
   (:use :asdf :common-lisp)
   (:export #:cl-source-file.lis))
(in-package :my-asdf-extension)

(defclass cl-source-file.lis (cl-source-file)
  ((type :initform &quot;lis&quot;)))
</pre></div>

<p>Then you can use it as follows:
</p><div class="lisp">
<pre class="lisp">(defsystem my-cl-system
  :default-component-class my-asdf-extension:cl-source-file.lis
  ...)
</pre></div>

<p>Of course, if you&rsquo;re in the same package, e.g. in the same file,
you won&rsquo;t need to use the package qualifier before <code>cl-source-file.lis</code>.
Actually, if all you&rsquo;re doing is defining this class
and using it in the same file without other fancy definitions,
you might skip package complications:
</p>
<div class="lisp">
<pre class="lisp">(in-package :asdf)
(defclass cl-source-file.lis (cl-source-file)
   ((type :initform &quot;lis&quot;)))
(defsystem my-cl-system
  :default-component-class cl-source-file.lis
  ...)
</pre></div>

<hr>
<a name="How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f"></a>
<a name="How-do-I-mark-a-source-file-to-be-loaded-only-and-not-compiled_003f-1"></a>
<h4 class="subsection">13.6.6 How do I mark a source file to be loaded only and not compiled?</h4>

<p>There is no provision in ASDF for ensuring that
some components are always loaded as source, while others are always
compiled.
There is <code>load-source-op</code> (see <a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">load-source-op</a>),
but that is an operation to be applied to a
system as a whole, not to one or another specific source files.
While this idea often comes up in discussions,
it doesn&rsquo;t play well with either the linking model of ECL
or with various bundle operations.
In addition, the dependency model of ASDF would have to be modified incompatibly
to allow for such a trick.
</p>

<hr>
<a name="How-do-I-work-with-readtables_003f"></a>
<a name="How-do-I-work-with-readtables_003f-1"></a>
<h4 class="subsection">13.6.7 How do I work with readtables?</h4>

<a name="index-readtables"></a>

<p>It is possible to configure the lisp syntax by modifying the currently-active readtable.
However, this same readtable is shared globally by all software being compiled by ASDF,
especially since <code>load</code> and <code>compile-file</code> both bind <var>*readtable*</var>,
so that its value is the same across the build at the start of every file
(unless overridden by some <code>perform :around</code> method),
even if a file locally binds it to a different readtable during the build.
</p>
<p>Therefore, the following hygiene restrictions apply. If you don&rsquo;t abide by these restrictions,
there will be situations where your output files will be corrupted during an incremental build.
We are not trying to prescribe new restrictions for the sake of good style:
these restrictions have always applied implicitly, and
we are simply describing what they have always been.
</p>
<ul>
<li> It is forbidden to modifying any standard character or standard macro dispatch defined in the CLHS.
</li><li> No two dependencies may assign different meanings to the same non-standard character.
</li><li> Using any non-standard character while expecting the implementation to treat some way
    counts as such an assignment of meaning.
</li><li> libraries need to document these assignments of meaning to non-standard characters.
</li><li> free software libraries will register these changes on:
        <a href="http://www.cliki.net/Macro%20Characters">http://www.cliki.net/Macro%20Characters</a>
</li></ul>

<p>If you want to use readtable modifications that cannot abide by those restrictions,
you <em>must</em> create a different readtable object and set <var>*readtable*</var>
to temporarily bind it to your new readtable (which will be undone after processing the file).
</p>
<p>For that, we recommend you use system <code>named-readtables</code>
to define or combine such readtables using <code>named-readtables:defreadtable</code>
and use them using <code>named-readtables:in-readtable</code>.
Equivalently, you can use system <code>cl-syntax</code>,
that itself uses <code>named-readtables</code>,
but may someday do more with, e.g. <var>*print-pprint-dispatch*</var>.
</p>
<p>For even more advanced syntax modification beyond what a readtable can express,
you may consider either:
</p><ul>
<li> a <code>perform</code> method that compiles a constant file that contains a single form
  <code>#.*code-read-with-alternate-reader*</code> in an environment where this special variable
  was bound to the code read by your alternate reader, or
</li><li> using the system <code>reader-interception</code>.
</li></ul>

<p>Beware that it is unsafe to use ASDF from the REPL to compile or load systems
while the readtable isn&rsquo;t the shared readtable previously used to build software.
You <em>must</em> manually undo any binding of <var>*readtable*</var> at the REPL
and restore its initial value whenever you call <code>operate</code>
(via e.g. <code>load-system</code>, <code>test-system</code> or <code>require</code>)
from a REPL that is using a different readtable.
</p>
<a name="How-should-my-system-use-a-readtable-exported-by-another-system_003f"></a>
<h4 class="subsubsection">13.6.7.1 How should my system use a readtable exported by another system?</h4>

<p>Use from the <code>named-readtables</code> system the macro <code>named-readtables:in-readtable</code>.
</p>
<p>If the other system fails to use <code>named-readtables</code>, fix it and send a patch upstream.
In the day and age of Quicklisp and clbuild, there is little reason
to eschew using such an important library anymore.
</p>
<a name="How-should-my-library-make-a-readtable-available-to-other-systems_003f"></a>
<h4 class="subsubsection">13.6.7.2 How should my library make a readtable available to other systems?</h4>

<p>Use from the <code>named-readtables</code> system the macro <code>named-readtables:defreadtable</code>.
</p>
<hr>
<a name="How-can-I-capture-ASDF_0027s-output_003f"></a>
<a name="How-can-I-capture-ASDF_0027s-output_003f-1"></a>
<h4 class="subsection">13.6.8 How can I capture ASDF&rsquo;s output?</h4>

<a name="index-ASDF-output"></a>
<a name="index-Capturing-ASDF-output"></a>
<a name="index-_002astandard_002doutput_002a"></a>

<p>Output from ASDF and ASDF extensions are sent to the CL stream
<code>*standard-output*</code>, so rebinding that stream around calls to
<code>asdf:operate</code> should redirect all output from ASDF operations.
</p>
<hr>
<a name="LOAD_002dPATHNAME-has-a-weird-value"></a>
<a name="g_t_002aLOAD_002dPATHNAME_002a-and-_002aLOAD_002dTRUENAME_002a-have-weird-values_002c-help_0021"></a>
<h4 class="subsection">13.6.9 *LOAD-PATHNAME* and *LOAD-TRUENAME* have weird values, help!</h4>
<a name="index-_002aLOAD_002dPATHNAME_002a"></a>
<a name="index-_002aLOAD_002dTRUENAME_002a"></a>

<p>Conventional Common Lisp code may use <code>*LOAD-TRUENAME*</code> or <code>*LOAD-PATHNAME*</code> to find
files adjacent to source files.  This will generally <em>not</em> work in
ASDF-loaded systems.  Recall that ASDF relocates the FASL files it
builds, typically to a special cache directory.  Thus the value of
<code>*LOAD-PATHNAME*</code> and <code>*LOAD-TRUENAME*</code>  at load time, when ASDF is loading your system,
will typically be a pathname in that cache directory, and useless to you
for finding other system components.
</p>
<p>There are two ways to work around this problem:
</p><ol>
<li> <a name="index-system_002drelative_002dpathname-1"></a>
Use the <code>system-relative-pathname</code> function.  This can readily be
used from outside the system, but it is probably not good software
engineering to require a source file <em>of</em> a system to know what
system it is going to be part of.  Contained objects should not have to
know their containers.
</li><li> Store the pathname at compile time, so that you get the pathname of the
source file, which is presumably what you want.  To do this, you can
capture the value of <code>(or *compile-file-pathname* *load-truename*)</code>
(or <code>*LOAD-PATHNAME*</code>, if you prefer)
in a macro expansion or other compile-time evaluated context.

</li></ol>

<hr>
<a name="ASDF-development-FAQs"></a>
<a name="ASDF-development-FAQs-1"></a>
<h3 class="section">13.7 ASDF development FAQs</h3>


<hr>
<a name="How-do-I-run-the-tests-interactively-in-a-REPL_003f"></a>
<a name="How-do-I-run-the-tests-interactively-in-a-REPL_003f-1"></a>
<h4 class="subsection">13.7.1 How do I run the tests interactively in a REPL?</h4>

<p>This not-so-frequently asked question is primarily for ASDF developers,
but those who encounter an unexpected error in some test may be
interested, too.
</p>
<p>Here&rsquo;s the procedure for experimenting with tests in a REPL:
</p><div class="example">
<pre class="example">;; BEWARE! Some tests expect you to be in the .../asdf/test directory
;; If your REPL is not there yet, change your current directory:
;; under SLIME, you may: ,change-directory ~/common-lisp/asdf/test/
;; otherwise you may evaluate something like:
(require &quot;asdf&quot;) (asdf:upgrade-asdf) ;load UIOP &amp; update asdf.lisp
(uiop:chdir (asdf:system-relative-pathname :asdf &quot;test/&quot;))
(setf *default-pathname-defaults* (uiop:getcwd))

;; Load the test script support.
(load &quot;script-support.lisp&quot;)

;; Initialize the script support for interaction.
;; This will also change your *package* to asdf-test
;; after frobbing the asdf-test package to make it usable.
;; NB: this function is also available from package cl-user,
;; and also available with the shorter name da in both packages.
(asdf-test:debug-asdf)

;; Now, you may experiment with test code from a .script file.
;; See the instructions given at the end of your failing test
;; to identify which form is needed, e.g.
(run-test-script &quot;test-utilities.script&quot;)
</pre></div>



<hr>
<a name="ASDF_30d7_30ed_30b8_30a7_30af_30c8_3067_9032_884c_4e2d_306e_4f5c_696d"></a>
<a name="ASDFpuroziekutodeJin-Xing-ZhongnoZuo-Ye-"></a>
<h2 class="unnumbered">ASDFプロジェクトで進行中の作業</h2>
<p>現在すべきことの一覧については、ソースリポジトリの<samp>TODO</samp>ファイルを参照してください。
</p>
<p>また、バグは今のところlaunchpadでトラックされています: 
<a href="https://launchpad.net/asdf">https://launchpad.net/asdf</a>
</p>
<hr>
<a name="g_t_53c2_8003_6587_732e"></a>
<a name="Can-Kao-WenXian-"></a>
<h2 class="unnumbered">参考文献</h2>

<ul>
<li> Andrey Mokhov, Neil Mitchell and Simon Peyton Jones:
&ldquo;Build Systems à la Carte&rdquo;, 2018.
  <a href="https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems-final.pdf">https://www.microsoft.com/en-us/research/uploads/prod/2018/03/build-systems-final.pdf</a>
  This article provides axes along which to describe build systems in general;
  ASDF, in addition to being in-image (an axis not considered by these authors),
  has the following characteristics:
  ASDF&rsquo;s persistent build information is file modification times
  (the way ASDF is written, it should be easy enough to write an extension that modifies it
  to use a &ldquo;cloud cache&rdquo; à la Bazel,
  but that would involve using some database, network and cryptographic libraries,
  which cannot reasonably be included in the base ASDF,
  that must remain a minimal bootstrappable system with no external dependencies).
  The object model of ASDF was initially designed for &ldquo;static&rdquo; dependencies
  with a &ldquo;topological&rdquo; scheduler, but its <code>defsystem-depends-on</code> mechanism
  (and more generally, the ability to call ASDF from within an <code>.asd</code> file)
  allows for multiple <em>phases</em> of execution resulting
  in &ldquo;dynamic&rdquo; dependencies with a &ldquo;suspending&rdquo; scheduler.
  The rebuilder essentially uses a &ldquo;dirty bit&rdquo;, except that the in-image model
  and the multiple phase support mean that&rsquo;s actually more than a bit:
  instead three bits, the timestamp and a phase depth level.
  The build is guaranteed &ldquo;minimal&rdquo; in number of steps computed.
  It is local; it assumes but does not enforce determinism;
  it does not assume early cutoff of the build when rebuild dependencies didn&rsquo;t change.
</li><li> Francois-Rene Rideau:
  &ldquo;ASDF 3, or Why Lisp is Now an Acceptable Scripting Language&rdquo;, 2014.
        この記事はASDF 3、3.1での革新について解説し、以前のバージョンの歴史的情報についても触れています。
  <a href="https://github.com/fare/asdf3-2013">https://github.com/fare/asdf3-2013</a>
</li><li> Alastair Bridgewater:
    &ldquo;Quick-build&rdquo; （個人的なやり取りによる）, 2012.
              <code>quick-build</code>は1ファイル、183行のコード（空行、コメント、docstringを除くと117行）で書かれた単純で堅牢なパッケージビルドシステムであり、<code>faslpath</code>に似ています。残念ながら公開されておらず、2014年4月現在では権利関係が曖昧です。<code>asdf/package-system</code>は（トップレベル階層の異なる構成を除けば）おおむね<code>quick-build</code>互換です。
</li><li> Zach Beane:
  &ldquo;Quicklisp&rdquo;, 2011.
          The Quicklisp blogとXachのブログにはQuicklispの情報が載っています。
  <a href="http://blog.quicklisp.org/">http://blog.quicklisp.org/</a>
  <a href="http://lispblog.xach.com/">http://lispblog.xach.com/</a> （新ブログ）
  <a href="http://xach.livejournal.com/">http://xach.livejournal.com/</a> （旧ブログ）
</li><li> Francois-Rene Rideau and Robert Goldman:
  &ldquo;Evolving ASDF: More Cooperation, Less Coordination&rdquo;, 2010.
          この記事はASDF 2で解決された問題について解説し、そのデザインの原則についても書かれています。
  <a href="https://common-lisp.net/project/asdf/ilc2010draft.pdf">https://common-lisp.net/project/asdf/ilc2010draft.pdf</a>
  <a href="http://rpgoldman.goldman-tribe.org/papers/ilc2010-asdf.pdf">http://rpgoldman.goldman-tribe.org/papers/ilc2010-asdf.pdf</a>
</li><li> Francois-Rene Rideau and Spencer Brody:
  &ldquo;XCVB: an eXtensible Component Verifier and Builder for Common Lisp&rdquo;, 2009.
        この記事はXCVBについて解説しています。XCVBはASDFの競合となるシステムで、そのアイデアの多くはASDF 2と3に取り込まれていますが、いまだに取り込まれていないものも多々あります。
  <a href="https://common-lisp.net/project/xcvb/">https://common-lisp.net/project/xcvb/</a>
</li><li> Peter von Etter:
  &ldquo;faslpath&rdquo;, 2009.
        <code>faslpath</code>は<code>quick-build</code>や<code>asdf/package-system</code>に似たシステムですが、セパレータとして<code>/</code>ではなく<code>.</code>を使う点が異なります。
  <a href="https://code.google.com/p/faslpath/">https://code.google.com/p/faslpath/</a>
</li><li> Drew McDermott:
        &ldquo;A Framework for Maintaining the Coherence of a Running Lisp,&rdquo;
  International Lisp Conference, 2005. プレプリントがこちらにあります: 
  <a href="http://www.cs.yale.edu/homes/dvm/papers/lisp05.pdf">http://www.cs.yale.edu/homes/dvm/papers/lisp05.pdf</a>
</li><li> Dan Barlow: &ldquo;ASDF Manual&rdquo;, 2004.
          ASDF 1の頃のマニュアルで、Dan Barlowによるアイデアや、古いdefsystem（<code>mk-defsystem</code>）とdefsystem（<code>defsystem-4</code>、下記のKent M. Pitmanのメモを参照）の比較などを含んでいます。
</li><li> Marco Antoniotti and Peter Van Eynde:
 &ldquo;<code>DEFSYSTEM</code>: A <code>make</code> for Common Lisp, A Thoughtful Re-Implementation of an Old Idea&rdquo;, 2002.
    CLOCCのリポジトリには<code>defsystem-4</code>の提案が含まれています。
</li><li> Mark Kantrovitz: &ldquo;Defsystem: A Portable Make Facility for Common Lisp&rdquo;, 1990.
      旧来の<code>mk-defsystem</code>の変種である<code>defsystem-3.x</code>がCLOCCリポジトリにあります。
</li><li> Richard Elliot Robbins:
  &ldquo;BUILD: A Tool for Maintaining Consistency in Modular Systems&rdquo;, MIT AI TR 874, 1985.
    <a href="http://www.dtic.mil/dtic/tr/fulltext/u2/a162744.pdf">http://www.dtic.mil/dtic/tr/fulltext/u2/a162744.pdf</a>
</li><li> Kent M. Pitman (kmp): &ldquo;The Description of Large Systems&rdquo;, MIT AI Memo 801, 1984.
      <a href="http://nhplace.com/kent/Papers/Large-Systems.html">http://nhplace.com/kent/Papers/Large-Systems.html</a>
  にCL用にアップデートされたものがあります。
</li><li> Dan Weinreb and David Moon: &ldquo;Lisp Machine Manual&rdquo;, 3rd Edition MIT, March 1981.
        &ldquo;CHINE NUAL&rdquo;という通称で有名なマニュアルです。defsystemのもっとも初期の形の１つが解説されています。（1979年の第２版にはこの解説はありません。）
  <a href="http://bitsavers.org/pdf/mit/cadr/chinual_3rdEd_Mar81.pdf">http://bitsavers.org/pdf/mit/cadr/chinual_3rdEd_Mar81.pdf</a>
</li></ul>


<hr>
<a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09"></a>
<a name="Suo-Yin-_0028Yong-Yu-_0029"></a>
<h2 class="unnumbered">索引（用語）</h2>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-1"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-2"><b>:</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ア"><b>ア</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-エ"><b>エ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-オ"><b>オ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-コ"><b>コ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-シ"><b>シ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ソ"><b>ソ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-バ"><b>バ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-パ"><b>パ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-プ"><b>プ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ロ"><b>ロ</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-cp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-1">*</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002afeatures_002a">*features*</a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-2">:</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aalso_002dexclude-source-config-directive">:also-exclude source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aaround_002dcompile">:around-compile</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aasdf">:asdf</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aasdf2">:asdf2</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aasdf3">:asdf3</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003abuild_002doperation">:build-operation</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003acompile_002dcheck">:compile-check</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003adefault_002dregistry-source-config-directive">:default-registry source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003adefsystem_002ddepends_002don">:defsystem-depends-on</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003adirectory-source-config-directive">:directory source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aentry_002dpoint">:entry-point</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aexclude-source-config-directive">:exclude source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003afeature-dependencies">:feature dependencies</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aif_002dfeature-component-option">:if-feature component option</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aignore_002dinvalid_002dentries-source-config-directive">:ignore-invalid-entries source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003ainclude-source-config-directive">:include source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003ainherit_002dconfiguration-source-config-directive">:inherit-configuration source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003arequire-dependencies">:require dependencies</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003atree-source-config-directive">:tree source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aversion">:version</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5358_7d14_306a_4f8b">単純な例</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aversion-1">:version</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aversion-2">:version</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_003aweakly_002ddepends_002don">:weakly-depends-on</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-action">action</a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-also_002dexclude-source-config-directive">also-exclude source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-around_002dcompile-keyword">around-compile keyword</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF-output">ASDF output</a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF-versions">ASDF versions</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF_002dBINARY_002dLOCATIONS-compatibility">ASDF-BINARY-LOCATIONS compatibility</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">後方互換性のための機能（アウトプットトランスレーション）</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asdf_002doutput_002dtranslations">asdf-output-translations</a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF_002drelated-features">ASDF-related features</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asdf_002duser">asdf-user</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5358_7d14_306a_4f8b">単純な例</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF_002dUSER-package">ASDF-USER package</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-bug-tracker">bug tracker</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_3069_3053_306b_30d0_30b0_3092_5831_544a_3059_308c_3070_3088_3044_3067_3059_304b">どこにバグを報告すればよいですか</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-build_002doperation">build-operation</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Capturing-ASDF-output">Capturing ASDF output</a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dcheck-keyword">compile-check keyword</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-component">component</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-component-designator">component designator</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-default_002dregistry-source-config-directive">default-registry source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-DEFSYSTEM-grammar">DEFSYSTEM grammar</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-directory-source-config-directive">directory source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-exclude-source-config-directive">exclude source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ignore_002dinvalid_002dentries-source-config-directive">ignore-invalid-entries source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-immutable-systems">immutable systems</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-immutable-systems-1">immutable systems</a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-include-source-config-directive">include source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-inherit_002dconfiguration-source-config-directive">inherit-configuration source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-launchpad">launchpad</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_3069_3053_306b_30d0_30b0_3092_5831_544a_3059_308c_3070_3088_3044_3067_3059_304b">どこにバグを報告すればよいですか</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-logical-pathnames">logical pathnames</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-mailing-list">mailing list</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30e1_30fc_30ea_30f3_30b0_30ea_30b9_30c8">メーリングリスト</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-One-package-per-file-systems">One package per file systems</a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operation">operation</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Package-inferred-systems">Package inferred systems</a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Packages_002c-inferring-dependencies-from">Packages, inferring dependencies from</a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-pathname-specifiers">pathname specifiers</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-Primary-system-name">Primary system name</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-Q">Q</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Quicklisp">Quicklisp</a>:</td><td>&nbsp;</td><td valign="top"><a href="#After-upgrading-ASDF">After upgrading ASDF</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-readtables">readtables</a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-do-I-work-with-readtables_003f">How do I work with readtables?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-serial-dependencies">serial dependencies</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system">system</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system-designator">system designator</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-System-names">System names</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-Testing-for-ASDF">Testing for ASDF</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-tree-source-config-directive">tree source config directive</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_3092_8a2d_5b9a_3059_308bDSL">ソースレジストリを設定するDSL</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-version-specifiers">version specifiers</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ア">ア</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-autopututotoransuresiyon">アウトプットトランスレーション</a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-akusiyon">アクション</a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-エ">エ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-entoripointo">エントリーポイント</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-オ">オ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-operesiyon">オペレーション</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-コ">コ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-konponento">コンポーネント</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-konponentosizisi_0028konponentoZhi-ShiZi-_0029">コンポーネントシジシ（コンポーネント指示子）</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-シ">シ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-sisutemu">システム</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sisutemusizisi_0028sisutemuZhi-ShiZi-_0029">システムシジシ（システム指示子）</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ソ">ソ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-sosurezisutori">ソースレジストリ</a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがシステムを探す場所を設定する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-バ">バ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-baziyonsiteisi_0028baziyonZhi-Ding-Zi-_0029">バージョンシテイシ（バージョン指定子）</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-パ">パ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-pasumeisiteisi_0028pasuMing-Zhi-Ding-Zi-_0029">パスメイシテイシ（パス名指定子）</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-プ">プ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-puraimarisisutemu">プライマリシステム</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-puraimarinemu">プライマリネーム</a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ロ">ロ</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-ronripasumei_0028Lun-Li-pasuMing-_0029">ロンリパスメイ（論理パス名）</a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-1"><b>*</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_symbol-2"><b>:</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-Q"><b>Q</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-V"><b>V</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ア"><b>ア</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-エ"><b>エ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-オ"><b>オ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-コ"><b>コ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-シ"><b>シ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ソ"><b>ソ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-バ"><b>バ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-パ"><b>パ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-プ"><b>プ</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_7528_8a9e_ff09_cp_letter-ロ"><b>ロ</b></a>
 &nbsp; 
</td></tr></table>

<hr>
<a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09"></a>
<a name="Suo-Yin-_0028Guan-Shu-tomakuro_0029"></a>
<h2 class="unnumbered">索引（関数とマクロ）</h2>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-fn" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-already_002dloaded_002dsystems"><code>already-loaded-systems</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-apply_002doutput_002dtranslations"><code>apply-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-asdf_002dversion"><code>asdf-version</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-do-I-detect-the-ASDF-version_003f">How do I detect the ASDF version?</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002dconfiguration"><code>clear-configuration</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_8a2d_5b9a_3092_30ea_30bb_30c3_30c8_3059_308b">ASDFの設定をリセットする</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002doutput_002dtranslations"><code>clear-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_304c_30aa_30d6_30b8_30a7_30af_30c8_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがオブジェクトファイルを保持する場所を設定する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002doutput_002dtranslations-1"><code>clear-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002dsource_002dregistry"><code>clear-source-registry</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-clear_002dsystem"><code>clear-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-coerce_002dname"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-coerce_002dname-1"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-coerce_002dname-2"><code>coerce-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dfile_002a"><code>compile-file*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Controlling-file-compilation">Controlling file compilation</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dsystem"><code>compile-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-component_002ddepends_002don"><code>component-depends-on</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-component_002dpathname"><code>component-pathname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-define_002dpackage"><code>define-package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defsystem"><code>defsystem</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5358_7d14_306a_4f8b">単純な例</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defsystem-1"><code>defsystem</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_8907_96d1_306a_4f8b">複雑な例</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-defsystem-2"><code>defsystem</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#defsystem_306e_6587_6cd5">defsystemの文法</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-disable_002doutput_002dtranslations"><code>disable-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-E">E</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-enable_002dasdf_002dbinary_002dlocations_002dcompatibility"><code>enable-asdf-binary-locations-compatibility</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5f8c_65b9_4e92_63db_6027_306e_305f_3081_306e_6a5f_80fd_ff08_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_ff09">後方互換性のための機能（アウトプットトランスレーション）</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ensure_002doutput_002dtranslations"><code>ensure-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ensure_002dsource_002dregistry"><code>ensure-source-registry</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-file_002dtype"><code>file-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pitfalls-of-the-transition-to-ASDF-2">Pitfalls of the transition to ASDF 2</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-find_002dcomponent"><code>find-component</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-find_002dcomponent-1"><code>find-component</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-find_002dsystem"><code>find-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-initialize_002doutput_002dtranslations"><code>initialize-output-translations</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Output-location-API">Output location API</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-initialize_002dsource_002dregistry"><code>initialize-source-registry</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306eAPI">ソースレジストリのAPI</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-input_002dfiles"><code>input-files</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dasd"><code>load-asd</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_5358_7d14_306a_4f8b">単純な例</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dsystem"><code>load-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-locate_002dsystem"><code>locate-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-make"><code>make</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-make_002doperation"><code>make-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-merge_002dpathnames_002a"><code>merge-pathnames*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-oos"><code>oos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-oos-1"><code>oos</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operate"><code>operate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operate-1"><code>operate</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operation_002ddone_002dp"><code>operation-done-p</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-output_002dfiles"><code>output-files</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-package_002dinferred_002dsystem"><code>package-inferred-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-parse_002dunix_002dnamestring"><code>parse-unix-namestring</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-perform"><code>perform</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primary_002dsystem_002dname"><code>primary-system-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-primary_002dsystem_002dname-1"><code>primary-system-name</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-R">R</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-register_002dimmutable_002dsystem"><code>register-immutable-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-register_002dimmutable_002dsystem-1"><code>register-immutable-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-register_002dpreloaded_002dsystem"><code>register-preloaded-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-register_002dsystem_002dpackages"><code>register-system-packages</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-require_002dsystem"><code>require-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002dprogram"><code>run-program</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-run_002dshell_002dcommand"><code>run-shell-command</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-slurp_002dinput_002dstream"><code>slurp-input-stream</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-source_002dfile_002dtype"><code>source-file-type</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pitfalls-of-the-transition-to-ASDF-2">Pitfalls of the transition to ASDF 2</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subpathname"><code>subpathname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-subpathname_002a"><code>subpathname*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002ddefsystem_002ddepends_002don"><code>system-defsystem-depends-on</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b7_30b9_30c6_30e0_306e_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066_306e_60c5_5831">システムの依存関係についての情報</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002ddepends_002don"><code>system-depends-on</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b7_30b9_30c6_30e0_306e_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066_306e_60c5_5831">システムの依存関係についての情報</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002drelative_002dpathname"><code>system-relative-pathname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002drelative_002dpathname-1"><code>system-relative-pathname</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002dsource_002ddirectory"><code>system-source-directory</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Miscellaneous-Functions">Miscellaneous Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002dweakly_002ddepends_002don"><code>system-weakly-depends-on</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b7_30b9_30c6_30e0_306e_4f9d_5b58_95a2_4fc2_306b_3064_3044_3066_306e_60c5_5831">システムの依存関係についての情報</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-test_002dsystem"><code>test-system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_4fbf_5229_306a_95a2_6570">便利な関数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-traverse"><code>traverse</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30aa_30da_30ec_30fc_30b7_30e7_30f3">オペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-uiop_003adefine_002dpackage"><code>uiop:define-package</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#package_002dinferred_002dsystem_62e1_5f35">package-inferred-system拡張</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-V">V</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-version_002dsatisfies"><code>version-satisfies</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_5171_901a_306e_5c5e_6027">コンポーネントの共通の属性</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-version_002dsatisfies-1"><code>version-satisfies</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_95a2_9023_3059_308b_95a2_6570">関連する関数</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-A"><b>A</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-E"><b>E</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-R"><b>R</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-U"><b>U</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_95a2_6570_3068_30de_30af_30ed_ff09_fn_letter-V"><b>V</b></a>
 &nbsp; 
</td></tr></table>

<hr>
<a name="g_t_7d22_5f15_ff08_5909_6570_ff09"></a>
<a name="Suo-Yin-_0028Bian-Shu-_0029"></a>
<h2 class="unnumbered">索引（変数）</h2>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_5909_6570_ff09_vr_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_5909_6570_ff09_vr_letter-A"><b>A</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-vr" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_5909_6570_ff09_vr_symbol-1">*</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002acentral_002dregistry_002a"><code>*central-registry*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#After-upgrading-ASDF">After upgrading ASDF</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002acompile_002dfile_002dfailure_002dbehaviour_002a"><code>*compile-file-failure-behaviour*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30a8_30e9_30fc_51e6_7406">エラー処理</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002acompile_002dfile_002dwarnings_002dbehaviour_002a"><code>*compile-file-warnings-behaviour*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30a8_30e9_30fc_51e6_7406">エラー処理</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002adefault_002dsource_002dregistry_002dexclusions_002a"><code>*default-source-registry-exclusions*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_63a2_7d22_30a2_30eb_30b4_30ea_30ba_30e0">探索アルゴリズム</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002afeatures_002a-1"><code>*features*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_306f_3058_3081_306b">はじめに</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aimage_002ddump_002dhook_002a"><code>*image-dump-hook*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_8a2d_5b9a_3092_30ea_30bb_30c3_30c8_3059_308b">ASDFの設定をリセットする</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aLOAD_002dPATHNAME_002a"><code>*LOAD-PATHNAME*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aLOAD_002dTRUENAME_002a"><code>*LOAD-TRUENAME*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#LOAD_002dPATHNAME-has-a-weird-value">LOAD-PATHNAME has a weird value</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002anil_002dpathname_002a"><code>*nil-pathname*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Some-Utility-Functions">Some Utility Functions</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002aoldest_002dforward_002dcompatible_002dasdf_002dversion_002a"><code>*oldest-forward-compatible-asdf-version*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#Pitfalls-of-the-upgrade-to-ASDF-3">Pitfalls of the upgrade to ASDF 3</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002asource_002dregistry_002dparameter_002a"><code>*source-registry-parameter*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_002asource_002dregistry_002dparameter_002a_5909_6570"><code>*source-registry-parameter*</code>変数</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002astandard_002doutput_002a"><code>*standard-output*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#How-can-I-capture-ASDF_0027s-output_003f">How can I capture ASDF's output?</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-_002asystem_002ddefinition_002dsearch_002dfunctions_002a"><code>*system-definition-search-functions*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8">コンポーネント</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_5909_6570_ff09_vr_letter-A">A</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-asdf_003a_002auser_002dcache_002a"><code>asdf:*user-cache*</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-ASDF_005fOUTPUT_005fTRANSLATIONS"><code>ASDF_OUTPUT_TRANSLATIONS</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがコンパイルされたファイルを保持する場所を設定する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_5909_6570_ff09_vr_symbol-1"><b>*</b></a>
 &nbsp; 
<br>
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_5909_6570_ff09_vr_letter-A"><b>A</b></a>
 &nbsp; 
</td></tr></table>

<hr>
<a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09"></a>
<a name="Suo-Yin-_0028kurasutoXing-_0029"></a>
<h2 class="unnumbered">索引（クラスと型）</h2>

<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-U"><b>U</b></a>
 &nbsp; 
</td></tr></table>
<table class="index-tp" border="0">
<tr><td></td><th align="left">Index Entry</th><td>&nbsp;</td><th align="left"> Section</th></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-B">B</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-binary_002dop-_0028obsolete_0029"><code>binary-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-C">C</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-c_002dsource_002dfile"><code>c-source-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-cl_002dsource_002dfile"><code>cl-source-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dbundle_002dop"><code>compile-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dbundle_002dop-1"><code>compile-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dconcatenated_002dsource_002dop"><code>compile-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-compile_002dop"><code>compile-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-component-1"><code>component</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-concatenate_002dsource_002dop"><code>concatenate-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-D">D</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-deliver_002dasd_002dop"><code>deliver-asd-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-deliver_002dasd_002dop-1"><code>deliver-asd-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-dll_002dop"><code>dll-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-doc_002dfile"><code>doc-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-downward_002doperation"><code>downward-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-F">F</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-fasl_002dop-_0028obsolete_0029"><code>fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-H">H</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-html_002dfile"><code>html-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-I">I</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-image_002dop"><code>image-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-J">J</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-java_002dsource_002dfile"><code>java-source-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-L">L</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-lib_002dop"><code>lib-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dbundle_002dop"><code>load-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dbundle_002dop-1"><code>load-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dcompiled_002dconcatenated_002dsource_002dop"><code>load-compiled-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dconcatenated_002dsource_002dop"><code>load-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dfasl_002dop-_0028obsolete_0029"><code>load-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dop"><code>load-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-load_002dsource_002dop"><code>load-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-M">M</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-module"><code>module</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dbinary_002dop-_0028obsolete_0029"><code>monolithic-binary-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dcompile_002dbundle_002dop"><code>monolithic-compile-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dcompile_002dbundle_002dop-1"><code>monolithic-compile-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dcompile_002dconcatenated_002dsource_002dop"><code>monolithic-compile-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dconcatenate_002dsource_002dop"><code>monolithic-concatenate-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002ddeliver_002dasd_002dop"><code>monolithic-deliver-asd-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002ddeliver_002dasd_002dop-1"><code>monolithic-deliver-asd-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002ddll_002dop"><code>monolithic-dll-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dfasl_002dop-_0028obsolete_0029"><code>monolithic-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dlib_002dop"><code>monolithic-lib-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dload_002dbundle_002dop"><code>monolithic-load-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dload_002dbundle_002dop-1"><code>monolithic-load-bundle-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dload_002dcompiled_002dconcatenated_002dsource_002dop"><code>monolithic-load-compiled-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dload_002dconcatenated_002dsource_002dop"><code>monolithic-load-concatenated-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-monolithic_002dload_002dfasl_002dop-_0028obsolete_0029"><code>monolithic-load-fasl-op (obsolete)</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#What-happened-to-the-bundle-operations">What happened to the bundle operations</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-N">N</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-non_002dpropagating_002doperation"><code>non-propagating-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-O">O</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-operation-1"><code>operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#ASDF_306e_30aa_30d6_30b8_30a7_30af_30c8_30e2_30c7_30eb">ASDFのオブジェクトモデル</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-operation_002derror"><code>operation-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30a8_30e9_30fc_51e6_7406">エラー処理</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-P">P</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-prepare_002dop"><code>prepare-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-prepare_002dsource_002dop"><code>prepare-source-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-program_002dop"><code>program-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-S">S</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-selfward_002doperation"><code>selfward-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-sideway_002doperation"><code>sideway-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-source_002dfile"><code>source-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-static_002dfile"><code>static-file</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system-1"><code>system</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30b3_30f3_30dd_30fc_30cd_30f3_30c8_306e_7d44_307f_8fbc_307f_306e_30b5_30d6_30af_30e9_30b9">コンポーネントの組み込みのサブクラス</a></td></tr>
<tr><td></td><td valign="top"><a href="#index-system_002ddefinition_002derror"><code>system-definition-error</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_30a8_30e9_30fc_51e6_7406">エラー処理</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-T">T</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-test_002dop"><code>test-op</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_7d44_307f_8fbc_307f_306e_30aa_30da_30ec_30fc_30b7_30e7_30f3">組み込みのオペレーション</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
<tr><th><a name="g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-U">U</a></th><td></td><td></td></tr>
<tr><td></td><td valign="top"><a href="#index-upward_002doperation"><code>upward-operation</code></a>:</td><td>&nbsp;</td><td valign="top"><a href="#g_t_65b0_3057_3044_30aa_30da_30ec_30fc_30b7_30e7_30f3_3092_5b9a_7fa9_3059_308b">新しいオペレーションを定義する</a></td></tr>
<tr><td colspan="4"> <hr></td></tr>
</table>
<table><tr><th valign="top">Jump to: &nbsp; </th><td><a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-B"><b>B</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-C"><b>C</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-D"><b>D</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-F"><b>F</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-H"><b>H</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-I"><b>I</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-J"><b>J</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-L"><b>L</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-M"><b>M</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-N"><b>N</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-O"><b>O</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-P"><b>P</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-S"><b>S</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-T"><b>T</b></a>
 &nbsp; 
<a class="summary-letter" href="#g_t_7d22_5f15_ff08_30af_30e9_30b9_3068_578b_ff09_tp_letter-U"><b>U</b></a>
 &nbsp; 
</td></tr></table>

<div class="footnote">
<hr>
<h4 class="footnotes-heading">Footnotes</h4>

<h3><a name="FOOT1" href="#DOCF1">(1)</a></h3>
<p>[訳注] Quicklispがインストールされている場合、手動でソフトウェアを置く場所としては<code>ql:*local-project-directories*</code>(<samp>~/quicklisp/local-projects/</samp>など)も使えます。同名のシステムがある場合、ローカルプロジェクトのものがQuicklisp配布のバージョンに優先します。Quicklispはこれらのパスを（少なくとも、<code>(ql:register-local-projects)</code>を実行すれば）ASDFからも使えるように自動設定しているはずです。
</p>
<p>また、すべてを<a href="https://github.com/roswell/roswell">Roswell</a>で管理するという方法もあるでしょう。Roswellは、処理系マネージャとしての機能を中心にした高機能なコマンドラインツールです。Roswellから処理系を起動している場合は<samp>~/.roswell/local-projects/</samp>が同じように使えます。
</p>
<p>clbuild（とその後継のclbuild2）は2018年現在ではメンテナンスされておらず、やや古いツールと思われます。</p>
<h3><a name="FOOT2" href="#DOCF2">(2)</a></h3>
<p><code>(require &quot;ASDF&quot;)</code>や<code>(require 'asdf)</code>、<code>(require :asdf)</code>などもGNU CLISP以外では有効ですが、ポータビリティのためには<code>(require &quot;asdf&quot;)</code>を使うべきです。</p>
<h3><a name="FOOT3" href="#DOCF3">(3)</a></h3>
<p>[訳注] <samp>~/common-lisp/</samp>などのディレクトリに移動して<code>git clone https://gitlab.common-lisp.net/asdf/asdf.git</code>を実行します。</p>
<h3><a name="FOOT4" href="#DOCF4">(4)</a></h3>
<p><samp>~/common-lisp/</samp>がデフォルトのパスに含まれるのはASDF 3.1.2以降です。それ以前のASDFを使っている場合は、後述のように、このパスを使うことを明示的に設定する必要があるかもしれません。
</p>
<p>[訳注] また、Windowsの場合、後者は<samp>%LOCALAPPDATA%/common-lisp/source/</samp>または<samp>%APPDATA%/Local/common-lisp/source/</samp>に相当することが多いでしょう。詳細については<a href="#ASDF_304c_30b7_30b9_30c6_30e0_3092_63a2_3059_5834_6240_3092_8a2d_5b9a_3059_308b">ASDFがシステムを探す場所を設定する</a>を参照するべきですが、特に必要でなければ<samp>~/common-lisp/</samp>を使うことを推奨します。</p>
<h3><a name="FOOT5" href="#DOCF5">(5)</a></h3>
<p>Windowsの場合、ASDF 3.1.5以降では、<samp>%LOCALAPPDATA%</samp>以下に<samp>config/common-lisp/source-registry.conf.d/</samp>ディレクトリを作りましょう。<samp>%LOCALAPPDATA%</samp>は通常なら<samp>~/AppData/Local/</samp>を指していますが、実際の値は<code>CMD.EXE</code>上で<code>echo %LOCALAPPDATA%</code>を実行することで確かめることができます。</p>
<h3><a name="FOOT6" href="#DOCF6">(6)</a></h3>
<p>拡張子が<samp>.conf</samp>でないファイルは無視されるので、これを利用して特定の設定ファイルを無効にすることができます。例えば、エディタのバックアップなどのファイルは同じディレクトリにあっても読み込まれないでしょう。
</p>
<p>また、ASDFは<samp>.</samp>で始まるファイル名も無視します。
</p>
<p>慣習では、これらの設定ファイル名は２つの数字から始まります。こうすることで設定ディレクトリ内の<samp>.conf</samp>ファイルの並びが決まり、設定が読み込まれる順番をコントロールすることができます。</p>
<h3><a name="FOOT7" href="#DOCF7">(7)</a></h3>
<p><samp>.asd</samp>ファイルの探索をさらにカスタマイズすることも可能です。これは発展的な使い方になるので、後に扱います。<code>*system-definition-search-functions*</code>で検索してください。</p>
<h3><a name="FOOT8" href="#DOCF8">(8)</a></h3>
<p>[訳注] 実装を見る限りでは、<code>eval</code>の返す値が<code>uiop:directory-pathname-p</code>を満たせば良いようです（満たさない場合はエラーが通知される）。</p>
<h3><a name="FOOT9" href="#DOCF9">(9)</a></h3>
<p>WindowsではPOSIXのシンボリックリンクの代わりにショートカットを使うことができます。MacOSのエイリアスについては、うまく動くかどうかの情報を求めています。</p>
<h3><a name="FOOT10" href="#DOCF10">(10)</a></h3>
<p>[訳注] <code>asdf:clear-source-registry</code>と<code>asdf:clear-output-translations</code>が実行されます。</p>
<h3><a name="FOOT11" href="#DOCF11">(11)</a></h3>
<p>[訳注] ASDF以前に使われていたシステム定義ツール。</p>
<h3><a name="FOOT12" href="#DOCF12">(12)</a></h3>
<p><code>:force-not (already-loaded-systems)</code>を指定すると実現できます。</p>
<h3><a name="FOOT13" href="#DOCF13">(13)</a></h3>
<p>[訳注] 例を挙げて説明すると、システム<code>library</code>とシステム<code>application</code>があって<code>application</code>が<code>library</code>に依存しているとき、<code>library</code>のコードを変更して<code>(asdf:load-system :application)</code>を実行すると、<code>library</code>、<code>application</code>の順で必要な再コンパイル、ロードが行われます。</p>
<h3><a name="FOOT14" href="#DOCF14">(14)</a></h3>
<p>ASDF 1、2（バージョン2.26まで）は、各<samp>.asd</samp>ファイルに対して<code>asdf<em>N</em></code>という一時的なパッケージを作っては削除していました。これは名前の衝突を減らすための仕様でしたが、目的にかなってもいなかったし、ものごとを複雑にしただけでした。ASDF 3は単に共通のパッケージである<code>asdf-user</code>を使い、シンボル衝突の回避はCommon Lispの慣習に委ねます。<code>asdf-user</code>パッケージの特筆すべき点は、<code>uiop/common-lisp</code>を<code>use</code>していることです。このパッケージは<code>common-lisp</code>パッケージのすべてのシンボルを再エクスポートしていて、いくつかのCommon Lisp処理系のANSI CL違反の挙動が修正されています。しかし、Corman Lisp、GCL、Genera、MCLを使っているのでなければ、この点を気にするべきではありません。</p>
<h3><a name="FOOT15" href="#DOCF15">(15)</a></h3>
<p>[訳注] 現在のバージョンでは、キーワード指定すると<code>asdf/interface</code>パッケージからクラスが探されます。別のパッケージのクラスを使いたい場合は<code>&quot;package:my-new-system-subclass&quot;</code>のように文字列で指定しましょう。</p>
<h3><a name="FOOT16" href="#DOCF16">(16)</a></h3>
<p>[訳注] <code>&quot;foo/bar.lisp&quot;</code>は<samp>#p&quot;foo/bar.lisp.lisp&quot;</samp>と解釈されるので、拡張子を明示して書くことはできません。</p>
<h3><a name="FOOT17" href="#DOCF17">(17)</a></h3>
<p>[訳注] ここはわかりにくいですが、文字列中では<code>&quot;..&quot;</code>がUnixのパスと同じように使えるということを知っていれば十分です。ANSI CLの<a href="http://clhs.lisp.se/Body/26_glo_p.htm#pathname">パス名</a>オブジェクトは６つのコンポーネントを含みますが、その内の１つである<a href="http://clhs.lisp.se/Body/26_glo_v.htm#valid_pathname_directory">ディレクトリ</a>コンポーネント中に<code>:back</code>が含まれているのと同じ意味になるということです。<a href="http://www.lispworks.com/documentation/lw50/CLHS/Body/19_bbdc.htm">CLHS: 19.2.2.4.3 Restrictions on Examining a Pathname Directory Component</a>も参照。</p>
<h3><a name="FOOT18" href="#DOCF18">(18)</a></h3>
<p>[訳注] CLのパス名（リテラル<code>#p...</code>あるいは<code>#.(make-pathname ...)</code>による）を与えるか、文字列でUnixスタイルの相対パスを与えるかの２択であり、絶対パスを指定したい場合は（稀と思われますが）前者のパス名しか使えないということです。相対パスは<samp>.asd</samp>ファイルのあるディレクトリを基点に解釈されるので、<code>:pathname</code>オプションでシステムのトップレベルのディレクトリを変更していても影響しないという点にも注意しましょう。
</p>
<p>なお、具体的には<code>(uiop:subpathname (asdf:system-source-file &lt;システム名&gt;) &lt;パス名または文字列&gt;)</code>の返すパス名が使われています。</p>
<h3><a name="FOOT19" href="#DOCF19">(19)</a></h3>
<p>[訳注] <code>component-pathname</code>でアクセスできるパス名です。</p>
<h3><a name="FOOT20" href="#DOCF20">(20)</a></h3>
<p>[訳注] ただしこれは、<code>load-system</code>で読み込むのと<code>load</code>で読み込むのが同等、という意味ではありません。ASDFがシステム定義を<samp>.asd</samp>ファイルから読み込むときはカレントパッケージが<code>:asdf-user</code>になるなど、<code>load</code>による実行と比べるといろいろな違いがあります。</p>
<h3><a name="FOOT21" href="#DOCF21">(21)</a></h3>
<p>[訳注] システム<code>foo</code>のディレクトリ構成として、システム定義ファイルを<samp>foo/foo.asd</samp>に置き、ソースファイルをすべて<samp>foo/src/</samp>以下に置く方式を選んだとしましょう。この時、<samp>foo/src/baz.lisp</samp>に対応するシステムはデフォルトでは<code>foo/src/baz</code>ですが、<code>:pathname &quot;src&quot;</code>でトップレベルのパスを<samp>foo/src/</samp>に変えると<code>foo/baz</code>にできます。<code>:pathname</code>オプションについては<a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>を参照してください。</p>
<h3><a name="FOOT22" href="#DOCF22">(22)</a></h3>
<p>古いASDFでは、計画を作る関数は<code>traverse</code>であり、実行すべきアクションのリストを返していました。しかし、ASDF 3で<code>plan</code>オブジェクトが導入され、<code>make-plan</code>がこのオブジェクトを返す関数として代わりに使われるようになったため、<code>traverse</code>は廃止予定です。<code>traverse</code>は後方互換性とデバッグのためだけに残されており、近い将来には削除されるかもしれません。</p>
<h3><a name="FOOT23" href="#DOCF23">(23)</a></h3>
<p><em>アクション(action)</em>という用語は、Kent Pitmanの論文 &ldquo;The Description of Large Systems&rdquo;（→ <a href="#g_t_53c2_8003_6587_732e">参考文献</a>）で使われていて、これはUnixの<code>make</code>に端を発するのではないかと我々は考えています。この用語がASDFハッカーたちに使われるようになったのはASDF 2からですが、それ以前も単に明示されてはいなかっただけで、概念としてはASDF 1の当初からありました。</p>
<h3><a name="FOOT24" href="#DOCF24">(24)</a></h3>
<p>[訳注] 降順。例えば<code>(defsystem &quot;foo&quot; :components ((:module &quot;src&quot; ...)))</code>の<code>src</code>モジュールはリスト<code>(&quot;foo&quot; &quot;src&quot;)</code>で指定できます。</p>
<h3><a name="FOOT25" href="#DOCF25">(25)</a></h3>
<p>[訳注] <code>traverse</code>はオペレーション指示子とコンポーネント指示子を引数に取り、実行されるアクション（オペレーションとコンポーネントの対）のリストを順序付きで返します。ただし、<em>廃止予定</em>。</p>
<h3><a name="FOOT26" href="#DOCF26">(26)</a></h3>
<p>[訳注] この場合、<code>:build-pathname</code>の指定があれば出力先はそのパス名になります。指定がない場合は<code>component-pathname</code>の返すディレクトリが使われるようですが、公式の仕様かどうかは明示されていません。</p>
<h3><a name="FOOT27" href="#DOCF27">(27)</a></h3>
<p>バージョン2.27～3.0.3では、<code>uiop</code>の代わりに<code>uiop/package</code>のみが<code>use</code>されていました。バージョン3.1.2以前に対応したコードを書くためには、<code>uiop</code>を<code>use</code>したパッケージを自ら定義するか、あるいは<code>uiop:</code>というパッケージ接頭辞をいちいち付ける必要があります。</p>
<h3><a name="FOOT28" href="#DOCF28">(28)</a></h3>
<p>[訳注] 例えば冒頭に<code>(cl:in-package :asdf-user)</code>を追加する、など。</p>
<h3><a name="FOOT29" href="#DOCF29">(29)</a></h3>
<p>[訳注] <code>clear-source-registry</code>でキャッシュのリセットができます。</p>
<h3><a name="FOOT30" href="#DOCF30">(30)</a></h3>
<p>ASDF 2.26以前はプライマリネームの機能をサポートしていませんでした。従って、それらのバージョンでは、システム<code>foo/bar</code>が<samp>foo.asd</samp>に定義されている場合は、<code>(asdf:find-system &quot;foo&quot;)</code>を実行するなどして、事前にそのファイルを明示的にロードしなければなりません。我々はASDF 2をサポートしていませんので、ASDF 3にアップグレードすることを推奨します。</p>
<h3><a name="FOOT31" href="#DOCF31">(31)</a></h3>
<p>[訳注] ASDFでは、<code>:depends-on</code>でつながっているコンポーネントをsibling（兄弟姉妹）と呼びます。</p>
<h3><a name="FOOT32" href="#DOCF32">(32)</a></h3>
<p>[訳注] <code>defsystem</code>の<code>:depends-on</code>オプションで使われる構文です。（→ <a href="#defsystem_306e_6587_6cd5">defsystemの文法</a>）</p>
<h3><a name="FOOT33" href="#DOCF33">(33)</a></h3>
<p>[訳注] このリストの３番目以降の処理は、<code>asdf:*default-source-registries*</code>中の７つの関数に順に対応しています。リストの最後の項目の意図は判然としませんが、処理系などが独自にこの変数を編集していると、処理が加わったり（あるいは減ったり）するでしょう。Mezzanoなどにその例があります。</p>
<h3><a name="FOOT34" href="#DOCF34">(34)</a></h3>
<p>[訳注] 継承した設定(inherited configuration)とは、<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_8a2d_5b9a">ソースレジストリ</a>の一連の設定において、<strong>後</strong>で処理される設定を指します。つまり、大ざっぱに言えば、箇条書きの下の処理に相当します。「継承」の語感から逆に考える方もいるかもしれないので、注意しておきます。<code>(append 新しい設定 (次の処理))</code>のように再帰のイメージを持つと間違えにくいかもしれません。<code>:ignore-inherited-configuration</code>の指定があると、ソースレジストリの設定がそこで終わることになります。</p>
<h3><a name="FOOT35" href="#DOCF35">(35)</a></h3>
<p>[訳注] <code>asdf::default-user-source-registry</code>と<code>asdf::default-system-source-registry</code>による設定が挿入されます。<a href="#g_t_30bd_30fc_30b9_30ec_30b8_30b9_30c8_30ea_306e_8a2d_5b9a">ソースレジストリの設定</a>のリスト中の６番目と９番目の処理に相当します。</p>
<h3><a name="FOOT36" href="#DOCF36">(36)</a></h3>
<p>[訳注] <code>asdf:*user-cache*</code>のパス名が使われます。主に<a href="#ASDF_304c_30b3_30f3_30d1_30a4_30eb_3055_308c_305f_30d5_30a1_30a4_30eb_3092_4fdd_6301_3059_308b_5834_6240_3092_8a2d_5b9a_3059_308b">アウトプットトランスレーション</a>に関係します。<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a>を参照。</p>
<h3><a name="FOOT37" href="#DOCF37">(37)</a></h3>
<p>[訳注] clbuildは2018年現在、メンテナンスされていません。</p>
<h3><a name="FOOT38" href="#DOCF38">(38)</a></h3>
<p>[訳注] こちらの例ではユーザー名が明示されていますが、もちろん<code>(:tree (:home &quot;cl&quot;))</code>という記述も有効です。</p>
<h3><a name="FOOT39" href="#DOCF39">(39)</a></h3>
<p>[訳注] 文字列の末尾を<code>:</code>（または<code>;</code>）にすると、最後に空のエントリを追加したことになります。</p>
<h3><a name="FOOT40" href="#DOCF40">(40)</a></h3>
<p>[訳注] 具体的には<code>(uiop:normalize-pathname-directory-component (pathname-directory <var>パス名</var>))</code>です。<code>uiop:normalize-pathname-directory-component</code>は、処理系によって異なるディレクトリコンポーネントのフォーマットをCLHS標準のリストに直す関数です。</p>
<h3><a name="FOOT41" href="#DOCF41">(41)</a></h3>
<p>[訳注] ASDFの競合だったビルドシステムです。今は使われていません。</p>
<h3><a name="FOOT42" href="#DOCF42">(42)</a></h3>
<p>[訳注] 現在の実装もそうなっています。</p>
<h3><a name="FOOT43" href="#DOCF43">(43)</a></h3>
<p>[訳注] <samp>.cl-source-registry.cache</samp>の読み込みは<code>ignore-errors</code>で行われるため、キャッシュファイルが正しい構文で書かれていない場合、単に無視されるだけでエラーは通知されないことに注意してください。</p>
<h3><a name="FOOT44" href="#DOCF44">(44)</a></h3>
<p>&ldquo;FASL&rdquo;は&ldquo;FASt Loading&rdquo;の略です。</p>
<h3><a name="FOOT45" href="#DOCF45">(45)</a></h3>
<p>[訳注] このリストの３番目以降の処理は、<code>asdf/output-translations::*default-output-translations*</code>中の５つの関数に順に対応しています。ソースレジストリの場合と違ってこのシンボルはエクスポートされていないため、処理系などが独自にこの変数を編集する可能性は考えられていないのでしょう。</p>
<h3><a name="FOOT46" href="#DOCF46">(46)</a></h3>
<p>[訳注] 順序としては、このディレクトリの設定は上のリストの１番目の処理で追加されます。無効にする方法については<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_3092_8a2d_5b9a_3059_308bDSL">アウトプットトランスレーションを設定するDSL</a>を参照してください。</p>
<h3><a name="FOOT47" href="#DOCF47">(47)</a></h3>
<p>部分的には、<code>clean-op</code>がこの解決策になるかもしれません。</p>
<h3><a name="FOOT48" href="#DOCF48">(48)</a></h3>
<p>[訳注] 継承した設定(inherited configuration)とは、<a href="#g_t_30a2_30a6_30c8_30d7_30c3_30c8_30c8_30e9_30f3_30b9_30ec_30fc_30b7_30e7_30f3_306e_8a2d_5b9a">アウトプットトランスレーションの一連の設定</a>において、<strong>後</strong>で処理される設定を指します。<code>:ignore-inherited-configuration</code>の指定があると、アウトプットトランスレーションの設定がそこで終わることになります。</p>
<h3><a name="FOOT49" href="#DOCF49">(49)</a></h3>
<p>[訳注] 入力指示子の<code>:root</code>は<code>(:root :**/ :*.*.*)</code>の略であり、すべてのホスト、デバイスのすべてのファイルにマッチします。このマッピングが適用されると、例えば<samp>#P&quot;C:/Users/foo/common-lisp/bar.lisp&quot;</samp>は<samp>#P&quot;C:/Users/foo/common-lisp/sbcl-1.4.2-win-x64/bar.lisp&quot;</samp>などに変換されます。</p>
<h3><a name="FOOT50" href="#DOCF50">(50)</a></h3>
<p>[訳注] <code>asdf:*user-cache*</code>はデフォルトでは<code>(uiop:xdg-cache-home &quot;common-lisp&quot; :implementation)</code>にセットされます。（→ <a href="#XDG_30d9_30fc_30b9_30c7_30a3_30ec_30af_30c8_30ea">XDGベースディレクトリ</a>）</p>
<h3><a name="FOOT51" href="#DOCF51">(51)</a></h3>
<p>[訳注] clbuildは2018年現在、メンテナンスされていません。</p>
<h3><a name="FOOT52" href="#DOCF52">(52)</a></h3>
<p>Alternatively, you could touch <code>foo.asd</code> or
remove the corresponding fasls from the output file cache.</p>
<h3><a name="FOOT53" href="#DOCF53">(53)</a></h3>
<a name="index-_002aoldest_002dforward_002dcompatible_002dasdf_002dversion_002a"></a>
<p>Forward incompatibility can be determined using the variable
<code>asdf/upgrade::*oldest-forward-compatible-asdf-version*</code>,
which is 2.33 at the time of this writing.</p>
</div>
<hr>



</body>
</html>
